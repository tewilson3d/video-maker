(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function Pf(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var If={exports:{}},la={},jf={exports:{}},Ue={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bs=Symbol.for("react.element"),_g=Symbol.for("react.portal"),Cg=Symbol.for("react.fragment"),Eg=Symbol.for("react.strict_mode"),bg=Symbol.for("react.profiler"),Tg=Symbol.for("react.provider"),Pg=Symbol.for("react.context"),Ig=Symbol.for("react.forward_ref"),jg=Symbol.for("react.suspense"),Ag=Symbol.for("react.memo"),Rg=Symbol.for("react.lazy"),Lu=Symbol.iterator;function Mg(e){return e===null||typeof e!="object"?null:(e=Lu&&e[Lu]||e["@@iterator"],typeof e=="function"?e:null)}var Af={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Rf=Object.assign,Mf={};function Ei(e,t,n){this.props=e,this.context=t,this.refs=Mf,this.updater=n||Af}Ei.prototype.isReactComponent={};Ei.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Ei.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function $f(){}$f.prototype=Ei.prototype;function wc(e,t,n){this.props=e,this.context=t,this.refs=Mf,this.updater=n||Af}var xc=wc.prototype=new $f;xc.constructor=wc;Rf(xc,Ei.prototype);xc.isPureReactComponent=!0;var Fu=Array.isArray,Nf=Object.prototype.hasOwnProperty,Sc={current:null},Df={key:!0,ref:!0,__self:!0,__source:!0};function Of(e,t,n){var r,i={},s=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(s=""+t.key),t)Nf.call(t,r)&&!Df.hasOwnProperty(r)&&(i[r]=t[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(e&&e.defaultProps)for(r in a=e.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:bs,type:e,key:s,ref:o,props:i,_owner:Sc.current}}function $g(e,t){return{$$typeof:bs,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function kc(e){return typeof e=="object"&&e!==null&&e.$$typeof===bs}function Ng(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var zu=/\/+/g;function Ra(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Ng(""+e.key):t.toString(36)}function co(e,t,n,r,i){var s=typeof e;(s==="undefined"||s==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case bs:case _g:o=!0}}if(o)return o=e,i=i(o),e=r===""?"."+Ra(o,0):r,Fu(i)?(n="",e!=null&&(n=e.replace(zu,"$&/")+"/"),co(i,t,n,"",function(c){return c})):i!=null&&(kc(i)&&(i=$g(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(zu,"$&/")+"/")+e)),t.push(i)),1;if(o=0,r=r===""?".":r+":",Fu(e))for(var a=0;a<e.length;a++){s=e[a];var l=r+Ra(s,a);o+=co(s,t,n,l,i)}else if(l=Mg(e),typeof l=="function")for(e=l.call(e),a=0;!(s=e.next()).done;)s=s.value,l=r+Ra(s,a++),o+=co(s,t,n,l,i);else if(s==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function Os(e,t,n){if(e==null)return e;var r=[],i=0;return co(e,r,"","",function(s){return t.call(n,s,i++)}),r}function Dg(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Xt={current:null},uo={transition:null},Og={ReactCurrentDispatcher:Xt,ReactCurrentBatchConfig:uo,ReactCurrentOwner:Sc};function Lf(){throw Error("act(...) is not supported in production builds of React.")}Ue.Children={map:Os,forEach:function(e,t,n){Os(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Os(e,function(){t++}),t},toArray:function(e){return Os(e,function(t){return t})||[]},only:function(e){if(!kc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ue.Component=Ei;Ue.Fragment=Cg;Ue.Profiler=bg;Ue.PureComponent=wc;Ue.StrictMode=Eg;Ue.Suspense=jg;Ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Og;Ue.act=Lf;Ue.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=Rf({},e.props),i=e.key,s=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(s=t.ref,o=Sc.current),t.key!==void 0&&(i=""+t.key),e.type&&e.type.defaultProps)var a=e.type.defaultProps;for(l in t)Nf.call(t,l)&&!Df.hasOwnProperty(l)&&(r[l]=t[l]===void 0&&a!==void 0?a[l]:t[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:bs,type:e.type,key:i,ref:s,props:r,_owner:o}};Ue.createContext=function(e){return e={$$typeof:Pg,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Tg,_context:e},e.Consumer=e};Ue.createElement=Of;Ue.createFactory=function(e){var t=Of.bind(null,e);return t.type=e,t};Ue.createRef=function(){return{current:null}};Ue.forwardRef=function(e){return{$$typeof:Ig,render:e}};Ue.isValidElement=kc;Ue.lazy=function(e){return{$$typeof:Rg,_payload:{_status:-1,_result:e},_init:Dg}};Ue.memo=function(e,t){return{$$typeof:Ag,type:e,compare:t===void 0?null:t}};Ue.startTransition=function(e){var t=uo.transition;uo.transition={};try{e()}finally{uo.transition=t}};Ue.unstable_act=Lf;Ue.useCallback=function(e,t){return Xt.current.useCallback(e,t)};Ue.useContext=function(e){return Xt.current.useContext(e)};Ue.useDebugValue=function(){};Ue.useDeferredValue=function(e){return Xt.current.useDeferredValue(e)};Ue.useEffect=function(e,t){return Xt.current.useEffect(e,t)};Ue.useId=function(){return Xt.current.useId()};Ue.useImperativeHandle=function(e,t,n){return Xt.current.useImperativeHandle(e,t,n)};Ue.useInsertionEffect=function(e,t){return Xt.current.useInsertionEffect(e,t)};Ue.useLayoutEffect=function(e,t){return Xt.current.useLayoutEffect(e,t)};Ue.useMemo=function(e,t){return Xt.current.useMemo(e,t)};Ue.useReducer=function(e,t,n){return Xt.current.useReducer(e,t,n)};Ue.useRef=function(e){return Xt.current.useRef(e)};Ue.useState=function(e){return Xt.current.useState(e)};Ue.useSyncExternalStore=function(e,t,n){return Xt.current.useSyncExternalStore(e,t,n)};Ue.useTransition=function(){return Xt.current.useTransition()};Ue.version="18.3.1";jf.exports=Ue;var G=jf.exports;const Ff=Pf(G);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lg=G,Fg=Symbol.for("react.element"),zg=Symbol.for("react.fragment"),Ug=Object.prototype.hasOwnProperty,Hg=Lg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Wg={key:!0,ref:!0,__self:!0,__source:!0};function zf(e,t,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),t.key!==void 0&&(s=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)Ug.call(t,r)&&!Wg.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)i[r]===void 0&&(i[r]=t[r]);return{$$typeof:Fg,type:e,key:s,ref:o,props:i,_owner:Hg.current}}la.Fragment=zg;la.jsx=zf;la.jsxs=zf;If.exports=la;var y=If.exports,pl={},Uf={exports:{}},fn={},Hf={exports:{}},Wf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(ae,fe){var ve=ae.length;ae.push(fe);e:for(;0<ve;){var Ye=ve-1>>>1,Be=ae[Ye];if(0<i(Be,fe))ae[Ye]=fe,ae[ve]=Be,ve=Ye;else break e}}function n(ae){return ae.length===0?null:ae[0]}function r(ae){if(ae.length===0)return null;var fe=ae[0],ve=ae.pop();if(ve!==fe){ae[0]=ve;e:for(var Ye=0,Be=ae.length,vt=Be>>>1;Ye<vt;){var Me=2*(Ye+1)-1,at=ae[Me],Z=Me+1,ue=ae[Z];if(0>i(at,ve))Z<Be&&0>i(ue,at)?(ae[Ye]=ue,ae[Z]=ve,Ye=Z):(ae[Ye]=at,ae[Me]=ve,Ye=Me);else if(Z<Be&&0>i(ue,ve))ae[Ye]=ue,ae[Z]=ve,Ye=Z;else break e}}return fe}function i(ae,fe){var ve=ae.sortIndex-fe.sortIndex;return ve!==0?ve:ae.id-fe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();e.unstable_now=function(){return o.now()-a}}var l=[],c=[],d=1,f=null,m=3,g=!1,v=!1,w=!1,j=typeof setTimeout=="function"?setTimeout:null,h=typeof clearTimeout=="function"?clearTimeout:null,u=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function p(ae){for(var fe=n(c);fe!==null;){if(fe.callback===null)r(c);else if(fe.startTime<=ae)r(c),fe.sortIndex=fe.expirationTime,t(l,fe);else break;fe=n(c)}}function x(ae){if(w=!1,p(ae),!v)if(n(l)!==null)v=!0,Ut(S);else{var fe=n(c);fe!==null&&Yt(x,fe.startTime-ae)}}function S(ae,fe){v=!1,w&&(w=!1,h(z),z=-1),g=!0;var ve=m;try{for(p(fe),f=n(l);f!==null&&(!(f.expirationTime>fe)||ae&&!ee());){var Ye=f.callback;if(typeof Ye=="function"){f.callback=null,m=f.priorityLevel;var Be=Ye(f.expirationTime<=fe);fe=e.unstable_now(),typeof Be=="function"?f.callback=Be:f===n(l)&&r(l),p(fe)}else r(l);f=n(l)}if(f!==null)var vt=!0;else{var Me=n(c);Me!==null&&Yt(x,Me.startTime-fe),vt=!1}return vt}finally{f=null,m=ve,g=!1}}var b=!1,T=null,z=-1,O=5,J=-1;function ee(){return!(e.unstable_now()-J<O)}function P(){if(T!==null){var ae=e.unstable_now();J=ae;var fe=!0;try{fe=T(!0,ae)}finally{fe?_e():(b=!1,T=null)}}else b=!1}var _e;if(typeof u=="function")_e=function(){u(P)};else if(typeof MessageChannel<"u"){var ht=new MessageChannel,Je=ht.port2;ht.port1.onmessage=P,_e=function(){Je.postMessage(null)}}else _e=function(){j(P,0)};function Ut(ae){T=ae,b||(b=!0,_e())}function Yt(ae,fe){z=j(function(){ae(e.unstable_now())},fe)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ae){ae.callback=null},e.unstable_continueExecution=function(){v||g||(v=!0,Ut(S))},e.unstable_forceFrameRate=function(ae){0>ae||125<ae?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<ae?Math.floor(1e3/ae):5},e.unstable_getCurrentPriorityLevel=function(){return m},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(ae){switch(m){case 1:case 2:case 3:var fe=3;break;default:fe=m}var ve=m;m=fe;try{return ae()}finally{m=ve}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ae,fe){switch(ae){case 1:case 2:case 3:case 4:case 5:break;default:ae=3}var ve=m;m=ae;try{return fe()}finally{m=ve}},e.unstable_scheduleCallback=function(ae,fe,ve){var Ye=e.unstable_now();switch(typeof ve=="object"&&ve!==null?(ve=ve.delay,ve=typeof ve=="number"&&0<ve?Ye+ve:Ye):ve=Ye,ae){case 1:var Be=-1;break;case 2:Be=250;break;case 5:Be=1073741823;break;case 4:Be=1e4;break;default:Be=5e3}return Be=ve+Be,ae={id:d++,callback:fe,priorityLevel:ae,startTime:ve,expirationTime:Be,sortIndex:-1},ve>Ye?(ae.sortIndex=ve,t(c,ae),n(l)===null&&ae===n(c)&&(w?(h(z),z=-1):w=!0,Yt(x,ve-Ye))):(ae.sortIndex=Be,t(l,ae),v||g||(v=!0,Ut(S))),ae},e.unstable_shouldYield=ee,e.unstable_wrapCallback=function(ae){var fe=m;return function(){var ve=m;m=fe;try{return ae.apply(this,arguments)}finally{m=ve}}}})(Wf);Hf.exports=Wf;var Bg=Hf.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kg=G,dn=Bg;function Q(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Bf=new Set,ls={};function zr(e,t){yi(e,t),yi(e+"Capture",t)}function yi(e,t){for(ls[e]=t,e=0;e<t.length;e++)Bf.add(t[e])}var Xn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),hl=Object.prototype.hasOwnProperty,Xg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Uu={},Hu={};function Vg(e){return hl.call(Hu,e)?!0:hl.call(Uu,e)?!1:Xg.test(e)?Hu[e]=!0:(Uu[e]=!0,!1)}function Yg(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Qg(e,t,n,r){if(t===null||typeof t>"u"||Yg(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Vt(e,t,n,r,i,s,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=o}var $t={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){$t[e]=new Vt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];$t[t]=new Vt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){$t[e]=new Vt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){$t[e]=new Vt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){$t[e]=new Vt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){$t[e]=new Vt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){$t[e]=new Vt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){$t[e]=new Vt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){$t[e]=new Vt(e,5,!1,e.toLowerCase(),null,!1,!1)});var _c=/[\-:]([a-z])/g;function Cc(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(_c,Cc);$t[t]=new Vt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(_c,Cc);$t[t]=new Vt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(_c,Cc);$t[t]=new Vt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){$t[e]=new Vt(e,1,!1,e.toLowerCase(),null,!1,!1)});$t.xlinkHref=new Vt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){$t[e]=new Vt(e,1,!1,e.toLowerCase(),null,!0,!0)});function Ec(e,t,n,r){var i=$t.hasOwnProperty(t)?$t[t]:null;(i!==null?i.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Qg(t,n,i,r)&&(n=null),r||i===null?Vg(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=n===null?i.type===3?!1:"":n:(t=i.attributeName,r=i.attributeNamespace,n===null?e.removeAttribute(t):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var Jn=Kg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ls=Symbol.for("react.element"),Gr=Symbol.for("react.portal"),qr=Symbol.for("react.fragment"),bc=Symbol.for("react.strict_mode"),ml=Symbol.for("react.profiler"),Kf=Symbol.for("react.provider"),Xf=Symbol.for("react.context"),Tc=Symbol.for("react.forward_ref"),gl=Symbol.for("react.suspense"),yl=Symbol.for("react.suspense_list"),Pc=Symbol.for("react.memo"),tr=Symbol.for("react.lazy"),Vf=Symbol.for("react.offscreen"),Wu=Symbol.iterator;function Ii(e){return e===null||typeof e!="object"?null:(e=Wu&&e[Wu]||e["@@iterator"],typeof e=="function"?e:null)}var ot=Object.assign,Ma;function Oi(e){if(Ma===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Ma=t&&t[1]||""}return`
`+Ma+e}var $a=!1;function Na(e,t){if(!e||$a)return"";$a=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=o&&0<=a);break}}}finally{$a=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Oi(e):""}function Jg(e){switch(e.tag){case 5:return Oi(e.type);case 16:return Oi("Lazy");case 13:return Oi("Suspense");case 19:return Oi("SuspenseList");case 0:case 2:case 15:return e=Na(e.type,!1),e;case 11:return e=Na(e.type.render,!1),e;case 1:return e=Na(e.type,!0),e;default:return""}}function vl(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case qr:return"Fragment";case Gr:return"Portal";case ml:return"Profiler";case bc:return"StrictMode";case gl:return"Suspense";case yl:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Xf:return(e.displayName||"Context")+".Consumer";case Kf:return(e._context.displayName||"Context")+".Provider";case Tc:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Pc:return t=e.displayName||null,t!==null?t:vl(e.type)||"Memo";case tr:t=e._payload,e=e._init;try{return vl(e(t))}catch{}}return null}function Gg(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return vl(t);case 8:return t===bc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function mr(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Yf(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function qg(e){var t=Yf(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Fs(e){e._valueTracker||(e._valueTracker=qg(e))}function Qf(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Yf(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function Ao(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function wl(e,t){var n=t.checked;return ot({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Bu(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=mr(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Jf(e,t){t=t.checked,t!=null&&Ec(e,"checked",t,!1)}function xl(e,t){Jf(e,t);var n=mr(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Sl(e,t.type,n):t.hasOwnProperty("defaultValue")&&Sl(e,t.type,mr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Ku(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Sl(e,t,n){(t!=="number"||Ao(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Li=Array.isArray;function ui(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+mr(n),t=null,i=0;i<e.length;i++){if(e[i].value===n){e[i].selected=!0,r&&(e[i].defaultSelected=!0);return}t!==null||e[i].disabled||(t=e[i])}t!==null&&(t.selected=!0)}}function kl(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Q(91));return ot({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Xu(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Q(92));if(Li(n)){if(1<n.length)throw Error(Q(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:mr(n)}}function Gf(e,t){var n=mr(t.value),r=mr(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function Vu(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function qf(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _l(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?qf(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var zs,Zf=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,i)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(zs=zs||document.createElement("div"),zs.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=zs.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function cs(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Ji={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Zg=["Webkit","ms","Moz","O"];Object.keys(Ji).forEach(function(e){Zg.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ji[t]=Ji[e]})});function ep(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Ji.hasOwnProperty(e)&&Ji[e]?(""+t).trim():t+"px"}function tp(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=ep(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}var ey=ot({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Cl(e,t){if(t){if(ey[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Q(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Q(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Q(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Q(62))}}function El(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bl=null;function Ic(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Tl=null,di=null,fi=null;function Yu(e){if(e=Is(e)){if(typeof Tl!="function")throw Error(Q(280));var t=e.stateNode;t&&(t=pa(t),Tl(e.stateNode,e.type,t))}}function np(e){di?fi?fi.push(e):fi=[e]:di=e}function rp(){if(di){var e=di,t=fi;if(fi=di=null,Yu(e),t)for(e=0;e<t.length;e++)Yu(t[e])}}function ip(e,t){return e(t)}function sp(){}var Da=!1;function op(e,t,n){if(Da)return e(t,n);Da=!0;try{return ip(e,t,n)}finally{Da=!1,(di!==null||fi!==null)&&(sp(),rp())}}function us(e,t){var n=e.stateNode;if(n===null)return null;var r=pa(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Q(231,t,typeof n));return n}var Pl=!1;if(Xn)try{var ji={};Object.defineProperty(ji,"passive",{get:function(){Pl=!0}}),window.addEventListener("test",ji,ji),window.removeEventListener("test",ji,ji)}catch{Pl=!1}function ty(e,t,n,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(d){this.onError(d)}}var Gi=!1,Ro=null,Mo=!1,Il=null,ny={onError:function(e){Gi=!0,Ro=e}};function ry(e,t,n,r,i,s,o,a,l){Gi=!1,Ro=null,ty.apply(ny,arguments)}function iy(e,t,n,r,i,s,o,a,l){if(ry.apply(this,arguments),Gi){if(Gi){var c=Ro;Gi=!1,Ro=null}else throw Error(Q(198));Mo||(Mo=!0,Il=c)}}function Ur(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function ap(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Qu(e){if(Ur(e)!==e)throw Error(Q(188))}function sy(e){var t=e.alternate;if(!t){if(t=Ur(e),t===null)throw Error(Q(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Qu(i),e;if(s===r)return Qu(i),t;s=s.sibling}throw Error(Q(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(Q(189))}}if(n.alternate!==r)throw Error(Q(190))}if(n.tag!==3)throw Error(Q(188));return n.stateNode.current===n?e:t}function lp(e){return e=sy(e),e!==null?cp(e):null}function cp(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=cp(e);if(t!==null)return t;e=e.sibling}return null}var up=dn.unstable_scheduleCallback,Ju=dn.unstable_cancelCallback,oy=dn.unstable_shouldYield,ay=dn.unstable_requestPaint,pt=dn.unstable_now,ly=dn.unstable_getCurrentPriorityLevel,jc=dn.unstable_ImmediatePriority,dp=dn.unstable_UserBlockingPriority,$o=dn.unstable_NormalPriority,cy=dn.unstable_LowPriority,fp=dn.unstable_IdlePriority,ca=null,On=null;function uy(e){if(On&&typeof On.onCommitFiberRoot=="function")try{On.onCommitFiberRoot(ca,e,void 0,(e.current.flags&128)===128)}catch{}}var Pn=Math.clz32?Math.clz32:py,dy=Math.log,fy=Math.LN2;function py(e){return e>>>=0,e===0?32:31-(dy(e)/fy|0)|0}var Us=64,Hs=4194304;function Fi(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function No(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,i=e.suspendedLanes,s=e.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=Fi(a):(s&=o,s!==0&&(r=Fi(s)))}else o=n&~i,o!==0?r=Fi(o):s!==0&&(r=Fi(s));if(r===0)return 0;if(t!==0&&t!==r&&!(t&i)&&(i=r&-r,s=t&-t,i>=s||i===16&&(s&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Pn(t),i=1<<n,r|=e[n],t&=~i;return r}function hy(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function my(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var o=31-Pn(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=hy(a,t)):l<=t&&(e.expiredLanes|=a),s&=~a}}function jl(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function pp(){var e=Us;return Us<<=1,!(Us&4194240)&&(Us=64),e}function Oa(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ts(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Pn(t),e[t]=n}function gy(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-Pn(n),s=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~s}}function Ac(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Pn(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var Qe=0;function hp(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var mp,Rc,gp,yp,vp,Al=!1,Ws=[],ar=null,lr=null,cr=null,ds=new Map,fs=new Map,rr=[],yy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Gu(e,t){switch(e){case"focusin":case"focusout":ar=null;break;case"dragenter":case"dragleave":lr=null;break;case"mouseover":case"mouseout":cr=null;break;case"pointerover":case"pointerout":ds.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":fs.delete(t.pointerId)}}function Ai(e,t,n,r,i,s){return e===null||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},t!==null&&(t=Is(t),t!==null&&Rc(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,i!==null&&t.indexOf(i)===-1&&t.push(i),e)}function vy(e,t,n,r,i){switch(t){case"focusin":return ar=Ai(ar,e,t,n,r,i),!0;case"dragenter":return lr=Ai(lr,e,t,n,r,i),!0;case"mouseover":return cr=Ai(cr,e,t,n,r,i),!0;case"pointerover":var s=i.pointerId;return ds.set(s,Ai(ds.get(s)||null,e,t,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,fs.set(s,Ai(fs.get(s)||null,e,t,n,r,i)),!0}return!1}function wp(e){var t=Tr(e.target);if(t!==null){var n=Ur(t);if(n!==null){if(t=n.tag,t===13){if(t=ap(n),t!==null){e.blockedOn=t,vp(e.priority,function(){gp(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function fo(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Rl(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);bl=r,n.target.dispatchEvent(r),bl=null}else return t=Is(n),t!==null&&Rc(t),e.blockedOn=n,!1;t.shift()}return!0}function qu(e,t,n){fo(e)&&n.delete(t)}function wy(){Al=!1,ar!==null&&fo(ar)&&(ar=null),lr!==null&&fo(lr)&&(lr=null),cr!==null&&fo(cr)&&(cr=null),ds.forEach(qu),fs.forEach(qu)}function Ri(e,t){e.blockedOn===t&&(e.blockedOn=null,Al||(Al=!0,dn.unstable_scheduleCallback(dn.unstable_NormalPriority,wy)))}function ps(e){function t(i){return Ri(i,e)}if(0<Ws.length){Ri(Ws[0],e);for(var n=1;n<Ws.length;n++){var r=Ws[n];r.blockedOn===e&&(r.blockedOn=null)}}for(ar!==null&&Ri(ar,e),lr!==null&&Ri(lr,e),cr!==null&&Ri(cr,e),ds.forEach(t),fs.forEach(t),n=0;n<rr.length;n++)r=rr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<rr.length&&(n=rr[0],n.blockedOn===null);)wp(n),n.blockedOn===null&&rr.shift()}var pi=Jn.ReactCurrentBatchConfig,Do=!0;function xy(e,t,n,r){var i=Qe,s=pi.transition;pi.transition=null;try{Qe=1,Mc(e,t,n,r)}finally{Qe=i,pi.transition=s}}function Sy(e,t,n,r){var i=Qe,s=pi.transition;pi.transition=null;try{Qe=4,Mc(e,t,n,r)}finally{Qe=i,pi.transition=s}}function Mc(e,t,n,r){if(Do){var i=Rl(e,t,n,r);if(i===null)Va(e,t,r,Oo,n),Gu(e,r);else if(vy(i,e,t,n,r))r.stopPropagation();else if(Gu(e,r),t&4&&-1<yy.indexOf(e)){for(;i!==null;){var s=Is(i);if(s!==null&&mp(s),s=Rl(e,t,n,r),s===null&&Va(e,t,r,Oo,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else Va(e,t,r,null,n)}}var Oo=null;function Rl(e,t,n,r){if(Oo=null,e=Ic(r),e=Tr(e),e!==null)if(t=Ur(e),t===null)e=null;else if(n=t.tag,n===13){if(e=ap(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Oo=e,null}function xp(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ly()){case jc:return 1;case dp:return 4;case $o:case cy:return 16;case fp:return 536870912;default:return 16}default:return 16}}var sr=null,$c=null,po=null;function Sp(){if(po)return po;var e,t=$c,n=t.length,r,i="value"in sr?sr.value:sr.textContent,s=i.length;for(e=0;e<n&&t[e]===i[e];e++);var o=n-e;for(r=1;r<=o&&t[n-r]===i[s-r];r++);return po=i.slice(e,1<r?1-r:void 0)}function ho(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Bs(){return!0}function Zu(){return!1}function pn(e){function t(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in e)e.hasOwnProperty(a)&&(n=e[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Bs:Zu,this.isPropagationStopped=Zu,this}return ot(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Bs)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Bs)},persist:function(){},isPersistent:Bs}),t}var bi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Nc=pn(bi),Ps=ot({},bi,{view:0,detail:0}),ky=pn(Ps),La,Fa,Mi,ua=ot({},Ps,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Dc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Mi&&(Mi&&e.type==="mousemove"?(La=e.screenX-Mi.screenX,Fa=e.screenY-Mi.screenY):Fa=La=0,Mi=e),La)},movementY:function(e){return"movementY"in e?e.movementY:Fa}}),ed=pn(ua),_y=ot({},ua,{dataTransfer:0}),Cy=pn(_y),Ey=ot({},Ps,{relatedTarget:0}),za=pn(Ey),by=ot({},bi,{animationName:0,elapsedTime:0,pseudoElement:0}),Ty=pn(by),Py=ot({},bi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Iy=pn(Py),jy=ot({},bi,{data:0}),td=pn(jy),Ay={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ry={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},My={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $y(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=My[e])?!!t[e]:!1}function Dc(){return $y}var Ny=ot({},Ps,{key:function(e){if(e.key){var t=Ay[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ho(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Ry[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Dc,charCode:function(e){return e.type==="keypress"?ho(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ho(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Dy=pn(Ny),Oy=ot({},ua,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nd=pn(Oy),Ly=ot({},Ps,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Dc}),Fy=pn(Ly),zy=ot({},bi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Uy=pn(zy),Hy=ot({},ua,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Wy=pn(Hy),By=[9,13,27,32],Oc=Xn&&"CompositionEvent"in window,qi=null;Xn&&"documentMode"in document&&(qi=document.documentMode);var Ky=Xn&&"TextEvent"in window&&!qi,kp=Xn&&(!Oc||qi&&8<qi&&11>=qi),rd=String.fromCharCode(32),id=!1;function _p(e,t){switch(e){case"keyup":return By.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Cp(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Zr=!1;function Xy(e,t){switch(e){case"compositionend":return Cp(t);case"keypress":return t.which!==32?null:(id=!0,rd);case"textInput":return e=t.data,e===rd&&id?null:e;default:return null}}function Vy(e,t){if(Zr)return e==="compositionend"||!Oc&&_p(e,t)?(e=Sp(),po=$c=sr=null,Zr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return kp&&t.locale!=="ko"?null:t.data;default:return null}}var Yy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sd(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Yy[e.type]:t==="textarea"}function Ep(e,t,n,r){np(r),t=Lo(t,"onChange"),0<t.length&&(n=new Nc("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Zi=null,hs=null;function Qy(e){Dp(e,0)}function da(e){var t=ni(e);if(Qf(t))return e}function Jy(e,t){if(e==="change")return t}var bp=!1;if(Xn){var Ua;if(Xn){var Ha="oninput"in document;if(!Ha){var od=document.createElement("div");od.setAttribute("oninput","return;"),Ha=typeof od.oninput=="function"}Ua=Ha}else Ua=!1;bp=Ua&&(!document.documentMode||9<document.documentMode)}function ad(){Zi&&(Zi.detachEvent("onpropertychange",Tp),hs=Zi=null)}function Tp(e){if(e.propertyName==="value"&&da(hs)){var t=[];Ep(t,hs,e,Ic(e)),op(Qy,t)}}function Gy(e,t,n){e==="focusin"?(ad(),Zi=t,hs=n,Zi.attachEvent("onpropertychange",Tp)):e==="focusout"&&ad()}function qy(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return da(hs)}function Zy(e,t){if(e==="click")return da(t)}function e0(e,t){if(e==="input"||e==="change")return da(t)}function t0(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var jn=typeof Object.is=="function"?Object.is:t0;function ms(e,t){if(jn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!hl.call(t,i)||!jn(e[i],t[i]))return!1}return!0}function ld(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cd(e,t){var n=ld(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ld(n)}}function Pp(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Pp(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Ip(){for(var e=window,t=Ao();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Ao(e.document)}return t}function Lc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function n0(e){var t=Ip(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Pp(n.ownerDocument.documentElement,n)){if(r!==null&&Lc(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!e.extend&&s>r&&(i=r,r=s,s=i),i=cd(n,s);var o=cd(n,r);i&&o&&(e.rangeCount!==1||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(i.node,i.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var r0=Xn&&"documentMode"in document&&11>=document.documentMode,ei=null,Ml=null,es=null,$l=!1;function ud(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;$l||ei==null||ei!==Ao(r)||(r=ei,"selectionStart"in r&&Lc(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),es&&ms(es,r)||(es=r,r=Lo(Ml,"onSelect"),0<r.length&&(t=new Nc("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=ei)))}function Ks(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var ti={animationend:Ks("Animation","AnimationEnd"),animationiteration:Ks("Animation","AnimationIteration"),animationstart:Ks("Animation","AnimationStart"),transitionend:Ks("Transition","TransitionEnd")},Wa={},jp={};Xn&&(jp=document.createElement("div").style,"AnimationEvent"in window||(delete ti.animationend.animation,delete ti.animationiteration.animation,delete ti.animationstart.animation),"TransitionEvent"in window||delete ti.transitionend.transition);function fa(e){if(Wa[e])return Wa[e];if(!ti[e])return e;var t=ti[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in jp)return Wa[e]=t[n];return e}var Ap=fa("animationend"),Rp=fa("animationiteration"),Mp=fa("animationstart"),$p=fa("transitionend"),Np=new Map,dd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function yr(e,t){Np.set(e,t),zr(t,[e])}for(var Ba=0;Ba<dd.length;Ba++){var Ka=dd[Ba],i0=Ka.toLowerCase(),s0=Ka[0].toUpperCase()+Ka.slice(1);yr(i0,"on"+s0)}yr(Ap,"onAnimationEnd");yr(Rp,"onAnimationIteration");yr(Mp,"onAnimationStart");yr("dblclick","onDoubleClick");yr("focusin","onFocus");yr("focusout","onBlur");yr($p,"onTransitionEnd");yi("onMouseEnter",["mouseout","mouseover"]);yi("onMouseLeave",["mouseout","mouseover"]);yi("onPointerEnter",["pointerout","pointerover"]);yi("onPointerLeave",["pointerout","pointerover"]);zr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));zr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));zr("onBeforeInput",["compositionend","keypress","textInput","paste"]);zr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));zr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));zr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),o0=new Set("cancel close invalid load scroll toggle".split(" ").concat(zi));function fd(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,iy(r,t,void 0,e),e.currentTarget=null}function Dp(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;fd(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;fd(i,a,c),s=l}}}if(Mo)throw e=Il,Mo=!1,Il=null,e}function tt(e,t){var n=t[Fl];n===void 0&&(n=t[Fl]=new Set);var r=e+"__bubble";n.has(r)||(Op(t,e,2,!1),n.add(r))}function Xa(e,t,n){var r=0;t&&(r|=4),Op(n,e,r,t)}var Xs="_reactListening"+Math.random().toString(36).slice(2);function gs(e){if(!e[Xs]){e[Xs]=!0,Bf.forEach(function(n){n!=="selectionchange"&&(o0.has(n)||Xa(n,!1,e),Xa(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Xs]||(t[Xs]=!0,Xa("selectionchange",!1,t))}}function Op(e,t,n,r){switch(xp(t)){case 1:var i=xy;break;case 4:i=Sy;break;default:i=Mc}n=i.bind(null,t,n,e),i=void 0,!Pl||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(i=!0),r?i!==void 0?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):i!==void 0?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Va(e,t,n,r,i){var s=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Tr(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}op(function(){var c=s,d=Ic(n),f=[];e:{var m=Np.get(e);if(m!==void 0){var g=Nc,v=e;switch(e){case"keypress":if(ho(n)===0)break e;case"keydown":case"keyup":g=Dy;break;case"focusin":v="focus",g=za;break;case"focusout":v="blur",g=za;break;case"beforeblur":case"afterblur":g=za;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=ed;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=Cy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=Fy;break;case Ap:case Rp:case Mp:g=Ty;break;case $p:g=Uy;break;case"scroll":g=ky;break;case"wheel":g=Wy;break;case"copy":case"cut":case"paste":g=Iy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=nd}var w=(t&4)!==0,j=!w&&e==="scroll",h=w?m!==null?m+"Capture":null:m;w=[];for(var u=c,p;u!==null;){p=u;var x=p.stateNode;if(p.tag===5&&x!==null&&(p=x,h!==null&&(x=us(u,h),x!=null&&w.push(ys(u,x,p)))),j)break;u=u.return}0<w.length&&(m=new g(m,v,null,n,d),f.push({event:m,listeners:w}))}}if(!(t&7)){e:{if(m=e==="mouseover"||e==="pointerover",g=e==="mouseout"||e==="pointerout",m&&n!==bl&&(v=n.relatedTarget||n.fromElement)&&(Tr(v)||v[Vn]))break e;if((g||m)&&(m=d.window===d?d:(m=d.ownerDocument)?m.defaultView||m.parentWindow:window,g?(v=n.relatedTarget||n.toElement,g=c,v=v?Tr(v):null,v!==null&&(j=Ur(v),v!==j||v.tag!==5&&v.tag!==6)&&(v=null)):(g=null,v=c),g!==v)){if(w=ed,x="onMouseLeave",h="onMouseEnter",u="mouse",(e==="pointerout"||e==="pointerover")&&(w=nd,x="onPointerLeave",h="onPointerEnter",u="pointer"),j=g==null?m:ni(g),p=v==null?m:ni(v),m=new w(x,u+"leave",g,n,d),m.target=j,m.relatedTarget=p,x=null,Tr(d)===c&&(w=new w(h,u+"enter",v,n,d),w.target=p,w.relatedTarget=j,x=w),j=x,g&&v)t:{for(w=g,h=v,u=0,p=w;p;p=Wr(p))u++;for(p=0,x=h;x;x=Wr(x))p++;for(;0<u-p;)w=Wr(w),u--;for(;0<p-u;)h=Wr(h),p--;for(;u--;){if(w===h||h!==null&&w===h.alternate)break t;w=Wr(w),h=Wr(h)}w=null}else w=null;g!==null&&pd(f,m,g,w,!1),v!==null&&j!==null&&pd(f,j,v,w,!0)}}e:{if(m=c?ni(c):window,g=m.nodeName&&m.nodeName.toLowerCase(),g==="select"||g==="input"&&m.type==="file")var S=Jy;else if(sd(m))if(bp)S=e0;else{S=qy;var b=Gy}else(g=m.nodeName)&&g.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(S=Zy);if(S&&(S=S(e,c))){Ep(f,S,n,d);break e}b&&b(e,m,c),e==="focusout"&&(b=m._wrapperState)&&b.controlled&&m.type==="number"&&Sl(m,"number",m.value)}switch(b=c?ni(c):window,e){case"focusin":(sd(b)||b.contentEditable==="true")&&(ei=b,Ml=c,es=null);break;case"focusout":es=Ml=ei=null;break;case"mousedown":$l=!0;break;case"contextmenu":case"mouseup":case"dragend":$l=!1,ud(f,n,d);break;case"selectionchange":if(r0)break;case"keydown":case"keyup":ud(f,n,d)}var T;if(Oc)e:{switch(e){case"compositionstart":var z="onCompositionStart";break e;case"compositionend":z="onCompositionEnd";break e;case"compositionupdate":z="onCompositionUpdate";break e}z=void 0}else Zr?_p(e,n)&&(z="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(z="onCompositionStart");z&&(kp&&n.locale!=="ko"&&(Zr||z!=="onCompositionStart"?z==="onCompositionEnd"&&Zr&&(T=Sp()):(sr=d,$c="value"in sr?sr.value:sr.textContent,Zr=!0)),b=Lo(c,z),0<b.length&&(z=new td(z,e,null,n,d),f.push({event:z,listeners:b}),T?z.data=T:(T=Cp(n),T!==null&&(z.data=T)))),(T=Ky?Xy(e,n):Vy(e,n))&&(c=Lo(c,"onBeforeInput"),0<c.length&&(d=new td("onBeforeInput","beforeinput",null,n,d),f.push({event:d,listeners:c}),d.data=T))}Dp(f,t)})}function ys(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Lo(e,t){for(var n=t+"Capture",r=[];e!==null;){var i=e,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=us(e,n),s!=null&&r.unshift(ys(e,s,i)),s=us(e,t),s!=null&&r.push(ys(e,s,i))),e=e.return}return r}function Wr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function pd(e,t,n,r,i){for(var s=t._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=us(n,s),l!=null&&o.unshift(ys(n,l,a))):i||(l=us(n,s),l!=null&&o.push(ys(n,l,a)))),n=n.return}o.length!==0&&e.push({event:t,listeners:o})}var a0=/\r\n?/g,l0=/\u0000|\uFFFD/g;function hd(e){return(typeof e=="string"?e:""+e).replace(a0,`
`).replace(l0,"")}function Vs(e,t,n){if(t=hd(t),hd(e)!==t&&n)throw Error(Q(425))}function Fo(){}var Nl=null,Dl=null;function Ol(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ll=typeof setTimeout=="function"?setTimeout:void 0,c0=typeof clearTimeout=="function"?clearTimeout:void 0,md=typeof Promise=="function"?Promise:void 0,u0=typeof queueMicrotask=="function"?queueMicrotask:typeof md<"u"?function(e){return md.resolve(null).then(e).catch(d0)}:Ll;function d0(e){setTimeout(function(){throw e})}function Ya(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){e.removeChild(i),ps(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);ps(t)}function ur(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function gd(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Ti=Math.random().toString(36).slice(2),Nn="__reactFiber$"+Ti,vs="__reactProps$"+Ti,Vn="__reactContainer$"+Ti,Fl="__reactEvents$"+Ti,f0="__reactListeners$"+Ti,p0="__reactHandles$"+Ti;function Tr(e){var t=e[Nn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Vn]||n[Nn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=gd(e);e!==null;){if(n=e[Nn])return n;e=gd(e)}return t}e=n,n=e.parentNode}return null}function Is(e){return e=e[Nn]||e[Vn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ni(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Q(33))}function pa(e){return e[vs]||null}var zl=[],ri=-1;function vr(e){return{current:e}}function nt(e){0>ri||(e.current=zl[ri],zl[ri]=null,ri--)}function qe(e,t){ri++,zl[ri]=e.current,e.current=t}var gr={},zt=vr(gr),Zt=vr(!1),$r=gr;function vi(e,t){var n=e.type.contextTypes;if(!n)return gr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=t[s];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function en(e){return e=e.childContextTypes,e!=null}function zo(){nt(Zt),nt(zt)}function yd(e,t,n){if(zt.current!==gr)throw Error(Q(168));qe(zt,t),qe(Zt,n)}function Lp(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in t))throw Error(Q(108,Gg(e)||"Unknown",i));return ot({},n,r)}function Uo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||gr,$r=zt.current,qe(zt,e),qe(Zt,Zt.current),!0}function vd(e,t,n){var r=e.stateNode;if(!r)throw Error(Q(169));n?(e=Lp(e,t,$r),r.__reactInternalMemoizedMergedChildContext=e,nt(Zt),nt(zt),qe(zt,e)):nt(Zt),qe(Zt,n)}var Hn=null,ha=!1,Qa=!1;function Fp(e){Hn===null?Hn=[e]:Hn.push(e)}function h0(e){ha=!0,Fp(e)}function wr(){if(!Qa&&Hn!==null){Qa=!0;var e=0,t=Qe;try{var n=Hn;for(Qe=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}Hn=null,ha=!1}catch(i){throw Hn!==null&&(Hn=Hn.slice(e+1)),up(jc,wr),i}finally{Qe=t,Qa=!1}}return null}var ii=[],si=0,Ho=null,Wo=0,hn=[],mn=0,Nr=null,Wn=1,Bn="";function _r(e,t){ii[si++]=Wo,ii[si++]=Ho,Ho=e,Wo=t}function zp(e,t,n){hn[mn++]=Wn,hn[mn++]=Bn,hn[mn++]=Nr,Nr=e;var r=Wn;e=Bn;var i=32-Pn(r)-1;r&=~(1<<i),n+=1;var s=32-Pn(t)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Wn=1<<32-Pn(t)+i|n<<i|r,Bn=s+e}else Wn=1<<s|n<<i|r,Bn=e}function Fc(e){e.return!==null&&(_r(e,1),zp(e,1,0))}function zc(e){for(;e===Ho;)Ho=ii[--si],ii[si]=null,Wo=ii[--si],ii[si]=null;for(;e===Nr;)Nr=hn[--mn],hn[mn]=null,Bn=hn[--mn],hn[mn]=null,Wn=hn[--mn],hn[mn]=null}var un=null,cn=null,rt=!1,Tn=null;function Up(e,t){var n=gn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function wd(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,un=e,cn=ur(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,un=e,cn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Nr!==null?{id:Wn,overflow:Bn}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=gn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,un=e,cn=null,!0):!1;default:return!1}}function Ul(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Hl(e){if(rt){var t=cn;if(t){var n=t;if(!wd(e,t)){if(Ul(e))throw Error(Q(418));t=ur(n.nextSibling);var r=un;t&&wd(e,t)?Up(r,n):(e.flags=e.flags&-4097|2,rt=!1,un=e)}}else{if(Ul(e))throw Error(Q(418));e.flags=e.flags&-4097|2,rt=!1,un=e}}}function xd(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;un=e}function Ys(e){if(e!==un)return!1;if(!rt)return xd(e),rt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Ol(e.type,e.memoizedProps)),t&&(t=cn)){if(Ul(e))throw Hp(),Error(Q(418));for(;t;)Up(e,t),t=ur(t.nextSibling)}if(xd(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Q(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){cn=ur(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}cn=null}}else cn=un?ur(e.stateNode.nextSibling):null;return!0}function Hp(){for(var e=cn;e;)e=ur(e.nextSibling)}function wi(){cn=un=null,rt=!1}function Uc(e){Tn===null?Tn=[e]:Tn.push(e)}var m0=Jn.ReactCurrentBatchConfig;function $i(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Q(309));var r=n.stateNode}if(!r)throw Error(Q(147,e));var i=r,s=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===s?t.ref:(t=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},t._stringRef=s,t)}if(typeof e!="string")throw Error(Q(284));if(!n._owner)throw Error(Q(290,e))}return e}function Qs(e,t){throw e=Object.prototype.toString.call(t),Error(Q(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Sd(e){var t=e._init;return t(e._payload)}function Wp(e){function t(h,u){if(e){var p=h.deletions;p===null?(h.deletions=[u],h.flags|=16):p.push(u)}}function n(h,u){if(!e)return null;for(;u!==null;)t(h,u),u=u.sibling;return null}function r(h,u){for(h=new Map;u!==null;)u.key!==null?h.set(u.key,u):h.set(u.index,u),u=u.sibling;return h}function i(h,u){return h=hr(h,u),h.index=0,h.sibling=null,h}function s(h,u,p){return h.index=p,e?(p=h.alternate,p!==null?(p=p.index,p<u?(h.flags|=2,u):p):(h.flags|=2,u)):(h.flags|=1048576,u)}function o(h){return e&&h.alternate===null&&(h.flags|=2),h}function a(h,u,p,x){return u===null||u.tag!==6?(u=nl(p,h.mode,x),u.return=h,u):(u=i(u,p),u.return=h,u)}function l(h,u,p,x){var S=p.type;return S===qr?d(h,u,p.props.children,x,p.key):u!==null&&(u.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===tr&&Sd(S)===u.type)?(x=i(u,p.props),x.ref=$i(h,u,p),x.return=h,x):(x=So(p.type,p.key,p.props,null,h.mode,x),x.ref=$i(h,u,p),x.return=h,x)}function c(h,u,p,x){return u===null||u.tag!==4||u.stateNode.containerInfo!==p.containerInfo||u.stateNode.implementation!==p.implementation?(u=rl(p,h.mode,x),u.return=h,u):(u=i(u,p.children||[]),u.return=h,u)}function d(h,u,p,x,S){return u===null||u.tag!==7?(u=Mr(p,h.mode,x,S),u.return=h,u):(u=i(u,p),u.return=h,u)}function f(h,u,p){if(typeof u=="string"&&u!==""||typeof u=="number")return u=nl(""+u,h.mode,p),u.return=h,u;if(typeof u=="object"&&u!==null){switch(u.$$typeof){case Ls:return p=So(u.type,u.key,u.props,null,h.mode,p),p.ref=$i(h,null,u),p.return=h,p;case Gr:return u=rl(u,h.mode,p),u.return=h,u;case tr:var x=u._init;return f(h,x(u._payload),p)}if(Li(u)||Ii(u))return u=Mr(u,h.mode,p,null),u.return=h,u;Qs(h,u)}return null}function m(h,u,p,x){var S=u!==null?u.key:null;if(typeof p=="string"&&p!==""||typeof p=="number")return S!==null?null:a(h,u,""+p,x);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Ls:return p.key===S?l(h,u,p,x):null;case Gr:return p.key===S?c(h,u,p,x):null;case tr:return S=p._init,m(h,u,S(p._payload),x)}if(Li(p)||Ii(p))return S!==null?null:d(h,u,p,x,null);Qs(h,p)}return null}function g(h,u,p,x,S){if(typeof x=="string"&&x!==""||typeof x=="number")return h=h.get(p)||null,a(u,h,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Ls:return h=h.get(x.key===null?p:x.key)||null,l(u,h,x,S);case Gr:return h=h.get(x.key===null?p:x.key)||null,c(u,h,x,S);case tr:var b=x._init;return g(h,u,p,b(x._payload),S)}if(Li(x)||Ii(x))return h=h.get(p)||null,d(u,h,x,S,null);Qs(u,x)}return null}function v(h,u,p,x){for(var S=null,b=null,T=u,z=u=0,O=null;T!==null&&z<p.length;z++){T.index>z?(O=T,T=null):O=T.sibling;var J=m(h,T,p[z],x);if(J===null){T===null&&(T=O);break}e&&T&&J.alternate===null&&t(h,T),u=s(J,u,z),b===null?S=J:b.sibling=J,b=J,T=O}if(z===p.length)return n(h,T),rt&&_r(h,z),S;if(T===null){for(;z<p.length;z++)T=f(h,p[z],x),T!==null&&(u=s(T,u,z),b===null?S=T:b.sibling=T,b=T);return rt&&_r(h,z),S}for(T=r(h,T);z<p.length;z++)O=g(T,h,z,p[z],x),O!==null&&(e&&O.alternate!==null&&T.delete(O.key===null?z:O.key),u=s(O,u,z),b===null?S=O:b.sibling=O,b=O);return e&&T.forEach(function(ee){return t(h,ee)}),rt&&_r(h,z),S}function w(h,u,p,x){var S=Ii(p);if(typeof S!="function")throw Error(Q(150));if(p=S.call(p),p==null)throw Error(Q(151));for(var b=S=null,T=u,z=u=0,O=null,J=p.next();T!==null&&!J.done;z++,J=p.next()){T.index>z?(O=T,T=null):O=T.sibling;var ee=m(h,T,J.value,x);if(ee===null){T===null&&(T=O);break}e&&T&&ee.alternate===null&&t(h,T),u=s(ee,u,z),b===null?S=ee:b.sibling=ee,b=ee,T=O}if(J.done)return n(h,T),rt&&_r(h,z),S;if(T===null){for(;!J.done;z++,J=p.next())J=f(h,J.value,x),J!==null&&(u=s(J,u,z),b===null?S=J:b.sibling=J,b=J);return rt&&_r(h,z),S}for(T=r(h,T);!J.done;z++,J=p.next())J=g(T,h,z,J.value,x),J!==null&&(e&&J.alternate!==null&&T.delete(J.key===null?z:J.key),u=s(J,u,z),b===null?S=J:b.sibling=J,b=J);return e&&T.forEach(function(P){return t(h,P)}),rt&&_r(h,z),S}function j(h,u,p,x){if(typeof p=="object"&&p!==null&&p.type===qr&&p.key===null&&(p=p.props.children),typeof p=="object"&&p!==null){switch(p.$$typeof){case Ls:e:{for(var S=p.key,b=u;b!==null;){if(b.key===S){if(S=p.type,S===qr){if(b.tag===7){n(h,b.sibling),u=i(b,p.props.children),u.return=h,h=u;break e}}else if(b.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===tr&&Sd(S)===b.type){n(h,b.sibling),u=i(b,p.props),u.ref=$i(h,b,p),u.return=h,h=u;break e}n(h,b);break}else t(h,b);b=b.sibling}p.type===qr?(u=Mr(p.props.children,h.mode,x,p.key),u.return=h,h=u):(x=So(p.type,p.key,p.props,null,h.mode,x),x.ref=$i(h,u,p),x.return=h,h=x)}return o(h);case Gr:e:{for(b=p.key;u!==null;){if(u.key===b)if(u.tag===4&&u.stateNode.containerInfo===p.containerInfo&&u.stateNode.implementation===p.implementation){n(h,u.sibling),u=i(u,p.children||[]),u.return=h,h=u;break e}else{n(h,u);break}else t(h,u);u=u.sibling}u=rl(p,h.mode,x),u.return=h,h=u}return o(h);case tr:return b=p._init,j(h,u,b(p._payload),x)}if(Li(p))return v(h,u,p,x);if(Ii(p))return w(h,u,p,x);Qs(h,p)}return typeof p=="string"&&p!==""||typeof p=="number"?(p=""+p,u!==null&&u.tag===6?(n(h,u.sibling),u=i(u,p),u.return=h,h=u):(n(h,u),u=nl(p,h.mode,x),u.return=h,h=u),o(h)):n(h,u)}return j}var xi=Wp(!0),Bp=Wp(!1),Bo=vr(null),Ko=null,oi=null,Hc=null;function Wc(){Hc=oi=Ko=null}function Bc(e){var t=Bo.current;nt(Bo),e._currentValue=t}function Wl(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function hi(e,t){Ko=e,Hc=oi=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(qt=!0),e.firstContext=null)}function wn(e){var t=e._currentValue;if(Hc!==e)if(e={context:e,memoizedValue:t,next:null},oi===null){if(Ko===null)throw Error(Q(308));oi=e,Ko.dependencies={lanes:0,firstContext:e}}else oi=oi.next=e;return t}var Pr=null;function Kc(e){Pr===null?Pr=[e]:Pr.push(e)}function Kp(e,t,n,r){var i=t.interleaved;return i===null?(n.next=n,Kc(t)):(n.next=i.next,i.next=n),t.interleaved=n,Yn(e,r)}function Yn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var nr=!1;function Xc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Xp(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Kn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function dr(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Ke&2){var i=r.pending;return i===null?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Yn(e,n)}return i=r.interleaved,i===null?(t.next=t,Kc(r)):(t.next=i.next,i.next=t),r.interleaved=t,Yn(e,n)}function mo(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Ac(e,n)}}function kd(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=t:s=s.next=t}else i=s=t;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Xo(e,t,n,r){var i=e.updateQueue;nr=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var d=e.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==o&&(a===null?d.firstBaseUpdate=c:a.next=c,d.lastBaseUpdate=l))}if(s!==null){var f=i.baseState;o=0,d=c=l=null,a=s;do{var m=a.lane,g=a.eventTime;if((r&m)===m){d!==null&&(d=d.next={eventTime:g,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var v=e,w=a;switch(m=t,g=n,w.tag){case 1:if(v=w.payload,typeof v=="function"){f=v.call(g,f,m);break e}f=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=w.payload,m=typeof v=="function"?v.call(g,f,m):v,m==null)break e;f=ot({},f,m);break e;case 2:nr=!0}}a.callback!==null&&a.lane!==0&&(e.flags|=64,m=i.effects,m===null?i.effects=[a]:m.push(a))}else g={eventTime:g,lane:m,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(c=d=g,l=f):d=d.next=g,o|=m;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;m=a,a=m.next,m.next=null,i.lastBaseUpdate=m,i.shared.pending=null}}while(1);if(d===null&&(l=f),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=d,t=i.shared.interleaved,t!==null){i=t;do o|=i.lane,i=i.next;while(i!==t)}else s===null&&(i.shared.lanes=0);Or|=o,e.lanes=o,e.memoizedState=f}}function _d(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(Q(191,i));i.call(r)}}}var js={},Ln=vr(js),ws=vr(js),xs=vr(js);function Ir(e){if(e===js)throw Error(Q(174));return e}function Vc(e,t){switch(qe(xs,t),qe(ws,e),qe(Ln,js),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:_l(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=_l(t,e)}nt(Ln),qe(Ln,t)}function Si(){nt(Ln),nt(ws),nt(xs)}function Vp(e){Ir(xs.current);var t=Ir(Ln.current),n=_l(t,e.type);t!==n&&(qe(ws,e),qe(Ln,n))}function Yc(e){ws.current===e&&(nt(Ln),nt(ws))}var it=vr(0);function Vo(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ja=[];function Qc(){for(var e=0;e<Ja.length;e++)Ja[e]._workInProgressVersionPrimary=null;Ja.length=0}var go=Jn.ReactCurrentDispatcher,Ga=Jn.ReactCurrentBatchConfig,Dr=0,st=null,Ct=null,Pt=null,Yo=!1,ts=!1,Ss=0,g0=0;function Dt(){throw Error(Q(321))}function Jc(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!jn(e[n],t[n]))return!1;return!0}function Gc(e,t,n,r,i,s){if(Dr=s,st=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,go.current=e===null||e.memoizedState===null?x0:S0,e=n(r,i),ts){s=0;do{if(ts=!1,Ss=0,25<=s)throw Error(Q(301));s+=1,Pt=Ct=null,t.updateQueue=null,go.current=k0,e=n(r,i)}while(ts)}if(go.current=Qo,t=Ct!==null&&Ct.next!==null,Dr=0,Pt=Ct=st=null,Yo=!1,t)throw Error(Q(300));return e}function qc(){var e=Ss!==0;return Ss=0,e}function Mn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pt===null?st.memoizedState=Pt=e:Pt=Pt.next=e,Pt}function xn(){if(Ct===null){var e=st.alternate;e=e!==null?e.memoizedState:null}else e=Ct.next;var t=Pt===null?st.memoizedState:Pt.next;if(t!==null)Pt=t,Ct=e;else{if(e===null)throw Error(Q(310));Ct=e,e={memoizedState:Ct.memoizedState,baseState:Ct.baseState,baseQueue:Ct.baseQueue,queue:Ct.queue,next:null},Pt===null?st.memoizedState=Pt=e:Pt=Pt.next=e}return Pt}function ks(e,t){return typeof t=="function"?t(e):t}function qa(e){var t=xn(),n=t.queue;if(n===null)throw Error(Q(311));n.lastRenderedReducer=e;var r=Ct,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var d=c.lane;if((Dr&d)===d)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var f={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,st.lanes|=d,Or|=d}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,jn(r,t.memoizedState)||(qt=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=l,n.lastRenderedState=r}if(e=n.interleaved,e!==null){i=e;do s=i.lane,st.lanes|=s,Or|=s,i=i.next;while(i!==e)}else i===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Za(e){var t=xn(),n=t.queue;if(n===null)throw Error(Q(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=e(s,o.action),o=o.next;while(o!==i);jn(s,t.memoizedState)||(qt=!0),t.memoizedState=s,t.baseQueue===null&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Yp(){}function Qp(e,t){var n=st,r=xn(),i=t(),s=!jn(r.memoizedState,i);if(s&&(r.memoizedState=i,qt=!0),r=r.queue,Zc(qp.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||Pt!==null&&Pt.memoizedState.tag&1){if(n.flags|=2048,_s(9,Gp.bind(null,n,r,i,t),void 0,null),It===null)throw Error(Q(349));Dr&30||Jp(n,t,i)}return i}function Jp(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=st.updateQueue,t===null?(t={lastEffect:null,stores:null},st.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Gp(e,t,n,r){t.value=n,t.getSnapshot=r,Zp(t)&&eh(e)}function qp(e,t,n){return n(function(){Zp(t)&&eh(e)})}function Zp(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!jn(e,n)}catch{return!0}}function eh(e){var t=Yn(e,1);t!==null&&In(t,e,1,-1)}function Cd(e){var t=Mn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ks,lastRenderedState:e},t.queue=e,e=e.dispatch=w0.bind(null,st,e),[t.memoizedState,e]}function _s(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=st.updateQueue,t===null?(t={lastEffect:null,stores:null},st.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function th(){return xn().memoizedState}function yo(e,t,n,r){var i=Mn();st.flags|=e,i.memoizedState=_s(1|t,n,void 0,r===void 0?null:r)}function ma(e,t,n,r){var i=xn();r=r===void 0?null:r;var s=void 0;if(Ct!==null){var o=Ct.memoizedState;if(s=o.destroy,r!==null&&Jc(r,o.deps)){i.memoizedState=_s(t,n,s,r);return}}st.flags|=e,i.memoizedState=_s(1|t,n,s,r)}function Ed(e,t){return yo(8390656,8,e,t)}function Zc(e,t){return ma(2048,8,e,t)}function nh(e,t){return ma(4,2,e,t)}function rh(e,t){return ma(4,4,e,t)}function ih(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function sh(e,t,n){return n=n!=null?n.concat([e]):null,ma(4,4,ih.bind(null,t,e),n)}function eu(){}function oh(e,t){var n=xn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Jc(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function ah(e,t){var n=xn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&Jc(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function lh(e,t,n){return Dr&21?(jn(n,t)||(n=pp(),st.lanes|=n,Or|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,qt=!0),e.memoizedState=n)}function y0(e,t){var n=Qe;Qe=n!==0&&4>n?n:4,e(!0);var r=Ga.transition;Ga.transition={};try{e(!1),t()}finally{Qe=n,Ga.transition=r}}function ch(){return xn().memoizedState}function v0(e,t,n){var r=pr(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},uh(e))dh(t,n);else if(n=Kp(e,t,n,r),n!==null){var i=Kt();In(n,e,r,i),fh(n,t,r)}}function w0(e,t,n){var r=pr(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(uh(e))dh(t,i);else{var s=e.alternate;if(e.lanes===0&&(s===null||s.lanes===0)&&(s=t.lastRenderedReducer,s!==null))try{var o=t.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,jn(a,o)){var l=t.interleaved;l===null?(i.next=i,Kc(t)):(i.next=l.next,l.next=i),t.interleaved=i;return}}catch{}finally{}n=Kp(e,t,i,r),n!==null&&(i=Kt(),In(n,e,r,i),fh(n,t,r))}}function uh(e){var t=e.alternate;return e===st||t!==null&&t===st}function dh(e,t){ts=Yo=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function fh(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,Ac(e,n)}}var Qo={readContext:wn,useCallback:Dt,useContext:Dt,useEffect:Dt,useImperativeHandle:Dt,useInsertionEffect:Dt,useLayoutEffect:Dt,useMemo:Dt,useReducer:Dt,useRef:Dt,useState:Dt,useDebugValue:Dt,useDeferredValue:Dt,useTransition:Dt,useMutableSource:Dt,useSyncExternalStore:Dt,useId:Dt,unstable_isNewReconciler:!1},x0={readContext:wn,useCallback:function(e,t){return Mn().memoizedState=[e,t===void 0?null:t],e},useContext:wn,useEffect:Ed,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,yo(4194308,4,ih.bind(null,t,e),n)},useLayoutEffect:function(e,t){return yo(4194308,4,e,t)},useInsertionEffect:function(e,t){return yo(4,2,e,t)},useMemo:function(e,t){var n=Mn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Mn();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=v0.bind(null,st,e),[r.memoizedState,e]},useRef:function(e){var t=Mn();return e={current:e},t.memoizedState=e},useState:Cd,useDebugValue:eu,useDeferredValue:function(e){return Mn().memoizedState=e},useTransition:function(){var e=Cd(!1),t=e[0];return e=y0.bind(null,e[1]),Mn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=st,i=Mn();if(rt){if(n===void 0)throw Error(Q(407));n=n()}else{if(n=t(),It===null)throw Error(Q(349));Dr&30||Jp(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,Ed(qp.bind(null,r,s,e),[e]),r.flags|=2048,_s(9,Gp.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=Mn(),t=It.identifierPrefix;if(rt){var n=Bn,r=Wn;n=(r&~(1<<32-Pn(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=Ss++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=g0++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},S0={readContext:wn,useCallback:oh,useContext:wn,useEffect:Zc,useImperativeHandle:sh,useInsertionEffect:nh,useLayoutEffect:rh,useMemo:ah,useReducer:qa,useRef:th,useState:function(){return qa(ks)},useDebugValue:eu,useDeferredValue:function(e){var t=xn();return lh(t,Ct.memoizedState,e)},useTransition:function(){var e=qa(ks)[0],t=xn().memoizedState;return[e,t]},useMutableSource:Yp,useSyncExternalStore:Qp,useId:ch,unstable_isNewReconciler:!1},k0={readContext:wn,useCallback:oh,useContext:wn,useEffect:Zc,useImperativeHandle:sh,useInsertionEffect:nh,useLayoutEffect:rh,useMemo:ah,useReducer:Za,useRef:th,useState:function(){return Za(ks)},useDebugValue:eu,useDeferredValue:function(e){var t=xn();return Ct===null?t.memoizedState=e:lh(t,Ct.memoizedState,e)},useTransition:function(){var e=Za(ks)[0],t=xn().memoizedState;return[e,t]},useMutableSource:Yp,useSyncExternalStore:Qp,useId:ch,unstable_isNewReconciler:!1};function Cn(e,t){if(e&&e.defaultProps){t=ot({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Bl(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:ot({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var ga={isMounted:function(e){return(e=e._reactInternals)?Ur(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Kt(),i=pr(e),s=Kn(r,i);s.payload=t,n!=null&&(s.callback=n),t=dr(e,s,i),t!==null&&(In(t,e,i,r),mo(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Kt(),i=pr(e),s=Kn(r,i);s.tag=1,s.payload=t,n!=null&&(s.callback=n),t=dr(e,s,i),t!==null&&(In(t,e,i,r),mo(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Kt(),r=pr(e),i=Kn(n,r);i.tag=2,t!=null&&(i.callback=t),t=dr(e,i,r),t!==null&&(In(t,e,r,n),mo(t,e,r))}};function bd(e,t,n,r,i,s,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,s,o):t.prototype&&t.prototype.isPureReactComponent?!ms(n,r)||!ms(i,s):!0}function ph(e,t,n){var r=!1,i=gr,s=t.contextType;return typeof s=="object"&&s!==null?s=wn(s):(i=en(t)?$r:zt.current,r=t.contextTypes,s=(r=r!=null)?vi(e,i):gr),t=new t(n,s),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=ga,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=s),t}function Td(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ga.enqueueReplaceState(t,t.state,null)}function Kl(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Xc(e);var s=t.contextType;typeof s=="object"&&s!==null?i.context=wn(s):(s=en(t)?$r:zt.current,i.context=vi(e,s)),i.state=e.memoizedState,s=t.getDerivedStateFromProps,typeof s=="function"&&(Bl(e,t,s,n),i.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(t=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),t!==i.state&&ga.enqueueReplaceState(i,i.state,null),Xo(e,n,i,r),i.state=e.memoizedState),typeof i.componentDidMount=="function"&&(e.flags|=4194308)}function ki(e,t){try{var n="",r=t;do n+=Jg(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:e,source:t,stack:i,digest:null}}function el(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Xl(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var _0=typeof WeakMap=="function"?WeakMap:Map;function hh(e,t,n){n=Kn(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Go||(Go=!0,nc=r),Xl(e,t)},n}function mh(e,t,n){n=Kn(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){Xl(e,t)}}var s=e.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Xl(e,t),typeof r!="function"&&(fr===null?fr=new Set([this]):fr.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),n}function Pd(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new _0;var i=new Set;r.set(t,i)}else i=r.get(t),i===void 0&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=O0.bind(null,e,t,n),t.then(e,e))}function Id(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function jd(e,t,n,r,i){return e.mode&1?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Kn(-1,1),t.tag=2,dr(n,t,1))),n.lanes|=1),e)}var C0=Jn.ReactCurrentOwner,qt=!1;function Bt(e,t,n,r){t.child=e===null?Bp(t,null,n,r):xi(t,e.child,n,r)}function Ad(e,t,n,r,i){n=n.render;var s=t.ref;return hi(t,i),r=Gc(e,t,n,r,s,i),n=qc(),e!==null&&!qt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Qn(e,t,i)):(rt&&n&&Fc(t),t.flags|=1,Bt(e,t,r,i),t.child)}function Rd(e,t,n,r,i){if(e===null){var s=n.type;return typeof s=="function"&&!lu(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=s,gh(e,t,s,r,i)):(e=So(n.type,null,r,t,t.mode,i),e.ref=t.ref,e.return=t,t.child=e)}if(s=e.child,!(e.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:ms,n(o,r)&&e.ref===t.ref)return Qn(e,t,i)}return t.flags|=1,e=hr(s,r),e.ref=t.ref,e.return=t,t.child=e}function gh(e,t,n,r,i){if(e!==null){var s=e.memoizedProps;if(ms(s,r)&&e.ref===t.ref)if(qt=!1,t.pendingProps=r=s,(e.lanes&i)!==0)e.flags&131072&&(qt=!0);else return t.lanes=e.lanes,Qn(e,t,i)}return Vl(e,t,n,r,i)}function yh(e,t,n){var r=t.pendingProps,i=r.children,s=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},qe(li,ln),ln|=n;else{if(!(n&1073741824))return e=s!==null?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,qe(li,ln),ln|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,qe(li,ln),ln|=r}else s!==null?(r=s.baseLanes|n,t.memoizedState=null):r=n,qe(li,ln),ln|=r;return Bt(e,t,i,n),t.child}function vh(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Vl(e,t,n,r,i){var s=en(n)?$r:zt.current;return s=vi(t,s),hi(t,i),n=Gc(e,t,n,r,s,i),r=qc(),e!==null&&!qt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Qn(e,t,i)):(rt&&r&&Fc(t),t.flags|=1,Bt(e,t,n,i),t.child)}function Md(e,t,n,r,i){if(en(n)){var s=!0;Uo(t)}else s=!1;if(hi(t,i),t.stateNode===null)vo(e,t),ph(t,n,r),Kl(t,n,r,i),r=!0;else if(e===null){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=wn(c):(c=en(n)?$r:zt.current,c=vi(t,c));var d=n.getDerivedStateFromProps,f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&Td(t,o,r,c),nr=!1;var m=t.memoizedState;o.state=m,Xo(t,r,o,i),l=t.memoizedState,a!==r||m!==l||Zt.current||nr?(typeof d=="function"&&(Bl(t,n,d,r),l=t.memoizedState),(a=nr||bd(t,n,a,r,m,l,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Xp(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:Cn(t.type,a),o.props=c,f=t.pendingProps,m=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=wn(l):(l=en(n)?$r:zt.current,l=vi(t,l));var g=n.getDerivedStateFromProps;(d=typeof g=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||m!==l)&&Td(t,o,r,l),nr=!1,m=t.memoizedState,o.state=m,Xo(t,r,o,i);var v=t.memoizedState;a!==f||m!==v||Zt.current||nr?(typeof g=="function"&&(Bl(t,n,g,r),v=t.memoizedState),(c=nr||bd(t,n,c,r,m,v,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,v,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,v,l)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=v),o.props=r,o.state=v,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),r=!1)}return Yl(e,t,n,r,s,i)}function Yl(e,t,n,r,i,s){vh(e,t);var o=(t.flags&128)!==0;if(!r&&!o)return i&&vd(t,n,!1),Qn(e,t,s);r=t.stateNode,C0.current=t;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&o?(t.child=xi(t,e.child,null,s),t.child=xi(t,null,a,s)):Bt(e,t,a,s),t.memoizedState=r.state,i&&vd(t,n,!0),t.child}function wh(e){var t=e.stateNode;t.pendingContext?yd(e,t.pendingContext,t.pendingContext!==t.context):t.context&&yd(e,t.context,!1),Vc(e,t.containerInfo)}function $d(e,t,n,r,i){return wi(),Uc(i),t.flags|=256,Bt(e,t,n,r),t.child}var Ql={dehydrated:null,treeContext:null,retryLane:0};function Jl(e){return{baseLanes:e,cachePool:null,transitions:null}}function xh(e,t,n){var r=t.pendingProps,i=it.current,s=!1,o=(t.flags&128)!==0,a;if((a=o)||(a=e!==null&&e.memoizedState===null?!1:(i&2)!==0),a?(s=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(i|=1),qe(it,i&1),e===null)return Hl(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=r.children,e=r.fallback,s?(r=t.mode,s=t.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=wa(o,r,0,null),e=Mr(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Jl(n),t.memoizedState=Ql,e):tu(t,o));if(i=e.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return E0(e,t,o,r,a,i,n);if(s){s=r.fallback,o=t.mode,i=e.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&t.child!==i?(r=t.child,r.childLanes=0,r.pendingProps=l,t.deletions=null):(r=hr(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=hr(a,s):(s=Mr(s,o,n,null),s.flags|=2),s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,o=e.child.memoizedState,o=o===null?Jl(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=e.childLanes&~n,t.memoizedState=Ql,r}return s=e.child,e=s.sibling,r=hr(s,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function tu(e,t){return t=wa({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Js(e,t,n,r){return r!==null&&Uc(r),xi(t,e.child,null,n),e=tu(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function E0(e,t,n,r,i,s,o){if(n)return t.flags&256?(t.flags&=-257,r=el(Error(Q(422))),Js(e,t,o,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(s=r.fallback,i=t.mode,r=wa({mode:"visible",children:r.children},i,0,null),s=Mr(s,i,o,null),s.flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,t.mode&1&&xi(t,e.child,null,o),t.child.memoizedState=Jl(o),t.memoizedState=Ql,s);if(!(t.mode&1))return Js(e,t,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(Q(419)),r=el(s,r,void 0),Js(e,t,o,r)}if(a=(o&e.childLanes)!==0,qt||a){if(r=It,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Yn(e,i),In(r,e,i,-1))}return au(),r=el(Error(Q(421))),Js(e,t,o,r)}return i.data==="$?"?(t.flags|=128,t.child=e.child,t=L0.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,cn=ur(i.nextSibling),un=t,rt=!0,Tn=null,e!==null&&(hn[mn++]=Wn,hn[mn++]=Bn,hn[mn++]=Nr,Wn=e.id,Bn=e.overflow,Nr=t),t=tu(t,r.children),t.flags|=4096,t)}function Nd(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Wl(e.return,t,n)}function tl(e,t,n,r,i){var s=e.memoizedState;s===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Sh(e,t,n){var r=t.pendingProps,i=r.revealOrder,s=r.tail;if(Bt(e,t,r.children,n),r=it.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Nd(e,n,t);else if(e.tag===19)Nd(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(qe(it,r),!(t.mode&1))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;n!==null;)e=n.alternate,e!==null&&Vo(e)===null&&(i=n),n=n.sibling;n=i,n===null?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),tl(t,!1,i,n,s);break;case"backwards":for(n=null,i=t.child,t.child=null;i!==null;){if(e=i.alternate,e!==null&&Vo(e)===null){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}tl(t,!0,n,null,s);break;case"together":tl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function vo(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Qn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Or|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Q(153));if(t.child!==null){for(e=t.child,n=hr(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=hr(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function b0(e,t,n){switch(t.tag){case 3:wh(t),wi();break;case 5:Vp(t);break;case 1:en(t.type)&&Uo(t);break;case 4:Vc(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;qe(Bo,r._currentValue),r._currentValue=i;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(qe(it,it.current&1),t.flags|=128,null):n&t.child.childLanes?xh(e,t,n):(qe(it,it.current&1),e=Qn(e,t,n),e!==null?e.sibling:null);qe(it,it.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return Sh(e,t,n);t.flags|=128}if(i=t.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),qe(it,it.current),r)break;return null;case 22:case 23:return t.lanes=0,yh(e,t,n)}return Qn(e,t,n)}var kh,Gl,_h,Ch;kh=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Gl=function(){};_h=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Ir(Ln.current);var s=null;switch(n){case"input":i=wl(e,i),r=wl(e,r),s=[];break;case"select":i=ot({},i,{value:void 0}),r=ot({},r,{value:void 0}),s=[];break;case"textarea":i=kl(e,i),r=kl(e,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Fo)}Cl(n,r);var o;n=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(ls.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(ls.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&tt("scroll",e),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(t.updateQueue=c)&&(t.flags|=4)}};Ch=function(e,t,n,r){n!==r&&(t.flags|=4)};function Ni(e,t){if(!rt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ot(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=e,i=i.sibling;else for(i=e.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function T0(e,t,n){var r=t.pendingProps;switch(zc(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ot(t),null;case 1:return en(t.type)&&zo(),Ot(t),null;case 3:return r=t.stateNode,Si(),nt(Zt),nt(zt),Qc(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Ys(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Tn!==null&&(sc(Tn),Tn=null))),Gl(e,t),Ot(t),null;case 5:Yc(t);var i=Ir(xs.current);if(n=t.type,e!==null&&t.stateNode!=null)_h(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(Q(166));return Ot(t),null}if(e=Ir(Ln.current),Ys(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[Nn]=t,r[vs]=s,e=(t.mode&1)!==0,n){case"dialog":tt("cancel",r),tt("close",r);break;case"iframe":case"object":case"embed":tt("load",r);break;case"video":case"audio":for(i=0;i<zi.length;i++)tt(zi[i],r);break;case"source":tt("error",r);break;case"img":case"image":case"link":tt("error",r),tt("load",r);break;case"details":tt("toggle",r);break;case"input":Bu(r,s),tt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},tt("invalid",r);break;case"textarea":Xu(r,s),tt("invalid",r)}Cl(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Vs(r.textContent,a,e),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Vs(r.textContent,a,e),i=["children",""+a]):ls.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&tt("scroll",r)}switch(n){case"input":Fs(r),Ku(r,s,!0);break;case"textarea":Fs(r),Vu(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Fo)}r=i,t.updateQueue=r,r!==null&&(t.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=qf(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=o.createElement(n,{is:r.is}):(e=o.createElement(n),n==="select"&&(o=e,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):e=o.createElementNS(e,n),e[Nn]=t,e[vs]=r,kh(e,t,!1,!1),t.stateNode=e;e:{switch(o=El(n,r),n){case"dialog":tt("cancel",e),tt("close",e),i=r;break;case"iframe":case"object":case"embed":tt("load",e),i=r;break;case"video":case"audio":for(i=0;i<zi.length;i++)tt(zi[i],e);i=r;break;case"source":tt("error",e),i=r;break;case"img":case"image":case"link":tt("error",e),tt("load",e),i=r;break;case"details":tt("toggle",e),i=r;break;case"input":Bu(e,r),i=wl(e,r),tt("invalid",e);break;case"option":i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=ot({},r,{value:void 0}),tt("invalid",e);break;case"textarea":Xu(e,r),i=kl(e,r),tt("invalid",e);break;default:i=r}Cl(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?tp(e,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Zf(e,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&cs(e,l):typeof l=="number"&&cs(e,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(ls.hasOwnProperty(s)?l!=null&&s==="onScroll"&&tt("scroll",e):l!=null&&Ec(e,s,l,o))}switch(n){case"input":Fs(e),Ku(e,r,!1);break;case"textarea":Fs(e),Vu(e);break;case"option":r.value!=null&&e.setAttribute("value",""+mr(r.value));break;case"select":e.multiple=!!r.multiple,s=r.value,s!=null?ui(e,!!r.multiple,s,!1):r.defaultValue!=null&&ui(e,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(e.onclick=Fo)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ot(t),null;case 6:if(e&&t.stateNode!=null)Ch(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(Q(166));if(n=Ir(xs.current),Ir(Ln.current),Ys(t)){if(r=t.stateNode,n=t.memoizedProps,r[Nn]=t,(s=r.nodeValue!==n)&&(e=un,e!==null))switch(e.tag){case 3:Vs(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Vs(r.nodeValue,n,(e.mode&1)!==0)}s&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Nn]=t,t.stateNode=r}return Ot(t),null;case 13:if(nt(it),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(rt&&cn!==null&&t.mode&1&&!(t.flags&128))Hp(),wi(),t.flags|=98560,s=!1;else if(s=Ys(t),r!==null&&r.dehydrated!==null){if(e===null){if(!s)throw Error(Q(318));if(s=t.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Q(317));s[Nn]=t}else wi(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Ot(t),s=!1}else Tn!==null&&(sc(Tn),Tn=null),s=!0;if(!s)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||it.current&1?Et===0&&(Et=3):au())),t.updateQueue!==null&&(t.flags|=4),Ot(t),null);case 4:return Si(),Gl(e,t),e===null&&gs(t.stateNode.containerInfo),Ot(t),null;case 10:return Bc(t.type._context),Ot(t),null;case 17:return en(t.type)&&zo(),Ot(t),null;case 19:if(nt(it),s=t.memoizedState,s===null)return Ot(t),null;if(r=(t.flags&128)!==0,o=s.rendering,o===null)if(r)Ni(s,!1);else{if(Et!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=Vo(e),o!==null){for(t.flags|=128,Ni(s,!1),r=o.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)s=n,e=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,e=o.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return qe(it,it.current&1|2),t.child}e=e.sibling}s.tail!==null&&pt()>_i&&(t.flags|=128,r=!0,Ni(s,!1),t.lanes=4194304)}else{if(!r)if(e=Vo(o),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Ni(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!rt)return Ot(t),null}else 2*pt()-s.renderingStartTime>_i&&n!==1073741824&&(t.flags|=128,r=!0,Ni(s,!1),t.lanes=4194304);s.isBackwards?(o.sibling=t.child,t.child=o):(n=s.last,n!==null?n.sibling=o:t.child=o,s.last=o)}return s.tail!==null?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=pt(),t.sibling=null,n=it.current,qe(it,r?n&1|2:n&1),t):(Ot(t),null);case 22:case 23:return ou(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?ln&1073741824&&(Ot(t),t.subtreeFlags&6&&(t.flags|=8192)):Ot(t),null;case 24:return null;case 25:return null}throw Error(Q(156,t.tag))}function P0(e,t){switch(zc(t),t.tag){case 1:return en(t.type)&&zo(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Si(),nt(Zt),nt(zt),Qc(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Yc(t),null;case 13:if(nt(it),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Q(340));wi()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return nt(it),null;case 4:return Si(),null;case 10:return Bc(t.type._context),null;case 22:case 23:return ou(),null;case 24:return null;default:return null}}var Gs=!1,Ft=!1,I0=typeof WeakSet=="function"?WeakSet:Set,pe=null;function ai(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ut(e,t,r)}else n.current=null}function ql(e,t,n){try{n()}catch(r){ut(e,t,r)}}var Dd=!1;function j0(e,t){if(Nl=Do,e=Ip(),Lc(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,d=0,f=e,m=null;t:for(;;){for(var g;f!==n||i!==0&&f.nodeType!==3||(a=o+i),f!==s||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(g=f.firstChild)!==null;)m=f,f=g;for(;;){if(f===e)break t;if(m===n&&++c===i&&(a=o),m===s&&++d===r&&(l=o),(g=f.nextSibling)!==null)break;f=m,m=f.parentNode}f=g}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Dl={focusedElem:e,selectionRange:n},Do=!1,pe=t;pe!==null;)if(t=pe,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,pe=e;else for(;pe!==null;){t=pe;try{var v=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var w=v.memoizedProps,j=v.memoizedState,h=t.stateNode,u=h.getSnapshotBeforeUpdate(t.elementType===t.type?w:Cn(t.type,w),j);h.__reactInternalSnapshotBeforeUpdate=u}break;case 3:var p=t.stateNode.containerInfo;p.nodeType===1?p.textContent="":p.nodeType===9&&p.documentElement&&p.removeChild(p.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Q(163))}}catch(x){ut(t,t.return,x)}if(e=t.sibling,e!==null){e.return=t.return,pe=e;break}pe=t.return}return v=Dd,Dd=!1,v}function ns(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&e)===e){var s=i.destroy;i.destroy=void 0,s!==void 0&&ql(t,n,s)}i=i.next}while(i!==r)}}function ya(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function Zl(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function Eh(e){var t=e.alternate;t!==null&&(e.alternate=null,Eh(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Nn],delete t[vs],delete t[Fl],delete t[f0],delete t[p0])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function bh(e){return e.tag===5||e.tag===3||e.tag===4}function Od(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||bh(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ec(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Fo));else if(r!==4&&(e=e.child,e!==null))for(ec(e,t,n),e=e.sibling;e!==null;)ec(e,t,n),e=e.sibling}function tc(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(tc(e,t,n),e=e.sibling;e!==null;)tc(e,t,n),e=e.sibling}var At=null,bn=!1;function Gn(e,t,n){for(n=n.child;n!==null;)Th(e,t,n),n=n.sibling}function Th(e,t,n){if(On&&typeof On.onCommitFiberUnmount=="function")try{On.onCommitFiberUnmount(ca,n)}catch{}switch(n.tag){case 5:Ft||ai(n,t);case 6:var r=At,i=bn;At=null,Gn(e,t,n),At=r,bn=i,At!==null&&(bn?(e=At,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):At.removeChild(n.stateNode));break;case 18:At!==null&&(bn?(e=At,n=n.stateNode,e.nodeType===8?Ya(e.parentNode,n):e.nodeType===1&&Ya(e,n),ps(e)):Ya(At,n.stateNode));break;case 4:r=At,i=bn,At=n.stateNode.containerInfo,bn=!0,Gn(e,t,n),At=r,bn=i;break;case 0:case 11:case 14:case 15:if(!Ft&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&ql(n,t,o),i=i.next}while(i!==r)}Gn(e,t,n);break;case 1:if(!Ft&&(ai(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){ut(n,t,a)}Gn(e,t,n);break;case 21:Gn(e,t,n);break;case 22:n.mode&1?(Ft=(r=Ft)||n.memoizedState!==null,Gn(e,t,n),Ft=r):Gn(e,t,n);break;default:Gn(e,t,n)}}function Ld(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new I0),t.forEach(function(r){var i=F0.bind(null,e,r);n.has(r)||(n.add(r),r.then(i,i))})}}function _n(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e,o=t,a=o;e:for(;a!==null;){switch(a.tag){case 5:At=a.stateNode,bn=!1;break e;case 3:At=a.stateNode.containerInfo,bn=!0;break e;case 4:At=a.stateNode.containerInfo,bn=!0;break e}a=a.return}if(At===null)throw Error(Q(160));Th(s,o,i),At=null,bn=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){ut(i,t,c)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Ph(t,e),t=t.sibling}function Ph(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(_n(t,e),An(e),r&4){try{ns(3,e,e.return),ya(3,e)}catch(w){ut(e,e.return,w)}try{ns(5,e,e.return)}catch(w){ut(e,e.return,w)}}break;case 1:_n(t,e),An(e),r&512&&n!==null&&ai(n,n.return);break;case 5:if(_n(t,e),An(e),r&512&&n!==null&&ai(n,n.return),e.flags&32){var i=e.stateNode;try{cs(i,"")}catch(w){ut(e,e.return,w)}}if(r&4&&(i=e.stateNode,i!=null)){var s=e.memoizedProps,o=n!==null?n.memoizedProps:s,a=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&Jf(i,s),El(a,o);var c=El(a,s);for(o=0;o<l.length;o+=2){var d=l[o],f=l[o+1];d==="style"?tp(i,f):d==="dangerouslySetInnerHTML"?Zf(i,f):d==="children"?cs(i,f):Ec(i,d,f,c)}switch(a){case"input":xl(i,s);break;case"textarea":Gf(i,s);break;case"select":var m=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var g=s.value;g!=null?ui(i,!!s.multiple,g,!1):m!==!!s.multiple&&(s.defaultValue!=null?ui(i,!!s.multiple,s.defaultValue,!0):ui(i,!!s.multiple,s.multiple?[]:"",!1))}i[vs]=s}catch(w){ut(e,e.return,w)}}break;case 6:if(_n(t,e),An(e),r&4){if(e.stateNode===null)throw Error(Q(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(w){ut(e,e.return,w)}}break;case 3:if(_n(t,e),An(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ps(t.containerInfo)}catch(w){ut(e,e.return,w)}break;case 4:_n(t,e),An(e);break;case 13:_n(t,e),An(e),i=e.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(iu=pt())),r&4&&Ld(e);break;case 22:if(d=n!==null&&n.memoizedState!==null,e.mode&1?(Ft=(c=Ft)||d,_n(t,e),Ft=c):_n(t,e),An(e),r&8192){if(c=e.memoizedState!==null,(e.stateNode.isHidden=c)&&!d&&e.mode&1)for(pe=e,d=e.child;d!==null;){for(f=pe=d;pe!==null;){switch(m=pe,g=m.child,m.tag){case 0:case 11:case 14:case 15:ns(4,m,m.return);break;case 1:ai(m,m.return);var v=m.stateNode;if(typeof v.componentWillUnmount=="function"){r=m,n=m.return;try{t=r,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(w){ut(r,n,w)}}break;case 5:ai(m,m.return);break;case 22:if(m.memoizedState!==null){zd(f);continue}}g!==null?(g.return=m,pe=g):zd(f)}d=d.sibling}e:for(d=null,f=e;;){if(f.tag===5){if(d===null){d=f;try{i=f.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=ep("display",o))}catch(w){ut(e,e.return,w)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(w){ut(e,e.return,w)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===e)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;f.sibling===null;){if(f.return===null||f.return===e)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:_n(t,e),An(e),r&4&&Ld(e);break;case 21:break;default:_n(t,e),An(e)}}function An(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(bh(n)){var r=n;break e}n=n.return}throw Error(Q(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(cs(i,""),r.flags&=-33);var s=Od(e);tc(e,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Od(e);ec(e,a,o);break;default:throw Error(Q(161))}}catch(l){ut(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function A0(e,t,n){pe=e,Ih(e)}function Ih(e,t,n){for(var r=(e.mode&1)!==0;pe!==null;){var i=pe,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Gs;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Ft;a=Gs;var c=Ft;if(Gs=o,(Ft=l)&&!c)for(pe=i;pe!==null;)o=pe,l=o.child,o.tag===22&&o.memoizedState!==null?Ud(i):l!==null?(l.return=o,pe=l):Ud(i);for(;s!==null;)pe=s,Ih(s),s=s.sibling;pe=i,Gs=a,Ft=c}Fd(e)}else i.subtreeFlags&8772&&s!==null?(s.return=i,pe=s):Fd(e)}}function Fd(e){for(;pe!==null;){var t=pe;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ft||ya(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Ft)if(n===null)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:Cn(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;s!==null&&_d(t,s,r);break;case 3:var o=t.updateQueue;if(o!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}_d(t,o,n)}break;case 5:var a=t.stateNode;if(n===null&&t.flags&4){n=a;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var c=t.alternate;if(c!==null){var d=c.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&ps(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Q(163))}Ft||t.flags&512&&Zl(t)}catch(m){ut(t,t.return,m)}}if(t===e){pe=null;break}if(n=t.sibling,n!==null){n.return=t.return,pe=n;break}pe=t.return}}function zd(e){for(;pe!==null;){var t=pe;if(t===e){pe=null;break}var n=t.sibling;if(n!==null){n.return=t.return,pe=n;break}pe=t.return}}function Ud(e){for(;pe!==null;){var t=pe;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ya(4,t)}catch(l){ut(t,n,l)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var i=t.return;try{r.componentDidMount()}catch(l){ut(t,i,l)}}var s=t.return;try{Zl(t)}catch(l){ut(t,s,l)}break;case 5:var o=t.return;try{Zl(t)}catch(l){ut(t,o,l)}}}catch(l){ut(t,t.return,l)}if(t===e){pe=null;break}var a=t.sibling;if(a!==null){a.return=t.return,pe=a;break}pe=t.return}}var R0=Math.ceil,Jo=Jn.ReactCurrentDispatcher,nu=Jn.ReactCurrentOwner,vn=Jn.ReactCurrentBatchConfig,Ke=0,It=null,gt=null,Mt=0,ln=0,li=vr(0),Et=0,Cs=null,Or=0,va=0,ru=0,rs=null,Gt=null,iu=0,_i=1/0,Un=null,Go=!1,nc=null,fr=null,qs=!1,or=null,qo=0,is=0,rc=null,wo=-1,xo=0;function Kt(){return Ke&6?pt():wo!==-1?wo:wo=pt()}function pr(e){return e.mode&1?Ke&2&&Mt!==0?Mt&-Mt:m0.transition!==null?(xo===0&&(xo=pp()),xo):(e=Qe,e!==0||(e=window.event,e=e===void 0?16:xp(e.type)),e):1}function In(e,t,n,r){if(50<is)throw is=0,rc=null,Error(Q(185));Ts(e,n,r),(!(Ke&2)||e!==It)&&(e===It&&(!(Ke&2)&&(va|=n),Et===4&&ir(e,Mt)),tn(e,r),n===1&&Ke===0&&!(t.mode&1)&&(_i=pt()+500,ha&&wr()))}function tn(e,t){var n=e.callbackNode;my(e,t);var r=No(e,e===It?Mt:0);if(r===0)n!==null&&Ju(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&Ju(n),t===1)e.tag===0?h0(Hd.bind(null,e)):Fp(Hd.bind(null,e)),u0(function(){!(Ke&6)&&wr()}),n=null;else{switch(hp(r)){case 1:n=jc;break;case 4:n=dp;break;case 16:n=$o;break;case 536870912:n=fp;break;default:n=$o}n=Oh(n,jh.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function jh(e,t){if(wo=-1,xo=0,Ke&6)throw Error(Q(327));var n=e.callbackNode;if(mi()&&e.callbackNode!==n)return null;var r=No(e,e===It?Mt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=Zo(e,r);else{t=r;var i=Ke;Ke|=2;var s=Rh();(It!==e||Mt!==t)&&(Un=null,_i=pt()+500,Rr(e,t));do try{N0();break}catch(a){Ah(e,a)}while(1);Wc(),Jo.current=s,Ke=i,gt!==null?t=0:(It=null,Mt=0,t=Et)}if(t!==0){if(t===2&&(i=jl(e),i!==0&&(r=i,t=ic(e,i))),t===1)throw n=Cs,Rr(e,0),ir(e,r),tn(e,pt()),n;if(t===6)ir(e,r);else{if(i=e.current.alternate,!(r&30)&&!M0(i)&&(t=Zo(e,r),t===2&&(s=jl(e),s!==0&&(r=s,t=ic(e,s))),t===1))throw n=Cs,Rr(e,0),ir(e,r),tn(e,pt()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(Q(345));case 2:Cr(e,Gt,Un);break;case 3:if(ir(e,r),(r&130023424)===r&&(t=iu+500-pt(),10<t)){if(No(e,0)!==0)break;if(i=e.suspendedLanes,(i&r)!==r){Kt(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Ll(Cr.bind(null,e,Gt,Un),t);break}Cr(e,Gt,Un);break;case 4:if(ir(e,r),(r&4194240)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-Pn(r);s=1<<o,o=t[o],o>i&&(i=o),r&=~s}if(r=i,r=pt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*R0(r/1960))-r,10<r){e.timeoutHandle=Ll(Cr.bind(null,e,Gt,Un),r);break}Cr(e,Gt,Un);break;case 5:Cr(e,Gt,Un);break;default:throw Error(Q(329))}}}return tn(e,pt()),e.callbackNode===n?jh.bind(null,e):null}function ic(e,t){var n=rs;return e.current.memoizedState.isDehydrated&&(Rr(e,t).flags|=256),e=Zo(e,t),e!==2&&(t=Gt,Gt=n,t!==null&&sc(t)),e}function sc(e){Gt===null?Gt=e:Gt.push.apply(Gt,e)}function M0(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!jn(s(),i))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ir(e,t){for(t&=~ru,t&=~va,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Pn(t),r=1<<n;e[n]=-1,t&=~r}}function Hd(e){if(Ke&6)throw Error(Q(327));mi();var t=No(e,0);if(!(t&1))return tn(e,pt()),null;var n=Zo(e,t);if(e.tag!==0&&n===2){var r=jl(e);r!==0&&(t=r,n=ic(e,r))}if(n===1)throw n=Cs,Rr(e,0),ir(e,t),tn(e,pt()),n;if(n===6)throw Error(Q(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Cr(e,Gt,Un),tn(e,pt()),null}function su(e,t){var n=Ke;Ke|=1;try{return e(t)}finally{Ke=n,Ke===0&&(_i=pt()+500,ha&&wr())}}function Lr(e){or!==null&&or.tag===0&&!(Ke&6)&&mi();var t=Ke;Ke|=1;var n=vn.transition,r=Qe;try{if(vn.transition=null,Qe=1,e)return e()}finally{Qe=r,vn.transition=n,Ke=t,!(Ke&6)&&wr()}}function ou(){ln=li.current,nt(li)}function Rr(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,c0(n)),gt!==null)for(n=gt.return;n!==null;){var r=n;switch(zc(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&zo();break;case 3:Si(),nt(Zt),nt(zt),Qc();break;case 5:Yc(r);break;case 4:Si();break;case 13:nt(it);break;case 19:nt(it);break;case 10:Bc(r.type._context);break;case 22:case 23:ou()}n=n.return}if(It=e,gt=e=hr(e.current,null),Mt=ln=t,Et=0,Cs=null,ru=va=Or=0,Gt=rs=null,Pr!==null){for(t=0;t<Pr.length;t++)if(n=Pr[t],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}Pr=null}return e}function Ah(e,t){do{var n=gt;try{if(Wc(),go.current=Qo,Yo){for(var r=st.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Yo=!1}if(Dr=0,Pt=Ct=st=null,ts=!1,Ss=0,nu.current=null,n===null||n.return===null){Et=1,Cs=t,gt=null;break}e:{var s=e,o=n.return,a=n,l=t;if(t=Mt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,d=a,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var m=d.alternate;m?(d.updateQueue=m.updateQueue,d.memoizedState=m.memoizedState,d.lanes=m.lanes):(d.updateQueue=null,d.memoizedState=null)}var g=Id(o);if(g!==null){g.flags&=-257,jd(g,o,a,s,t),g.mode&1&&Pd(s,c,t),t=g,l=c;var v=t.updateQueue;if(v===null){var w=new Set;w.add(l),t.updateQueue=w}else v.add(l);break e}else{if(!(t&1)){Pd(s,c,t),au();break e}l=Error(Q(426))}}else if(rt&&a.mode&1){var j=Id(o);if(j!==null){!(j.flags&65536)&&(j.flags|=256),jd(j,o,a,s,t),Uc(ki(l,a));break e}}s=l=ki(l,a),Et!==4&&(Et=2),rs===null?rs=[s]:rs.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t;var h=hh(s,l,t);kd(s,h);break e;case 1:a=l;var u=s.type,p=s.stateNode;if(!(s.flags&128)&&(typeof u.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(fr===null||!fr.has(p)))){s.flags|=65536,t&=-t,s.lanes|=t;var x=mh(s,a,t);kd(s,x);break e}}s=s.return}while(s!==null)}$h(n)}catch(S){t=S,gt===n&&n!==null&&(gt=n=n.return);continue}break}while(1)}function Rh(){var e=Jo.current;return Jo.current=Qo,e===null?Qo:e}function au(){(Et===0||Et===3||Et===2)&&(Et=4),It===null||!(Or&268435455)&&!(va&268435455)||ir(It,Mt)}function Zo(e,t){var n=Ke;Ke|=2;var r=Rh();(It!==e||Mt!==t)&&(Un=null,Rr(e,t));do try{$0();break}catch(i){Ah(e,i)}while(1);if(Wc(),Ke=n,Jo.current=r,gt!==null)throw Error(Q(261));return It=null,Mt=0,Et}function $0(){for(;gt!==null;)Mh(gt)}function N0(){for(;gt!==null&&!oy();)Mh(gt)}function Mh(e){var t=Dh(e.alternate,e,ln);e.memoizedProps=e.pendingProps,t===null?$h(e):gt=t,nu.current=null}function $h(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=P0(n,t),n!==null){n.flags&=32767,gt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Et=6,gt=null;return}}else if(n=T0(n,t,ln),n!==null){gt=n;return}if(t=t.sibling,t!==null){gt=t;return}gt=t=e}while(t!==null);Et===0&&(Et=5)}function Cr(e,t,n){var r=Qe,i=vn.transition;try{vn.transition=null,Qe=1,D0(e,t,n,r)}finally{vn.transition=i,Qe=r}return null}function D0(e,t,n,r){do mi();while(or!==null);if(Ke&6)throw Error(Q(327));n=e.finishedWork;var i=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Q(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(gy(e,s),e===It&&(gt=It=null,Mt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||qs||(qs=!0,Oh($o,function(){return mi(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=vn.transition,vn.transition=null;var o=Qe;Qe=1;var a=Ke;Ke|=4,nu.current=null,j0(e,n),Ph(n,e),n0(Dl),Do=!!Nl,Dl=Nl=null,e.current=n,A0(n),ay(),Ke=a,Qe=o,vn.transition=s}else e.current=n;if(qs&&(qs=!1,or=e,qo=i),s=e.pendingLanes,s===0&&(fr=null),uy(n.stateNode),tn(e,pt()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Go)throw Go=!1,e=nc,nc=null,e;return qo&1&&e.tag!==0&&mi(),s=e.pendingLanes,s&1?e===rc?is++:(is=0,rc=e):is=0,wr(),null}function mi(){if(or!==null){var e=hp(qo),t=vn.transition,n=Qe;try{if(vn.transition=null,Qe=16>e?16:e,or===null)var r=!1;else{if(e=or,or=null,qo=0,Ke&6)throw Error(Q(331));var i=Ke;for(Ke|=4,pe=e.current;pe!==null;){var s=pe,o=s.child;if(pe.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(pe=c;pe!==null;){var d=pe;switch(d.tag){case 0:case 11:case 15:ns(8,d,s)}var f=d.child;if(f!==null)f.return=d,pe=f;else for(;pe!==null;){d=pe;var m=d.sibling,g=d.return;if(Eh(d),d===c){pe=null;break}if(m!==null){m.return=g,pe=m;break}pe=g}}}var v=s.alternate;if(v!==null){var w=v.child;if(w!==null){v.child=null;do{var j=w.sibling;w.sibling=null,w=j}while(w!==null)}}pe=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,pe=o;else e:for(;pe!==null;){if(s=pe,s.flags&2048)switch(s.tag){case 0:case 11:case 15:ns(9,s,s.return)}var h=s.sibling;if(h!==null){h.return=s.return,pe=h;break e}pe=s.return}}var u=e.current;for(pe=u;pe!==null;){o=pe;var p=o.child;if(o.subtreeFlags&2064&&p!==null)p.return=o,pe=p;else e:for(o=u;pe!==null;){if(a=pe,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ya(9,a)}}catch(S){ut(a,a.return,S)}if(a===o){pe=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,pe=x;break e}pe=a.return}}if(Ke=i,wr(),On&&typeof On.onPostCommitFiberRoot=="function")try{On.onPostCommitFiberRoot(ca,e)}catch{}r=!0}return r}finally{Qe=n,vn.transition=t}}return!1}function Wd(e,t,n){t=ki(n,t),t=hh(e,t,1),e=dr(e,t,1),t=Kt(),e!==null&&(Ts(e,1,t),tn(e,t))}function ut(e,t,n){if(e.tag===3)Wd(e,e,n);else for(;t!==null;){if(t.tag===3){Wd(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(fr===null||!fr.has(r))){e=ki(n,e),e=mh(t,e,1),t=dr(t,e,1),e=Kt(),t!==null&&(Ts(t,1,e),tn(t,e));break}}t=t.return}}function O0(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Kt(),e.pingedLanes|=e.suspendedLanes&n,It===e&&(Mt&n)===n&&(Et===4||Et===3&&(Mt&130023424)===Mt&&500>pt()-iu?Rr(e,0):ru|=n),tn(e,t)}function Nh(e,t){t===0&&(e.mode&1?(t=Hs,Hs<<=1,!(Hs&130023424)&&(Hs=4194304)):t=1);var n=Kt();e=Yn(e,t),e!==null&&(Ts(e,t,n),tn(e,n))}function L0(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),Nh(e,n)}function F0(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(Q(314))}r!==null&&r.delete(t),Nh(e,n)}var Dh;Dh=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Zt.current)qt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return qt=!1,b0(e,t,n);qt=!!(e.flags&131072)}else qt=!1,rt&&t.flags&1048576&&zp(t,Wo,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;vo(e,t),e=t.pendingProps;var i=vi(t,zt.current);hi(t,n),i=Gc(null,t,r,e,i,n);var s=qc();return t.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,en(r)?(s=!0,Uo(t)):s=!1,t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Xc(t),i.updater=ga,t.stateNode=i,i._reactInternals=t,Kl(t,r,e,n),t=Yl(null,t,r,!0,s,n)):(t.tag=0,rt&&s&&Fc(t),Bt(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(vo(e,t),e=t.pendingProps,i=r._init,r=i(r._payload),t.type=r,i=t.tag=U0(r),e=Cn(r,e),i){case 0:t=Vl(null,t,r,e,n);break e;case 1:t=Md(null,t,r,e,n);break e;case 11:t=Ad(null,t,r,e,n);break e;case 14:t=Rd(null,t,r,Cn(r.type,e),n);break e}throw Error(Q(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Cn(r,i),Vl(e,t,r,i,n);case 1:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Cn(r,i),Md(e,t,r,i,n);case 3:e:{if(wh(t),e===null)throw Error(Q(387));r=t.pendingProps,s=t.memoizedState,i=s.element,Xp(e,t),Xo(t,r,null,n);var o=t.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,t.flags&256){i=ki(Error(Q(423)),t),t=$d(e,t,r,n,i);break e}else if(r!==i){i=ki(Error(Q(424)),t),t=$d(e,t,r,n,i);break e}else for(cn=ur(t.stateNode.containerInfo.firstChild),un=t,rt=!0,Tn=null,n=Bp(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(wi(),r===i){t=Qn(e,t,n);break e}Bt(e,t,r,n)}t=t.child}return t;case 5:return Vp(t),e===null&&Hl(t),r=t.type,i=t.pendingProps,s=e!==null?e.memoizedProps:null,o=i.children,Ol(r,i)?o=null:s!==null&&Ol(r,s)&&(t.flags|=32),vh(e,t),Bt(e,t,o,n),t.child;case 6:return e===null&&Hl(t),null;case 13:return xh(e,t,n);case 4:return Vc(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=xi(t,null,r,n):Bt(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Cn(r,i),Ad(e,t,r,i,n);case 7:return Bt(e,t,t.pendingProps,n),t.child;case 8:return Bt(e,t,t.pendingProps.children,n),t.child;case 12:return Bt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,o=i.value,qe(Bo,r._currentValue),r._currentValue=o,s!==null)if(jn(s.value,o)){if(s.children===i.children&&!Zt.current){t=Qn(e,t,n);break e}}else for(s=t.child,s!==null&&(s.return=t);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=Kn(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var d=c.pending;d===null?l.next=l:(l.next=d.next,d.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Wl(s.return,n,t),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===t.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Q(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Wl(o,n,t),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===t){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Bt(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,hi(t,n),i=wn(i),r=r(i),t.flags|=1,Bt(e,t,r,n),t.child;case 14:return r=t.type,i=Cn(r,t.pendingProps),i=Cn(r.type,i),Rd(e,t,r,i,n);case 15:return gh(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Cn(r,i),vo(e,t),t.tag=1,en(r)?(e=!0,Uo(t)):e=!1,hi(t,n),ph(t,r,i),Kl(t,r,i,n),Yl(null,t,r,!0,e,n);case 19:return Sh(e,t,n);case 22:return yh(e,t,n)}throw Error(Q(156,t.tag))};function Oh(e,t){return up(e,t)}function z0(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gn(e,t,n,r){return new z0(e,t,n,r)}function lu(e){return e=e.prototype,!(!e||!e.isReactComponent)}function U0(e){if(typeof e=="function")return lu(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Tc)return 11;if(e===Pc)return 14}return 2}function hr(e,t){var n=e.alternate;return n===null?(n=gn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function So(e,t,n,r,i,s){var o=2;if(r=e,typeof e=="function")lu(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case qr:return Mr(n.children,i,s,t);case bc:o=8,i|=8;break;case ml:return e=gn(12,n,t,i|2),e.elementType=ml,e.lanes=s,e;case gl:return e=gn(13,n,t,i),e.elementType=gl,e.lanes=s,e;case yl:return e=gn(19,n,t,i),e.elementType=yl,e.lanes=s,e;case Vf:return wa(n,i,s,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Kf:o=10;break e;case Xf:o=9;break e;case Tc:o=11;break e;case Pc:o=14;break e;case tr:o=16,r=null;break e}throw Error(Q(130,e==null?e:typeof e,""))}return t=gn(o,n,t,i),t.elementType=e,t.type=r,t.lanes=s,t}function Mr(e,t,n,r){return e=gn(7,e,r,t),e.lanes=n,e}function wa(e,t,n,r){return e=gn(22,e,r,t),e.elementType=Vf,e.lanes=n,e.stateNode={isHidden:!1},e}function nl(e,t,n){return e=gn(6,e,null,t),e.lanes=n,e}function rl(e,t,n){return t=gn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function H0(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Oa(0),this.expirationTimes=Oa(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Oa(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function cu(e,t,n,r,i,s,o,a,l){return e=new H0(e,t,n,a,l),t===1?(t=1,s===!0&&(t|=8)):t=0,s=gn(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Xc(s),e}function W0(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Gr,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function Lh(e){if(!e)return gr;e=e._reactInternals;e:{if(Ur(e)!==e||e.tag!==1)throw Error(Q(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(en(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Q(171))}if(e.tag===1){var n=e.type;if(en(n))return Lp(e,n,t)}return t}function Fh(e,t,n,r,i,s,o,a,l){return e=cu(n,r,!0,e,i,s,o,a,l),e.context=Lh(null),n=e.current,r=Kt(),i=pr(n),s=Kn(r,i),s.callback=t??null,dr(n,s,i),e.current.lanes=i,Ts(e,i,r),tn(e,r),e}function xa(e,t,n,r){var i=t.current,s=Kt(),o=pr(i);return n=Lh(n),t.context===null?t.context=n:t.pendingContext=n,t=Kn(s,o),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=dr(i,t,o),e!==null&&(In(e,i,o,s),mo(e,i,o)),o}function ea(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Bd(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function uu(e,t){Bd(e,t),(e=e.alternate)&&Bd(e,t)}function B0(){return null}var zh=typeof reportError=="function"?reportError:function(e){console.error(e)};function du(e){this._internalRoot=e}Sa.prototype.render=du.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Q(409));xa(e,t,null,null)};Sa.prototype.unmount=du.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Lr(function(){xa(null,e,null,null)}),t[Vn]=null}};function Sa(e){this._internalRoot=e}Sa.prototype.unstable_scheduleHydration=function(e){if(e){var t=yp();e={blockedOn:null,target:e,priority:t};for(var n=0;n<rr.length&&t!==0&&t<rr[n].priority;n++);rr.splice(n,0,e),n===0&&wp(e)}};function fu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ka(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Kd(){}function K0(e,t,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=ea(o);s.call(c)}}var o=Fh(t,r,e,0,null,!1,!1,"",Kd);return e._reactRootContainer=o,e[Vn]=o.current,gs(e.nodeType===8?e.parentNode:e),Lr(),o}for(;i=e.lastChild;)e.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=ea(l);a.call(c)}}var l=cu(e,0,!1,null,null,!1,!1,"",Kd);return e._reactRootContainer=l,e[Vn]=l.current,gs(e.nodeType===8?e.parentNode:e),Lr(function(){xa(t,l,n,r)}),l}function _a(e,t,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=ea(o);a.call(l)}}xa(t,o,e,i)}else o=K0(n,t,e,i,r);return ea(o)}mp=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Fi(t.pendingLanes);n!==0&&(Ac(t,n|1),tn(t,pt()),!(Ke&6)&&(_i=pt()+500,wr()))}break;case 13:Lr(function(){var r=Yn(e,1);if(r!==null){var i=Kt();In(r,e,1,i)}}),uu(e,1)}};Rc=function(e){if(e.tag===13){var t=Yn(e,134217728);if(t!==null){var n=Kt();In(t,e,134217728,n)}uu(e,134217728)}};gp=function(e){if(e.tag===13){var t=pr(e),n=Yn(e,t);if(n!==null){var r=Kt();In(n,e,t,r)}uu(e,t)}};yp=function(){return Qe};vp=function(e,t){var n=Qe;try{return Qe=e,t()}finally{Qe=n}};Tl=function(e,t,n){switch(t){case"input":if(xl(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=pa(r);if(!i)throw Error(Q(90));Qf(r),xl(r,i)}}}break;case"textarea":Gf(e,n);break;case"select":t=n.value,t!=null&&ui(e,!!n.multiple,t,!1)}};ip=su;sp=Lr;var X0={usingClientEntryPoint:!1,Events:[Is,ni,pa,np,rp,su]},Di={findFiberByHostInstance:Tr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},V0={bundleType:Di.bundleType,version:Di.version,rendererPackageName:Di.rendererPackageName,rendererConfig:Di.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Jn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=lp(e),e===null?null:e.stateNode},findFiberByHostInstance:Di.findFiberByHostInstance||B0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zs.isDisabled&&Zs.supportsFiber)try{ca=Zs.inject(V0),On=Zs}catch{}}fn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X0;fn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fu(t))throw Error(Q(200));return W0(e,t,null,n)};fn.createRoot=function(e,t){if(!fu(e))throw Error(Q(299));var n=!1,r="",i=zh;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(i=t.onRecoverableError)),t=cu(e,1,!1,null,null,n,!1,r,i),e[Vn]=t.current,gs(e.nodeType===8?e.parentNode:e),new du(t)};fn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Q(188)):(e=Object.keys(e).join(","),Error(Q(268,e)));return e=lp(t),e=e===null?null:e.stateNode,e};fn.flushSync=function(e){return Lr(e)};fn.hydrate=function(e,t,n){if(!ka(t))throw Error(Q(200));return _a(null,e,t,!0,n)};fn.hydrateRoot=function(e,t,n){if(!fu(e))throw Error(Q(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=zh;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),t=Fh(t,null,e,1,n??null,i,!1,s,o),e[Vn]=t.current,gs(e),r)for(e=0;e<r.length;e++)n=r[e],i=n._getVersion,i=i(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Sa(t)};fn.render=function(e,t,n){if(!ka(t))throw Error(Q(200));return _a(null,e,t,!1,n)};fn.unmountComponentAtNode=function(e){if(!ka(e))throw Error(Q(40));return e._reactRootContainer?(Lr(function(){_a(null,null,e,!1,function(){e._reactRootContainer=null,e[Vn]=null})}),!0):!1};fn.unstable_batchedUpdates=su;fn.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!ka(n))throw Error(Q(200));if(e==null||e._reactInternals===void 0)throw Error(Q(38));return _a(e,t,n,!1,r)};fn.version="18.3.1-next-f1338f8080-20240426";function Uh(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Uh)}catch(e){console.error(e)}}Uh(),Uf.exports=fn;var Y0=Uf.exports,Xd=Y0;pl.createRoot=Xd.createRoot,pl.hydrateRoot=Xd.hydrateRoot;const Vd=e=>{let t;const n=new Set,r=(d,f)=>{const m=typeof d=="function"?d(t):d;if(!Object.is(m,t)){const g=t;t=f??(typeof m!="object"||m===null)?m:Object.assign({},t,m),n.forEach(v=>v(t,g))}},i=()=>t,l={setState:r,getState:i,getInitialState:()=>c,subscribe:d=>(n.add(d),()=>n.delete(d)),destroy:()=>{n.clear()}},c=t=e(r,i,l);return l},Q0=e=>e?Vd(e):Vd;var Hh={exports:{}},Wh={},Bh={exports:{}},Kh={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ci=G;function J0(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var G0=typeof Object.is=="function"?Object.is:J0,q0=Ci.useState,Z0=Ci.useEffect,ev=Ci.useLayoutEffect,tv=Ci.useDebugValue;function nv(e,t){var n=t(),r=q0({inst:{value:n,getSnapshot:t}}),i=r[0].inst,s=r[1];return ev(function(){i.value=n,i.getSnapshot=t,il(i)&&s({inst:i})},[e,n,t]),Z0(function(){return il(i)&&s({inst:i}),e(function(){il(i)&&s({inst:i})})},[e]),tv(n),n}function il(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!G0(e,n)}catch{return!0}}function rv(e,t){return t()}var iv=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?rv:nv;Kh.useSyncExternalStore=Ci.useSyncExternalStore!==void 0?Ci.useSyncExternalStore:iv;Bh.exports=Kh;var sv=Bh.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ca=G,ov=sv;function av(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var lv=typeof Object.is=="function"?Object.is:av,cv=ov.useSyncExternalStore,uv=Ca.useRef,dv=Ca.useEffect,fv=Ca.useMemo,pv=Ca.useDebugValue;Wh.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var s=uv(null);if(s.current===null){var o={hasValue:!1,value:null};s.current=o}else o=s.current;s=fv(function(){function l(g){if(!c){if(c=!0,d=g,g=r(g),i!==void 0&&o.hasValue){var v=o.value;if(i(v,g))return f=v}return f=g}if(v=f,lv(d,g))return v;var w=r(g);return i!==void 0&&i(v,w)?(d=g,v):(d=g,f=w)}var c=!1,d,f,m=n===void 0?null:n;return[function(){return l(t())},m===null?void 0:function(){return l(m())}]},[t,n,r,i]);var a=cv(e,s[0],s[1]);return dv(function(){o.hasValue=!0,o.value=a},[a]),pv(a),a};Hh.exports=Wh;var hv=Hh.exports;const mv=Pf(hv),{useDebugValue:gv}=Ff,{useSyncExternalStoreWithSelector:yv}=mv;const vv=e=>e;function wv(e,t=vv,n){const r=yv(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return gv(r),r}const Yd=e=>{const t=typeof e=="function"?Q0(e):e,n=(r,i)=>wv(t,r,i);return Object.assign(n,t),n},xv=e=>e?Yd(e):Yd;let eo;const Sv=new Uint8Array(16);function kv(){if(!eo&&(eo=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!eo))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return eo(Sv)}const jt=[];for(let e=0;e<256;++e)jt.push((e+256).toString(16).slice(1));function _v(e,t=0){return jt[e[t+0]]+jt[e[t+1]]+jt[e[t+2]]+jt[e[t+3]]+"-"+jt[e[t+4]]+jt[e[t+5]]+"-"+jt[e[t+6]]+jt[e[t+7]]+"-"+jt[e[t+8]]+jt[e[t+9]]+"-"+jt[e[t+10]]+jt[e[t+11]]+jt[e[t+12]]+jt[e[t+13]]+jt[e[t+14]]+jt[e[t+15]]}const Cv=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Qd={randomUUID:Cv};function dt(e,t,n){if(Qd.randomUUID&&!t&&!e)return Qd.randomUUID();e=e||{};const r=e.random||(e.rng||kv)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(let i=0;i<16;++i)t[n+i]=r[i];return t}return _v(r)}const Ev={linear:e=>e,"ease-in":e=>e*e,"ease-out":e=>1-(1-e)*(1-e),"ease-in-out":e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2},bv=(e,t="linear")=>Ev[t](e),Xh=(e,t,n,r="linear")=>{const i=bv(n,r);if(Array.isArray(e)&&Array.isArray(t))return e.map((s,o)=>s+(t[o]-s)*i);if(typeof e=="number"&&typeof t=="number")return e+(t-e)*i;if(typeof e=="object"&&typeof t=="object"&&e!==null&&t!==null){const s={},o=Object.keys(e),a=Object.keys(t);return[...new Set([...o,...a])].forEach(c=>{const d=e[c],f=t[c];typeof d=="number"&&typeof f=="number"?s[c]=d+(f-d)*i:typeof d=="number"?s[c]=d:typeof f=="number"?s[c]=f:s[c]=d!==void 0?d:f}),s}return e},Tv=()=>({id:dt(),name:"Untitled Project",assets:[],timeline:{tracks:[{id:dt(),type:"video",name:"Video 1",clips:[],visible:!0,locked:!1},{id:dt(),type:"audio",name:"Audio 1",clips:[],visible:!0,locked:!1}],currentTime:0,duration:30,fps:30,zoom:1},canvasWidth:1920,canvasHeight:1080,backgroundColor:"#000000"}),Jd=(e,t)=>{const n={x:0,y:0,rotation:0,scaleX:1,scaleY:1,opacity:1};if(!e.keyframes)return n;const r={...n};return Object.keys(e.keyframes).forEach(i=>{const s=e.keyframes[i];if(!s||s.length===0)return;const o=Pv(s,t);switch(i){case"position":typeof o=="object"&&o!==null&&"x"in o&&"y"in o?(r.x=o.x,r.y=o.y):Array.isArray(o)&&o.length>=2&&(r.x=o[0],r.y=o[1]);break;case"rotation":r.rotation=typeof o=="number"?o:0;break;case"scale":typeof o=="object"&&o!==null&&"scaleX"in o&&"scaleY"in o?(r.scaleX=o.scaleX,r.scaleY=o.scaleY):Array.isArray(o)&&o.length>=2&&(r.scaleX=o[0],r.scaleY=o[1]);break;case"opacity":r.opacity=typeof o=="number"?o:1;break}}),r},Pv=(e,t)=>{if(e.length===0)return 0;if(e.length===1)return e[0].value;const n=[...e].sort((a,l)=>a.time-l.time);if(t<=n[0].time)return n[0].value;if(t>=n[n.length-1].time)return n[n.length-1].value;let r=n[0],i=n[n.length-1];for(let a=0;a<n.length-1;a++)if(t>=n[a].time&&t<=n[a+1].time){r=n[a],i=n[a+1];break}const s=(t-r.time)/(i.time-r.time),o=i.easing||"linear";return Xh(r.value,i.value,s,o)},Gd=(e,t)=>({project:JSON.parse(JSON.stringify(e.project)),selectedClipIds:[...e.selectedClipIds],selectedAssetId:e.selectedAssetId,timestamp:Date.now(),actionName:t}),ft=xv((e,t)=>({project:Tv(),selectedClipIds:[],selectedAssetId:null,canvasSelectedClipId:null,playback:{isPlaying:!1,currentTime:0,duration:30,fps:30},timelineZoom:1,canvasZoom:1,clipboardClips:[],clipElementMap:new Map,playbackIntervalRef:null,assetsLoading:!1,pngFiles:[],flipbookState:{isPlaying:!1,currentFrame:0,fps:12,loop:!0},showPNGViewer:!1,history:[],historyIndex:-1,maxHistorySize:50,setProject:n=>e(r=>({project:n,playback:{...r.playback,fps:n.timeline.fps},history:[],historyIndex:-1})),saveInitialHistory:()=>{const n=t(),r=Gd(n,"Load project");e({history:[r],historyIndex:0})},setAssetsLoading:n=>e({assetsLoading:n}),addAsset:n=>{e(i=>({project:{...i.project,assets:[...i.project.assets,n]}})),t().saveHistory(`Import ${n.name}`)},removeAsset:n=>e(r=>({project:{...r.project,assets:r.project.assets.filter(i=>i.id!==n)}})),addTrack:n=>{e(i=>{const o=i.project.timeline.tracks.filter(l=>l.type===n).length+1,a={id:dt(),type:n,name:`${n==="video"?"Video":"Audio"} ${o}`,clips:[],visible:!0,locked:!1};return{project:{...i.project,timeline:{...i.project.timeline,tracks:n==="video"?[a,...i.project.timeline.tracks]:[...i.project.timeline.tracks,a]}}}}),t().saveHistory(`Add ${n} track`)},removeTrack:n=>{const i=t().project.timeline.tracks.find(o=>o.id===n);e(o=>({project:{...o.project,timeline:{...o.project.timeline,tracks:o.project.timeline.tracks.filter(a=>a.id!==n)}}})),t().saveHistory(`Remove track ${(i==null?void 0:i.name)||"Unknown"}`)},addClipToTrack:(n,r)=>{const s=t().project.assets.find(a=>a.id===r.assetId);e(a=>({project:{...a.project,timeline:{...a.project.timeline,tracks:a.project.timeline.tracks.map(l=>l.id===n?{...l,clips:[...l.clips,r]}:l)}}})),t().saveHistory(`Add clip ${(s==null?void 0:s.name)||"Unknown"}`)},removeClip:n=>{e(i=>{const s=i.clipElementMap.get(n);s&&(s instanceof HTMLAudioElement||s instanceof HTMLVideoElement)&&(s.pause(),s.currentTime=0,s.remove(),console.log(`Cleaned up independent element for removed clip ${n.slice(-4)}`));const o=new Map(i.clipElementMap);return o.delete(n),{project:{...i.project,timeline:{...i.project.timeline,tracks:i.project.timeline.tracks.map(a=>({...a,clips:a.clips.filter(l=>l.id!==n)}))}},selectedClipIds:i.selectedClipIds.filter(a=>a!==n),clipElementMap:o}}),t().saveHistory("Remove clip")},updateClip:(n,r,i=!1)=>{e(s=>({project:{...s.project,timeline:{...s.project.timeline,tracks:s.project.timeline.tracks.map(o=>({...o,clips:o.clips.map(a=>a.id===n?{...a,...r}:a)}))}}}))},updateClipTransform:(n,r,i,s,o=!1)=>{if(e(a=>{const l=a.project.timeline.tracks.map(c=>({...c,clips:c.clips.map(d=>{if(d.id!==n)return d;if(r==="volume"){d.audioKeyframes||(d.audioKeyframes={}),d.audioKeyframes[r]||(d.audioKeyframes[r]=[]);const m=d.audioKeyframes[r],g=m.findIndex(v=>Math.abs(v.time-s)<.01);g>=0?m[g]={...m[g],value:i}:(m.push({time:s,value:i,easing:"linear"}),m.sort((v,w)=>v.time-w.time))}else{d.keyframes||(d.keyframes={}),d.keyframes[r]||(d.keyframes[r]=[]);const m=d.keyframes[r],g=m.findIndex(v=>Math.abs(v.time-s)<.01);g>=0?m[g]={...m[g],value:i}:(m.push({time:s,value:i,easing:"linear"}),m.sort((v,w)=>v.time-w.time))}return{...d}})}));return{project:{...a.project,timeline:{...a.project.timeline,tracks:l}}}}),o){const a=t(),l=r==="position"?"Move clip":r==="scale"?"Scale clip":r==="rotation"?"Rotate clip":r==="opacity"?"Change opacity":r==="volume"?"Change volume":`Update ${r}`;a.saveHistory(l)}},getClipAtCanvasPosition:(n,r,i,s)=>{const o=t(),a=o.project.timeline.currentTime;for(const l of o.project.timeline.tracks){if(!l.visible)continue;const c=[...l.clips].reverse();for(const d of c){if(a<d.start||a>d.start+d.duration)continue;const f=o.project.assets.find(b=>b.id===d.assetId);if(!f||f.type==="audio")continue;const m=a-d.start,g=Jd(d,m),v=i/o.project.canvasWidth*g.scaleX,w=s/o.project.canvasHeight*g.scaleY,j=i/2+g.x/o.project.canvasWidth*i,h=s/2+g.y/o.project.canvasHeight*s;let u=100,p=100;f.element&&(f.element instanceof HTMLVideoElement?(u=f.element.videoWidth,p=f.element.videoHeight):f.element instanceof HTMLImageElement&&(u=f.element.naturalWidth,p=f.element.naturalHeight));const x=u*v/2,S=p*w/2;if(n>=j-x&&n<=j+x&&r>=h-S&&r<=h+S)return d.id}}return null},getEffectiveDuration:n=>{const r=n.playbackSpeed||1;return n.duration/r},removeKeyframe:(n,r,i)=>{e(o=>{const a=o.project.timeline.tracks.map(l=>({...l,clips:l.clips.map(c=>{if(c.id!==n)return c;if(r==="volume"){if(!c.audioKeyframes)return c;const f=c.audioKeyframes[r];if(!f)return c;const m=f.filter(g=>Math.abs(g.time-i)>.01);return{...c,audioKeyframes:{...c.audioKeyframes,[r]:m}}}else{if(!c.keyframes)return c;const f=c.keyframes[r];if(!f)return c;const m=f.filter(g=>Math.abs(g.time-i)>.01);return{...c,keyframes:{...c.keyframes,[r]:m}}}})}));return{project:{...o.project,timeline:{...o.project.timeline,tracks:a}}}}),t().saveHistory(`Remove ${r} keyframe`)},moveKeyframe:(n,r,i,s)=>{e(a=>{const l=a.project.timeline.tracks.map(c=>({...c,clips:c.clips.map(d=>{if(d.id!==n)return d;if(r==="volume"){if(!d.audioKeyframes)return d;const m=d.audioKeyframes[r];if(!m)return d;const g=m.map(v=>Math.abs(v.time-i)<.01?{...v,time:s}:v).sort((v,w)=>v.time-w.time);return{...d,audioKeyframes:{...d.audioKeyframes,[r]:g}}}else{if(!d.keyframes)return d;const m=d.keyframes[r];if(!m)return d;const g=m.map(v=>Math.abs(v.time-i)<.01?{...v,time:s}:v).sort((v,w)=>v.time-w.time);return{...d,keyframes:{...d.keyframes,[r]:g}}}})}));return{project:{...a.project,timeline:{...a.project.timeline,tracks:l}}}}),t().saveHistory(`Move ${r} keyframe`)},updateKeyframeEasing:(n,r,i,s)=>{e(a=>{const l=a.project.timeline.tracks.map(c=>({...c,clips:c.clips.map(d=>{if(d.id!==n)return d;if(r==="volume"){if(!d.audioKeyframes)return d;const m=d.audioKeyframes[r];if(!m)return d;const g=m.map(v=>Math.abs(v.time-i)<.01?{...v,easing:s}:v);return{...d,audioKeyframes:{...d.audioKeyframes,[r]:g}}}else{if(!d.keyframes)return d;const m=d.keyframes[r];if(!m)return d;const g=m.map(v=>Math.abs(v.time-i)<.01?{...v,easing:s}:v);return{...d,keyframes:{...d.keyframes,[r]:g}}}})}));return{project:{...a.project,timeline:{...a.project.timeline,tracks:l}}}}),t().saveHistory(`Change ${r} keyframe easing`)},selectCanvasClip:n=>e({canvasSelectedClipId:n}),splitClip:(n,r)=>{t().saveHistory("Split clip"),e(s=>{let o=null,a=null;for(const u of s.project.timeline.tracks){const p=u.clips.find(x=>x.id===n);if(p){o=p,a=u.id;break}}if(!o||!a)return s;const l=r-o.start;if(l<=0||l>=o.duration)return s;const c=new Map(s.clipElementMap),d=(u,p,x)=>!u||u.length===0?[]:x?u.map(S=>({...S,time:S.time-p})):[...u],f={};o.keyframes&&(o.keyframes.position&&(f.position=d(o.keyframes.position,l,!1)),o.keyframes.rotation&&(f.rotation=d(o.keyframes.rotation,l,!1)),o.keyframes.scale&&(f.scale=d(o.keyframes.scale,l,!1)),o.keyframes.opacity&&(f.opacity=d(o.keyframes.opacity,l,!1)));const m={};o.keyframes&&(o.keyframes.position&&(m.position=d(o.keyframes.position,l,!0)),o.keyframes.rotation&&(m.rotation=d(o.keyframes.rotation,l,!0)),o.keyframes.scale&&(m.scale=d(o.keyframes.scale,l,!0)),o.keyframes.opacity&&(m.opacity=d(o.keyframes.opacity,l,!0)));const g={};o.audioKeyframes&&o.audioKeyframes.volume&&(g.volume=d(o.audioKeyframes.volume,l,!1));const v={};o.audioKeyframes&&o.audioKeyframes.volume&&(v.volume=d(o.audioKeyframes.volume,l,!0));const w={...o,id:dt(),duration:l,outPoint:o.inPoint?o.inPoint+l:l,keyframes:Object.keys(f).length>0?f:void 0,audioKeyframes:Object.keys(g).length>0?g:void 0},j={...o,id:dt(),start:o.start+l,duration:o.duration-l,inPoint:o.inPoint?o.inPoint+l:l,keyframes:Object.keys(m).length>0?m:void 0,audioKeyframes:Object.keys(v).length>0?v:void 0},h=s.project.assets.find(u=>u.id===o.assetId);if((h==null?void 0:h.type)==="audio"&&h.element){const u=h.element,p=new Audio;p.src=u.src,p.preload="metadata",p.volume=1,p.playbackRate=1,p.crossOrigin="anonymous";const x=new Audio;x.src=u.src,x.preload="metadata",x.volume=1,x.playbackRate=1,x.crossOrigin="anonymous",c.set(w.id,p),c.set(j.id,x),console.log(`Created independent audio elements for split clips ${w.id.slice(-4)} and ${j.id.slice(-4)}`)}return{...s,project:{...s.project,timeline:{...s.project.timeline,tracks:s.project.timeline.tracks.map(u=>u.id===a?{...u,clips:u.clips.filter(p=>p.id!==n).concat([w,j]).sort((p,x)=>p.start-x.start)}:u)}},selectedClipIds:[],clipElementMap:c}})},reverseClip:n=>{t().saveHistory("Reverse clip"),e(i=>({project:{...i.project,timeline:{...i.project.timeline,tracks:i.project.timeline.tracks.map(s=>({...s,clips:s.clips.map(o=>o.id===n?{...o,reversed:!o.reversed}:o)}))}}}))},takeSnapshot:async n=>{const r=t();let i=null;for(const a of r.project.timeline.tracks){const l=a.clips.find(c=>c.id===n);if(l){i=l;break}}if(!i){console.error("Clip not found for snapshot");return}const s=r.project.assets.find(a=>a.id===i.assetId);if(!s||s.type!=="video"){console.error("Asset not found or not a video");return}const o=s.element;if(!o){console.error("Video element not found");return}try{const l=r.project.timeline.currentTime-i.start;let c=l;i.playbackSpeed&&(c=l*i.playbackSpeed),i.reversed&&(c=i.duration-c),i.inPoint&&(c+=i.inPoint),o.currentTime=c,await new Promise(p=>{const x=()=>{o.removeEventListener("seeked",x),p(void 0)};o.addEventListener("seeked",x)});const d=document.createElement("canvas"),f=d.getContext("2d");if(!f)throw new Error("Could not get canvas context");d.width=o.videoWidth,d.height=o.videoHeight,f.drawImage(o,0,0,d.width,d.height);const m=await new Promise((p,x)=>{d.toBlob(S=>{S?p(S):x(new Error("Failed to create blob from canvas"))},"image/png")}),g=new Date().toISOString().replace(/[:.]/g,"-"),v=`snapshot_${s.name}_${g}.png`,w=URL.createObjectURL(m),j=document.createElement("a");j.href=w,j.download=v,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(w);try{await navigator.clipboard.write([new ClipboardItem({"image/png":m})]),console.log("Image copied to clipboard")}catch(p){console.warn("Failed to copy to clipboard:",p)}const h=URL.createObjectURL(m),u=new Image;u.onload=()=>{const p={id:dt(),type:"image",src:h,name:v,width:u.width,height:u.height,element:u};t().addAsset(p),console.log(`Snapshot saved: ${v}`)},u.src=h}catch(a){console.error("Failed to take snapshot:",a)}},exportAllFrames:async n=>{const r=t();let i=null;for(const a of r.project.timeline.tracks){const l=a.clips.find(c=>c.id===n);if(l){i=l;break}}if(!i){console.error("Clip not found for frame export");return}const s=r.project.assets.find(a=>a.id===i.assetId);if(!s||s.type!=="video"){console.error("Asset not found or not a video");return}const o=s.element;if(!o){console.error("Video element not found");return}try{let a;try{if("showDirectoryPicker"in window)a=await window.showDirectoryPicker();else throw new Error("Directory picker not supported")}catch(v){console.error("Folder selection not supported in this browser:",v),alert("Frame export requires a browser that supports folder selection (Chrome/Edge 86+)");return}const l=r.getEffectiveDuration(i),c=r.project.timeline.fps,d=Math.ceil(l*c);console.log(`Starting frame export: ${d} frames from clip "${s.name}"`);const f=s.name.replace(/[^a-zA-Z0-9_-]/g,"_"),m=document.createElement("canvas"),g=m.getContext("2d");if(!g)throw new Error("Could not get canvas context");m.width=o.videoWidth,m.height=o.videoHeight;for(let v=0;v<d;v++){const w=v/c;let j=w;i.playbackSpeed&&(j=w*i.playbackSpeed),i.reversed&&(j=l-j),i.inPoint&&(j+=i.inPoint),o.currentTime=j,await new Promise(x=>{const S=()=>{o.removeEventListener("seeked",S),x(void 0)};o.addEventListener("seeked",S)}),g.drawImage(o,0,0,m.width,m.height);const h=await new Promise((x,S)=>{m.toBlob(b=>{b?x(b):S(new Error("Failed to create blob from canvas"))},"image/png")}),u=(v+1).toString().padStart(4,"0"),p=`${f}_frame_${u}.png`;try{const S=await(await a.getFileHandle(p,{create:!0})).createWritable();await S.write(h),await S.close()}catch(x){throw console.error(`Failed to save frame ${u}:`,x),x}(v%10===0||v===d-1)&&console.log(`Exported frame ${v+1}/${d} (${Math.round((v+1)/d*100)}%)`)}console.log(` Frame export complete: ${d} frames saved to folder`),alert(`Successfully exported ${d} frames from "${s.name}" to the selected folder!`)}catch(a){console.error("Failed to export frames:",a),alert(`Failed to export frames: ${a instanceof Error?a.message:"Unknown error"}`)}},copyClips:()=>e(n=>{const r=[];return n.project.timeline.tracks.forEach(i=>{i.clips.forEach(s=>{n.selectedClipIds.includes(s.id)&&r.push({...s})})}),{clipboardClips:r}}),pasteClips:n=>{const r=t();r.clipboardClips.length!==0&&(r.saveHistory("Paste clips"),e(i=>{var g;if(i.clipboardClips.length===0)return i;const s=i.project.timeline.currentTime,o=[...i.project.timeline.tracks],a=[...i.clipboardClips].sort((v,w)=>v.start-w.start),l=((g=a[0])==null?void 0:g.start)||0,c=(v,w,j)=>{const h=[...v.clips].sort((S,b)=>S.start-b.start),u=w+j;let p=!1;for(const S of h)if(!(u<=S.start||w>=S.start+S.duration)){p=!0;break}if(!p)return Math.max(0,w);for(let S=0;S<h.length;S++){const b=h[S],T=h[S+1],z=b.start+b.duration;if(T){if(T.start-z>=j)return z}else return z}if(h.length===0)return Math.max(0,w);const x=h[h.length-1];return x.start+x.duration},d=a.filter(v=>{const w=i.project.assets.find(j=>j.id===v.assetId);return w&&(w.type==="video"||w.type==="image")}),f=a.filter(v=>{const w=i.project.assets.find(j=>j.id===v.assetId);return w&&w.type==="audio"});let m=null;if(n&&(m=o.find(v=>v.id===n)),d.length>0){const v=m&&m.type==="video"?m:o.find(w=>w.type==="video");v&&d.forEach(w=>{const j=w.start-l,h=s+j,u=c(v,h,w.duration),p={...w,id:dt(),start:u};v.clips.push(p)})}if(f.length>0){const v=m&&m.type==="audio"?m:o.find(w=>w.type==="audio");v&&f.forEach(w=>{const j=w.start-l,h=s+j,u=c(v,h,w.duration),p={...w,id:dt(),start:u};v.clips.push(p)})}return{project:{...i.project,timeline:{...i.project.timeline,tracks:o}},selectedClipIds:[]}}))},createClipElement:(n,r)=>e(i=>{const s=i.project.assets.find(l=>l.id===r);if(!(s!=null&&s.element))return i;let o;if(s.type==="audio"){const l=s.element;o=new Audio,o.src=l.src,o.preload="metadata",o.volume=1,o.playbackRate=1,o.crossOrigin="anonymous",console.log(`Created independent audio element for clip ${n.slice(-4)}`)}else if(s.type==="video"){const l=s.element;o=l.cloneNode(),o.src=l.src,o.preload="metadata"}else return i;const a=new Map(i.clipElementMap);return a.set(n,o),{clipElementMap:a}}),removeClipElement:n=>e(r=>{const i=r.clipElementMap.get(n);i&&(i instanceof HTMLAudioElement||i instanceof HTMLVideoElement)&&(i.pause(),i.currentTime=0,i.remove(),console.log(`Cleaned up independent element for clip ${n.slice(-4)}`));const s=new Map(r.clipElementMap);return s.delete(n),{clipElementMap:s}}),selectClip:(n,r=!1)=>e(i=>n?r?{selectedClipIds:i.selectedClipIds.includes(n)?i.selectedClipIds.filter(o=>o!==n):[...i.selectedClipIds,n]}:{selectedClipIds:[n]}:{selectedClipIds:[]}),selectAsset:n=>e({selectedAssetId:n}),play:()=>{const n=t();if(n.playback.isPlaying)return;n.playbackIntervalRef&&clearInterval(n.playbackIntervalRef);const r=setInterval(()=>{const i=t(),s=i.project.timeline.currentTime+1/i.playback.fps;s>=i.project.timeline.duration?i.stop():e(o=>({playback:{...o.playback,currentTime:s},project:{...o.project,timeline:{...o.project.timeline,currentTime:s}}}))},1e3/n.playback.fps);e({playback:{...n.playback,isPlaying:!0},playbackIntervalRef:r})},pause:()=>{const n=t();n.playbackIntervalRef&&clearInterval(n.playbackIntervalRef),e({playback:{...n.playback,isPlaying:!1},playbackIntervalRef:null})},stop:()=>{const n=t();n.playbackIntervalRef&&clearInterval(n.playbackIntervalRef),e({playback:{...n.playback,isPlaying:!1,currentTime:0},project:{...n.project,timeline:{...n.project.timeline,currentTime:0}},playbackIntervalRef:null})},seek:n=>{t(),e(r=>({playback:{...r.playback,currentTime:n},project:{...r.project,timeline:{...r.project.timeline,currentTime:n}}}))},setDuration:n=>e(r=>({playback:{...r.playback,duration:n},project:{...r.project,timeline:{...r.project.timeline,duration:n}}})),setFPS:n=>e(r=>({playback:{...r.playback,fps:n},project:{...r.project,timeline:{...r.project.timeline,fps:n}}})),setTimelineZoom:n=>e({timelineZoom:n}),setCanvasZoom:n=>e({canvasZoom:n}),loadPNGFiles:n=>{const r=[];Array.from(n).forEach(i=>{if(i.type==="image/png"){const s={id:dt(),name:i.name,src:URL.createObjectURL(i),file:i,selected:!1};r.push(s)}}),r.sort((i,s)=>i.name.localeCompare(s.name)),e(i=>({pngFiles:r,flipbookState:{...i.flipbookState,currentFrame:0,isPlaying:!1}}))},togglePNGSelection:n=>e(r=>({pngFiles:r.pngFiles.map(i=>i.id===n?{...i,selected:!i.selected}:i)})),selectAllPNGs:()=>e(n=>({pngFiles:n.pngFiles.map(r=>({...r,selected:!0}))})),clearPNGSelection:()=>e(n=>({pngFiles:n.pngFiles.map(r=>({...r,selected:!1}))})),playFlipbook:()=>{const n=t();if(n.flipbookState.isPlaying||n.pngFiles.filter(s=>s.selected).length===0)return;e(s=>({flipbookState:{...s.flipbookState,isPlaying:!0}}));const i=()=>{const s=t();if(!s.flipbookState.isPlaying)return;const o=s.pngFiles.filter(l=>l.selected);if(o.length===0)return;const a=s.flipbookState.currentFrame+1;if(a>=o.length)if(s.flipbookState.loop)e(l=>({flipbookState:{...l.flipbookState,currentFrame:0}}));else{e(l=>({flipbookState:{...l.flipbookState,isPlaying:!1,currentFrame:0}}));return}else e(l=>({flipbookState:{...l.flipbookState,currentFrame:a}}));setTimeout(i,1e3/s.flipbookState.fps)};i()},pauseFlipbook:()=>e(n=>({flipbookState:{...n.flipbookState,isPlaying:!1}})),stopFlipbook:()=>e(n=>({flipbookState:{...n.flipbookState,isPlaying:!1,currentFrame:0}})),setFlipbookFrame:n=>e(r=>{const i=r.pngFiles.filter(o=>o.selected),s=Math.max(0,Math.min(n,i.length-1));return{flipbookState:{...r.flipbookState,currentFrame:s}}}),setFlipbookFPS:n=>e(r=>({flipbookState:{...r.flipbookState,fps:Math.max(1,Math.min(n,60))}})),setFlipbookLoop:n=>e(r=>({flipbookState:{...r.flipbookState,loop:n}})),setShowPNGViewer:n=>e({showPNGViewer:n}),saveHistory:n=>e(r=>{console.log(` SAVING HISTORY: ${n}`);const i=r.project.timeline.tracks.flatMap(l=>l.clips);if(i.length>0){const l=i[0];console.log(` Snapshot of first clip ${l.id.slice(-4)}: start=${l.start}, duration=${l.duration}, inPoint=${l.inPoint}, outPoint=${l.outPoint}`)}const s=Gd(r,n),o=r.history.slice(0,r.historyIndex+1);o.push(s),o.length>r.maxHistorySize&&o.shift();const a=o.length-1;return console.log(` History entries: [${o.map(l=>l.actionName).join(", ")}] | Index: ${a}`),{history:o,historyIndex:a}}),undo:()=>e(n=>{if(n.historyIndex<=0)return n;const r=n.history[n.historyIndex].actionName;console.log(` UNDOING: ${r}`);const i=n.history[n.historyIndex-1],s=n.project.timeline.tracks.flatMap(l=>l.clips),o=i.project.timeline.tracks.flatMap(l=>l.clips);if(console.log(` Current state has ${s.length} clips`),console.log(` Snapshot state has ${o.length} clips`),s.length>0){const l=s[0];console.log(` Current clip ${l.id.slice(-4)}: start=${l.start}, duration=${l.duration}`)}if(o.length>0){const l=o[0];console.log(` Snapshot clip ${l.id.slice(-4)}: start=${l.start}, duration=${l.duration}`)}else console.log(` Snapshot has no clips! Going back to: ${i.actionName}`);return{project:{...i.project,assets:i.project.assets.map(l=>{const c=n.project.assets.find(d=>d.id===l.id);return{...l,element:c==null?void 0:c.element,thumbnail:c==null?void 0:c.thumbnail,waveform:c==null?void 0:c.waveform}})},selectedClipIds:i.selectedClipIds,selectedAssetId:i.selectedAssetId,historyIndex:n.historyIndex-1}}),redo:()=>e(n=>{if(n.historyIndex>=n.history.length-1)return n;const r=n.history[n.historyIndex+1];return console.log(` REDOING: ${r.actionName}`),{project:{...r.project,assets:r.project.assets.map(s=>{const o=n.project.assets.find(a=>a.id===s.id);return{...s,element:o==null?void 0:o.element,thumbnail:o==null?void 0:o.thumbnail,waveform:o==null?void 0:o.waveform}})},selectedClipIds:r.selectedClipIds,selectedAssetId:r.selectedAssetId,historyIndex:n.historyIndex+1}}),canUndo:()=>t().historyIndex>0,canRedo:()=>{const n=t();return n.historyIndex<n.history.length-1},getClipTransform:(n,r)=>{const s=t().project.timeline.tracks.flatMap(o=>o.clips).find(o=>o.id===n);return s?Jd(s,r):null}})),Br=(e,t)=>new Promise((n,r)=>{const i=document.createElement("canvas"),s=i.getContext("2d");if(!s){r(new Error("Could not get canvas context"));return}const o=80;let a,l;if(t==="video"){const c=e,d=c.videoWidth/c.videoHeight;c.videoWidth>c.videoHeight?(a=o,l=o/d):(l=o,a=o*d)}else{const c=e,d=c.naturalWidth/c.naturalHeight;c.naturalWidth>c.naturalHeight?(a=o,l=o/d):(l=o,a=o*d)}i.width=a,i.height=l;try{if(t==="video"){const c=e,d=Math.min(1,c.duration*.1),f=()=>{try{s.drawImage(c,0,0,a,l);const g=i.toDataURL("image/jpeg",.8);c.removeEventListener("seeked",f),c.removeEventListener("error",m),n(g)}catch(g){c.removeEventListener("seeked",f),c.removeEventListener("error",m),r(g)}},m=()=>{c.removeEventListener("seeked",f),c.removeEventListener("error",m),r(new Error("Video seek failed"))};c.addEventListener("seeked",f),c.addEventListener("error",m),c.currentTime=d}else{const c=e;s.drawImage(c,0,0,a,l);const d=i.toDataURL("image/jpeg",.8);n(d)}}catch(c){r(c)}}),qn=async(e,t=2400)=>{try{const n=new(window.AudioContext||window.webkitAudioContext),i=await(await fetch(e)).arrayBuffer(),o=(await n.decodeAudioData(i)).getChannelData(0),a=Math.floor(o.length/t),l=[];for(let d=0;d<t;d++){const f=d*a,m=f+a;let g=0,v=0;for(let j=f;j<m&&j<o.length;j++){const h=Math.abs(o[j]);g+=h*h,v=Math.max(v,h)}const w=Math.sqrt(g/a);l.push(w)}const c=Math.max(...l);return c>0?l.map(d=>d/c):l}catch(n){return console.error("Error generating waveform:",n),new Array(t).fill(0)}},Vh=(e,t,n,r,i,s,o="#00ff88")=>{const a=e.getContext("2d");if(!a)return;const l=window.devicePixelRatio||1;e.width=i*l,e.height=s*l,e.style.width=i+"px",e.style.height=s+"px",a.scale(l,l),a.clearRect(0,0,i,s);const c=t.slice(Math.floor(n),Math.ceil(r));if(c.length===0)return;a.fillStyle=o,a.globalAlpha=.7;const d=Math.min(c.length,i*4),f=c.length/d,m=i/d,g=s/2;for(let v=0;v<d;v++){const w=Math.floor(v*f),j=Math.floor((v+1)*f);let h=0;for(let b=w;b<j&&b<c.length;b++)h=Math.max(h,c[b]);const u=h*s*.8,p=v*m,x=g-u/2,S=Math.max(.5,m-.25);a.fillRect(p,x,S,u)}},Iv=()=>{var Z,ue,Fe;const{project:e,addAsset:t,addTrack:n,setProject:r,selectedClipIds:i,undo:s,redo:o,canUndo:a,canRedo:l,getClipTransform:c,getEffectiveDuration:d,saveInitialHistory:f,setFPS:m}=ft(),g=G.useRef(null),[v,w]=G.useState(!1),[j,h]=G.useState(!1),[u,p]=G.useState(0),[x,S]=G.useState("medium"),b=_=>{const D=_.target.files;D&&(Array.from(D).forEach(te=>{const E=URL.createObjectURL(te),K={id:dt(),type:T(te.type),src:E,name:te.name};if(K.type==="video"){const R=document.createElement("video");R.src=E,R.muted=!0,R.onloadedmetadata=async()=>{var X;K.duration=R.duration,K.width=R.videoWidth,K.height=R.videoHeight,K.element=R;try{K.thumbnail=await Br(R,"video")}catch(ie){console.warn("Failed to generate video thumbnail:",ie)}if(await z(R)){const ie=`${K.name} (Audio)`;if(e.assets.find(U=>U.type==="audio"&&U.name===ie))console.log(`Audio asset already exists for ${K.name}, skipping creation`),t(K);else{console.log(`Video ${K.name} has audio, creating audio asset`);try{const U={id:dt(),type:"audio",src:E,name:ie,duration:R.duration,width:0,height:0,element:void 0,waveform:await qn(E)},W=document.createElement("audio");W.src=E,W.preload="metadata",U.element=W,t(K),t(U),console.log(`Created audio asset for ${K.name}: ${(X=U.waveform)==null?void 0:X.length} samples`)}catch(U){console.warn("Failed to extract audio from video:",U),t(K)}}}else t(K)}}else if(K.type==="image"){const R=document.createElement("img");R.src=E,R.onload=async()=>{K.width=R.naturalWidth,K.height=R.naturalHeight,K.element=R;try{K.thumbnail=await Br(R,"image")}catch(H){console.warn("Failed to generate image thumbnail:",H)}t(K)}}else if(K.type==="audio"){const R=document.createElement("audio");R.src=E,R.preload="metadata",R.onloadedmetadata=async()=>{K.duration=R.duration,K.element=R;try{K.waveform=await qn(E),console.log(`Generated waveform for ${K.name} with ${K.waveform.length} samples`)}catch(H){console.warn("Failed to generate waveform:",H)}t(K)},R.load()}}),g.current&&(g.current.value=""))},T=_=>_.startsWith("video/")?"video":_.startsWith("audio/")?"audio":"image",z=async _=>new Promise(D=>{const te=()=>{try{if("webkitAudioDecodedByteCount"in _&&_.webkitAudioDecodedByteCount>0){D(!0);return}if("captureStream"in _)try{const K=_.captureStream().getAudioTracks();D(K.length>0),K.forEach(R=>R.stop());return}catch{}D(!0)}catch(E){console.warn("Could not determine if video has audio:",E),D(!1)}};_.readyState>=1?te():_.addEventListener("loadedmetadata",te,{once:!0})}),O=()=>{var _;(_=g.current)==null||_.click()},J=()=>{const _={...e,assets:e.assets.map(R=>({id:R.id,name:R.name,type:R.type,duration:R.duration,width:R.width,height:R.height,fileName:R.name}))},D=JSON.stringify(_,null,2),te=new Blob([D],{type:"application/json"}),E=URL.createObjectURL(te),K=document.createElement("a");K.href=E,K.download=`${e.name}.vproj`,K.click(),URL.revokeObjectURL(E)},ee=()=>{const _=document.createElement("input");_.type="file",_.accept=".vproj,.json",_.onchange=D=>{var E;const te=(E=D.target.files)==null?void 0:E[0];if(te){const K=new FileReader;K.onload=R=>{var H;try{const X=JSON.parse((H=R.target)==null?void 0:H.result);X.assets&&X.assets.length>0?(console.log(`Loading project with ${X.assets.length} assets...`),X.assets.some(L=>L.fileName||L.src&&!L.src.startsWith("blob:"))&&confirm(`This project contains ${X.assets.length} assets.

Click OK to select the folder containing your media files for best quality,
or Cancel to load with automatic metadata generation.`)?P(X):ht(X)):(r(X),f())}catch(X){console.error("Error loading project:",X),alert("Error loading project file")}},K.readAsText(te)}},_.click()},P=_=>{const D=document.createElement("input");D.type="file",D.webkitdirectory=!0,D.multiple=!0,D.onchange=async te=>{const E=te.target.files;E&&E.length>0?await _e(_,E):ht(_)},D.click()},_e=async(_,D)=>{const{setAssetsLoading:te}=ft.getState();te(!0),console.log(" Loading project with assets folder, processing files..."),console.log(`Project has ${_.assets.length} assets, folder has ${D.length} files`);const E=[];for(const R of _.assets){console.log(`Processing asset: ${R.name||R.fileName} (${R.type})`);const H=Array.from(D).find(X=>X.name===R.fileName||X.name===R.name);if(H)try{console.log(`Found matching file: ${H.name}`);const X=await Yt(H,R.id);R.duration&&!X.duration&&(X.duration=R.duration),R.width&&!X.width&&(X.width=R.width),R.height&&!X.height&&(X.height=R.height),console.log(`Asset recreated with metadata: duration=${X.duration}, ${X.width}${X.height}`),E.push(X)}catch(X){console.warn(`Could not recreate asset: ${R.name}`,X),E.push({...R,src:R.src||"",element:void 0})}else console.warn(`Asset file not found: ${R.name}`),E.push({...R,src:R.src||"",element:void 0})}console.log(" Checking all assets for missing metadata...");const K=await Promise.all(E.map(async R=>{const H=R.type==="video"&&(!R.duration||!R.width||!R.height)||R.type==="audio"&&(!R.duration||!R.waveform)||R.type==="image"&&(!R.width||!R.height)||!R.thumbnail,X=R.fileName||R.name||"unknown";if(console.log(`Asset ${X}: type=${R.type}, needsMetadata=${H}`,{duration:R.duration,width:R.width,height:R.height,waveform:R.waveform?"present":"missing",thumbnail:R.thumbnail?"present":"missing",hasElement:!!R.element}),H){console.log(`Generating missing metadata for ${X}...`);try{const ie=await Ut(R),L={...R,...ie};return console.log(`Generated metadata for ${X}:`,ie),L}catch(ie){console.warn(`Failed to generate metadata for ${X}:`,ie);const L={...R};return R.type==="video"&&!R.duration?(L.duration=10,L.width=L.width||1920,L.height=L.height||1080):R.type==="audio"&&!R.duration?L.duration=30:R.type==="image"&&(L.width=L.width||1920,L.height=L.height||1080),L}}return R}));console.log(" Project loaded with folder assets and metadata generation complete"),console.log("Final processed assets:",K),r({..._,assets:K}),await Je(),te(!1)},ht=async _=>{const{setAssetsLoading:D}=ft.getState();if(D(!0),console.log(" Loading project without assets, checking for missing metadata..."),console.log("Project data:",_),!_.assets||_.assets.length===0){console.log("No assets to process, setting project directly"),r(_),f(),D(!1);return}console.log(`Processing ${_.assets.length} assets for metadata generation...`);const te=await Promise.all(_.assets.map(async E=>{const K={...E,src:E.src||"",element:void 0},R=E.type==="video"&&(!E.duration||!E.width||!E.height)||E.type==="audio"&&(!E.duration||!E.waveform)||E.type==="image"&&(!E.width||!E.height)||!E.thumbnail;if(console.log(`Asset ${E.name||E.fileName}: type=${E.type}, needsMetadata=${R}`,{duration:E.duration,width:E.width,height:E.height,waveform:E.waveform?"present":"missing",thumbnail:E.thumbnail?"present":"missing"}),R){const H=E.fileName||E.name||"unknown";console.log(`Generating missing metadata for ${H}...`);try{const X=await Ut(E);Object.assign(K,X),console.log(`Generated metadata for ${H}:`,X)}catch(X){console.warn(`Failed to generate metadata for ${H}:`,X),E.type==="video"&&!E.duration?(K.duration=10,K.width=K.width||1920,K.height=K.height||1080):E.type==="audio"&&!E.duration?K.duration=30:E.type==="image"&&(K.width=K.width||1920,K.height=K.height||1080)}}return K}));console.log(" Project loaded with metadata generation complete"),console.log("Final processed assets:",te),r({..._,assets:te}),await Je(),f(),D(!1)},Je=async()=>{var X;const{project:_,addAsset:D,addTrack:te,addClipToTrack:E}=ft.getState();console.log(" Checking for missing audio assets from videos...");const K=_.assets.filter(ie=>ie.type==="video"),R=[],H=[];for(const ie of K){const L=`${ie.name} (Audio)`,U=_.assets.find(B=>B.type==="audio"&&B.name===L);if(!U||!U.element||!(U.element instanceof HTMLAudioElement)){console.log(`Checking if video ${ie.name} has embedded audio...`);try{const B=document.createElement("video");if(B.crossOrigin="anonymous",B.preload="metadata",B.muted=!0,await new Promise(q=>{B.onloadedmetadata=async()=>{const Y=await z(B);q(Y)},B.onerror=()=>{console.warn(`Failed to load video ${ie.name} for audio check`),q(!1)};const xe=[ie.src,ie.fileName?`./${ie.fileName}`:null,ie.name?`./${ie.name}`:null].filter(Boolean)[0];xe?B.src=xe:q(!1)})){console.log(`Video ${ie.name} has embedded audio, ${U?"updating existing":"creating new"} audio asset...`);let q;U?q={...U,src:ie.src,duration:ie.duration||U.duration||10,element:void 0,waveform:await qn(ie.src)}:q={id:dt(),type:"audio",src:ie.src,name:L,duration:ie.duration||10,width:0,height:0,element:void 0,waveform:await qn(ie.src)};const V=document.createElement("audio");V.src=ie.src,V.preload="metadata",q.element=V,R.push(q),H.push(ie),console.log(`Prepared audio asset for ${ie.name}: ${(X=q.waveform)==null?void 0:X.length} samples`)}else console.log(`Video ${ie.name} has no embedded audio, skipping`)}catch(B){console.warn(`Failed to check audio for video ${ie.name}:`,B)}}else console.log(`Audio asset already exists for ${ie.name}, skipping`)}if(R.length>0){console.log(`Processing ${R.length} audio assets...`);let ie=0;for(let W=0;W<R.length;W++){const B=R[W],q=`${H[W].name} (Audio)`,V=_.assets.find(xe=>xe.type==="audio"&&xe.name===q);if(V){const{setProject:xe}=ft.getState(),Y=ft.getState().project,Pe=Y.assets.map(Ee=>Ee.id===V.id?B:Ee);xe({...Y,assets:Pe}),console.log(`Updated existing audio asset: ${B.name}`)}else D(B),console.log(`Added new audio asset: ${B.name}`)}const L=ft.getState().project;for(let W=0;W<R.length;W++){const B=R[W],F=H[W],q=L.timeline.tracks.filter(V=>V.type==="video").flatMap(V=>V.clips).filter(V=>V.assetId===F.id);for(const V of q)L.timeline.tracks.filter(Y=>Y.type==="audio").flatMap(Y=>Y.clips).find(Y=>Y.assetId===B.id&&Math.abs(Y.start-V.start)<.01&&Math.abs(Y.duration-V.duration)<.01)||ie++}let U;if(ie>0&&(console.log(`Creating new audio track for ${ie} extracted audio clips...`),te("audio"),U=ft.getState().project.timeline.tracks.filter(B=>B.type==="audio").slice(-1)[0]),U){console.log(`Created audio track: ${U.name} (${U.id})`);for(let W=0;W<R.length;W++){const B=R[W],F=H[W],q=L.timeline.tracks.filter(V=>V.type==="video").flatMap(V=>V.clips).filter(V=>V.assetId===F.id);console.log(`Found ${q.length} video clips using ${F.name}`);for(const V of q)if(L.timeline.tracks.filter(Y=>Y.type==="audio").flatMap(Y=>Y.clips).find(Y=>Y.assetId===B.id&&Math.abs(Y.start-V.start)<.01&&Math.abs(Y.duration-V.duration)<.01))console.log(`Audio clip already exists for video clip at ${V.start}s, skipping creation`);else{const Y={id:dt(),assetId:B.id,start:V.start,duration:V.duration,inPoint:V.inPoint,outPoint:V.outPoint,playbackSpeed:V.playbackSpeed,reversed:V.reversed,audioKeyframes:V.audioKeyframes?{...V.audioKeyframes}:void 0};E(U.id,Y),console.log(`Created audio clip in sync with video clip at ${V.start}s, duration ${V.duration}s`)}}console.log(" Successfully added missing audio assets and created synchronized audio clips")}else console.warn("Failed to find the created audio track")}else console.log("No missing audio assets found")},Ut=async _=>(console.log(`Attempting to generate metadata for ${_.type} asset:`,_),new Promise((D,te)=>{if(_.type==="video"){const E=document.createElement("video");E.crossOrigin="anonymous",E.preload="metadata",E.muted=!0,E.onloadedmetadata=async()=>{var ie;console.log(`Video metadata loaded successfully: ${E.duration}s, ${E.videoWidth}${E.videoHeight}`);const H={duration:E.duration,width:E.videoWidth,height:E.videoHeight,element:E};if(!_.thumbnail)try{H.thumbnail=await Br(E,"video"),console.log("Video thumbnail generated successfully")}catch(L){console.warn("Failed to generate video thumbnail:",L)}if(await z(E)){const{project:L}=ft.getState(),U=`${_.name||"Video"} (Audio)`;if(L.assets.find(B=>B.type==="audio"&&B.name===U))console.log(`Audio asset already exists for ${_.name||"unknown"}, skipping creation`);else{console.log(`Video ${_.name||"unknown"} has audio, creating audio asset during project load`);try{const B={id:dt(),type:"audio",src:E.src,name:U,duration:E.duration,width:0,height:0,element:void 0,waveform:await qn(E.src)},F=document.createElement("audio");F.src=E.src,F.preload="metadata",B.element=F;const{addAsset:q}=ft.getState();q(B),console.log(`Created audio asset during project load: ${(ie=B.waveform)==null?void 0:ie.length} samples`)}catch(B){console.warn("Failed to extract audio from video during project load:",B)}}}D(H)},E.onerror=H=>{console.warn("Failed to load video for metadata generation:",H),D({duration:_.duration||10,width:_.width||1920,height:_.height||1080,element:void 0})};const K=[_.src,_.fileName?`./${_.fileName}`:null,_.name?`./${_.name}`:null].filter(Boolean);console.log("Trying video sources:",K);const R=K[0];R?E.src=R:(console.warn("No valid source found for video asset"),D({duration:_.duration||10,width:_.width||1920,height:_.height||1080,element:void 0}))}else if(_.type==="audio"){const E=document.createElement("audio");E.crossOrigin="anonymous",E.preload="metadata",E.onloadedmetadata=async()=>{console.log(`Audio metadata loaded successfully: ${E.duration}s`);const H={duration:E.duration,element:E};if(!_.waveform)try{H.waveform=await qn(E.src),console.log("Audio waveform generated successfully")}catch(X){console.warn("Failed to generate waveform:",X)}D(H)},E.onerror=H=>{console.warn("Failed to load audio for metadata generation:",H),D({duration:_.duration||30,element:void 0})};const K=[_.src,_.fileName?`./${_.fileName}`:null,_.name?`./${_.name}`:null].filter(Boolean);console.log("Trying audio sources:",K);const R=K[0];R?E.src=R:(console.warn("No valid source found for audio asset"),D({duration:_.duration||30,element:void 0}))}else if(_.type==="image"){const E=document.createElement("img");E.crossOrigin="anonymous",E.onload=async()=>{console.log(`Image metadata loaded successfully: ${E.naturalWidth}${E.naturalHeight}`);const H={width:E.naturalWidth,height:E.naturalHeight,duration:5,element:E};if(!_.thumbnail)try{H.thumbnail=await Br(E,"image"),console.log("Image thumbnail generated successfully")}catch(X){console.warn("Failed to generate image thumbnail:",X)}D(H)},E.onerror=H=>{console.warn("Failed to load image for metadata generation:",H),D({width:_.width||1920,height:_.height||1080,duration:5,element:void 0})};const K=[_.src,_.fileName?`./${_.fileName}`:null,_.name?`./${_.name}`:null].filter(Boolean);console.log("Trying image sources:",K);const R=K[0];R?E.src=R:(console.warn("No valid source found for image asset"),D({width:_.width||1920,height:_.height||1080,element:void 0}))}else D({});setTimeout(()=>{te(new Error("Metadata generation timeout"))},1e4)})),Yt=async(_,D)=>{const te=T(_.type),E=URL.createObjectURL(_);return new Promise(async(K,R)=>{if(te==="video"){const H=document.createElement("video");H.preload="metadata",H.muted=!0,H.onloadedmetadata=async()=>{var X;try{const ie=await Br(H,"video"),L=await z(H),U={id:D||crypto.randomUUID(),name:_.name,type:"video",src:E,duration:H.duration,width:H.videoWidth,height:H.videoHeight,element:H,thumbnail:ie};if(K(U),L){const{project:W}=ft.getState(),B=`${_.name} (Audio)`;if(W.assets.find(q=>q.type==="audio"&&q.name===B))console.log(`Audio asset already exists for ${_.name}, skipping creation`);else try{const q={id:dt(),type:"audio",src:E,name:B,duration:H.duration,width:0,height:0,element:void 0,waveform:await qn(E)},V=document.createElement("audio");V.src=E,V.preload="metadata",q.element=V;const{addAsset:xe}=ft.getState();xe(q),console.log(`Created audio asset for ${_.name}: ${(X=q.waveform)==null?void 0:X.length} samples`)}catch(q){console.warn("Failed to extract audio from video in createAssetFromFile:",q)}}}catch(ie){console.warn("Failed to generate video thumbnail:",ie),K({id:D||crypto.randomUUID(),name:_.name,type:"video",src:E,duration:H.duration,width:H.videoWidth,height:H.videoHeight,element:H})}},H.onerror=()=>R(new Error(`Failed to load video: ${_.name}`)),H.src=E}else if(te==="audio"){const H=document.createElement("audio");H.preload="metadata",H.crossOrigin="anonymous",H.volume=1,H.playbackRate=1,H.onloadstart=()=>console.log(`Audio loading started: ${_.name}`),H.oncanplay=()=>console.log(`Audio can play: ${_.name}`),H.onloadedmetadata=async()=>{console.log(`Audio metadata loaded: ${_.name}, duration: ${H.duration}`);let X;try{X=await qn(E),console.log(`Generated waveform for ${_.name} with ${X.length} samples`)}catch(L){console.warn("Failed to generate waveform:",L)}const ie=()=>{H.readyState>=2?(console.log(`Audio fully ready: ${_.name}, readyState: ${H.readyState}`),K({id:D||crypto.randomUUID(),name:_.name,type:"audio",src:E,duration:H.duration,width:0,height:0,element:H,waveform:X})):setTimeout(ie,50)};setTimeout(ie,100)},H.onerror=X=>{console.error(`Failed to load audio: ${_.name}`,X),R(new Error(`Failed to load audio: ${_.name}`))},H.src=E}else{const H=document.createElement("img");H.onload=async()=>{try{const X=await Br(H,"image");K({id:D||crypto.randomUUID(),name:_.name,type:"image",src:E,duration:5,width:H.naturalWidth,height:H.naturalHeight,element:H,thumbnail:X})}catch(X){console.warn("Failed to generate image thumbnail:",X),K({id:D||crypto.randomUUID(),name:_.name,type:"image",src:E,duration:5,width:H.naturalWidth,height:H.naturalHeight,element:H})}},H.onerror=()=>R(new Error(`Failed to load image: ${_.name}`)),H.src=E}})},ae=async()=>{w(!0),p(0);try{await fe()}catch(_){console.error("Export failed:",_),alert("Export failed. Please try again.")}finally{w(!1),p(0)}},fe=async()=>{const _=document.createElement("canvas");_.width=e.canvasWidth,_.height=e.canvasHeight;const D=_.getContext("2d");if(!D)throw new Error("Could not get canvas context");const te=_.captureStream(e.timeline.fps);let E=null,K=null;const R=[],H=e.timeline.tracks.some(Pe=>Pe.type==="audio"&&Pe.clips.some(Ee=>{var Se;return(Se=e.assets.find(ke=>ke.id===Ee.assetId))==null?void 0:Se.element}));H&&(E=new AudioContext,K=E.createMediaStreamDestination(),E.state==="suspended"&&await E.resume(),e.timeline.tracks.forEach(Ee=>{Ee.type==="audio"&&Ee.clips.forEach(Se=>{const ke=e.assets.find(De=>De.id===Se.assetId);if(ke!=null&&ke.element){const De=ke.element,$e=new Audio;$e.src=De.src,$e.volume=1,$e.loop=!1,$e.preload="auto";const Te=Se.inPoint||0,be=Se.outPoint||ke.duration||Se.duration;$e.setAttribute("data-clip-id",Se.id),$e.setAttribute("data-timeline-start",Se.start.toString()),$e.setAttribute("data-inpoint",Te.toString()),$e.setAttribute("data-outpoint",be.toString());const Oe=E.createMediaElementSource($e),je=E.createGain();je.gain.setValueAtTime(0,E.currentTime),console.log(`Setup clip ${Se.id.slice(-4)}: timeline[${Se.start}s-${(Se.start+Se.duration).toFixed(1)}s] source[${Te.toFixed(1)}s-${be.toFixed(1)}s]`),Oe.connect(je),je.connect(K),R.push({element:$e,source:Oe,clip:Se,gainNode:je})}})}),K.stream.getAudioTracks().forEach(Ee=>te.addTrack(Ee)));let X="video/mp4",ie="mp4";if(H)if(MediaRecorder.isTypeSupported("video/mp4;codecs=h264,aac"))X="video/mp4;codecs=h264,aac";else if(MediaRecorder.isTypeSupported("video/mp4;codecs=avc1,mp4a.40.2"))X="video/mp4;codecs=avc1,mp4a.40.2";else if(MediaRecorder.isTypeSupported("video/mp4"))X="video/mp4";else if(MediaRecorder.isTypeSupported("video/webm;codecs=vp9,opus"))X="video/webm;codecs=vp9,opus",ie="webm";else if(MediaRecorder.isTypeSupported("video/webm"))X="video/webm",ie="webm";else throw new Error("No supported video format found");else if(MediaRecorder.isTypeSupported("video/mp4;codecs=h264"))X="video/mp4;codecs=h264";else if(MediaRecorder.isTypeSupported("video/mp4;codecs=avc1"))X="video/mp4;codecs=avc1";else if(MediaRecorder.isTypeSupported("video/mp4"))X="video/mp4";else if(MediaRecorder.isTypeSupported("video/webm;codecs=vp9"))X="video/webm;codecs=vp9",ie="webm";else if(MediaRecorder.isTypeSupported("video/webm"))X="video/webm",ie="webm";else throw new Error("No supported video format found");const U=(Pe=>{const Ee={mimeType:X};switch(Pe){case"low":Ee.videoBitsPerSecond=1e6,H&&(Ee.audioBitsPerSecond=64e3);break;case"medium":Ee.videoBitsPerSecond=3e6,H&&(Ee.audioBitsPerSecond=128e3);break;case"high":Ee.videoBitsPerSecond=8e6,H&&(Ee.audioBitsPerSecond=192e3);break;case"ultra":Ee.videoBitsPerSecond=2e7,H&&(Ee.audioBitsPerSecond=32e4);break;default:Ee.videoBitsPerSecond=3e6,H&&(Ee.audioBitsPerSecond=128e3)}return Ee})(x);console.log(`Exporting with format: ${X}, quality: ${x}, video bitrate: ${U.videoBitsPerSecond}${U.audioBitsPerSecond?`, audio bitrate: ${U.audioBitsPerSecond}`:""}`);const W=new MediaRecorder(te,U),B=[];W.ondataavailable=Pe=>{Pe.data.size>0&&B.push(Pe.data)};const F=e.timeline.fps,q=1e3/F,V=Math.ceil(e.timeline.duration*F);let xe=0;const Y=performance.now();return console.log(`Starting export: ${V} frames at ${F}fps for ${e.timeline.duration}s duration`),new Promise((Pe,Ee)=>{const Se=[];for(let Te=0;Te<V;Te++){const be=Te/F,Oe=[],je=[];[...e.timeline.tracks].reverse().forEach(Ne=>{Ne.visible&&Ne.clips.forEach(le=>{const ze=le.start+d(le);if(be>=le.start&&be<=ze){const Xe=e.assets.find(lt=>lt.id===le.assetId);if(Xe!=null&&Xe.element){const lt=be-le.start;if(Xe.type==="video"){const Qt=Xe.element,Sn=le.inPoint||0,kn=le.outPoint||Xe.duration||le.duration;let nn;const Ht=le.playbackSpeed||1;if(le.reversed){const ct=1-lt/d(le);nn=Sn+ct*(kn-Sn)}else nn=lt*Ht+Sn;je.push({video:Qt,targetTime:nn}),Oe.push({clip:le,asset:Xe,relativeTime:lt})}else Xe.type==="image"&&Oe.push({clip:le,asset:Xe,relativeTime:lt})}}})}),Se.push({time:be,clipsToRender:Oe,videosToSync:je})}const ke=new Set,De=new Set,$e=()=>{if(xe>=V){console.log(`Export complete: ${xe} frames rendered in ${((performance.now()-Y)/1e3).toFixed(2)}s`),W.stop();return}xe===0&&(W.start(),R.length>0&&(console.log(`Starting ${R.length} audio clips with Web Audio scheduling...`),R.forEach(({element:ne,clip:Ne})=>{ne.play().catch(le=>console.log(`Audio play failed for clip ${Ne.id}:`,le))})));const Te=Se[xe],be=()=>{const ne=xe/F;R.forEach(({element:Ne,clip:le,gainNode:ze})=>{const Xe=le.start,lt=le.start+d(le),Qt=ne>=Xe&&ne<=lt,Sn=De.has(le.id),kn=ke.has(le.id);if(Qt&&!kn){const nn=e.assets.find(Ht=>Ht.id===le.assetId);if(nn){const Ht=le.inPoint||0,rn=le.outPoint||nn.duration||le.duration;try{const ct=le.playbackSpeed||1;le.reversed?(Ne.currentTime=rn,Ne.playbackRate=-ct):(Ne.currentTime=Ht,Ne.playbackRate=ct);const xr=ne-Xe,Sr=ve(le,xr);ze.gain.setValueAtTime(Sr,E.currentTime),ke.add(le.id),De.add(le.id),console.log(`Activated clip ${le.id.slice(-4)} at timeline ${ne.toFixed(2)}s, seeking to source ${Ne.currentTime.toFixed(2)}s, volume: ${Sr.toFixed(2)}`)}catch(ct){console.log(`Failed to seek clip ${le.id} on activation:`,ct)}}}else if(Qt&&!Sn){const nn=ne-Xe,Ht=ve(le,nn);ze.gain.setValueAtTime(Ht,E.currentTime),De.add(le.id),console.log(`Re-activated clip ${le.id.slice(-4)} at timeline ${ne.toFixed(2)}s, volume: ${Ht.toFixed(2)}`)}else if(Qt&&Sn){const nn=ne-Xe,Ht=ve(le,nn);ze.gain.setValueAtTime(Ht,E.currentTime)}else!Qt&&Sn&&(ze.gain.setValueAtTime(0,E.currentTime),De.delete(le.id),console.log(`Deactivated clip ${le.id.slice(-4)} at timeline ${ne.toFixed(2)}s`))})},Oe=()=>{let ne=0;const Ne=Te.videosToSync.length;if(Ne===0){je();return}const le=()=>{ne++,ne>=Ne&&je()};Te.videosToSync.forEach(({video:ze,targetTime:Xe})=>{const lt=1/F;if(Math.abs(ze.currentTime-Xe)>lt){const Qt=()=>{ze.removeEventListener("seeked",Qt),le()};ze.addEventListener("seeked",Qt),ze.currentTime=Xe}else le()})},je=()=>{D.fillStyle=e.backgroundColor,D.fillRect(0,0,_.width,_.height),be(),Te.clipsToRender.forEach(({clip:ze,asset:Xe,relativeTime:lt})=>{(Xe.type==="video"||Xe.type==="image")&&Ye(D,ze,Xe,lt,_.width,_.height)}),p(xe/V*100),xe++;const ne=Y+xe*q,Ne=performance.now(),le=Math.max(0,ne-Ne);setTimeout($e,le)};Oe()};W.onstop=()=>{R.forEach(({element:ne,source:Ne,gainNode:le})=>{ne.pause(),ne.currentTime=0,ne.playbackRate=1;try{Ne.disconnect(),le.disconnect()}catch(ze){console.log("Error disconnecting audio nodes:",ze)}ne.remove()}),R.length=0,E&&E.close().catch(ne=>console.log("Error closing audio context:",ne));const Te=new Blob(B,{type:X}),be=Te.size>0?"exported":"empty";console.log(`Export finished: ${be} blob, expected ${e.timeline.duration}s`);const Oe=URL.createObjectURL(Te),je=document.createElement("a");je.href=Oe,je.download=`${e.name}.${ie}`,je.click(),URL.revokeObjectURL(Oe),Pe()},W.onerror=Te=>{R.forEach(({element:be,source:Oe,gainNode:je})=>{be.pause(),be.currentTime=0,be.playbackRate=1;try{Oe.disconnect(),je.disconnect()}catch(ne){console.log("Error disconnecting audio nodes during cleanup:",ne)}be.remove()}),R.length=0,E&&E.close().catch(be=>console.log("Error closing audio context:",be)),Ee(Te)},$e()})},ve=(_,D)=>{var K;if(!((K=_.audioKeyframes)!=null&&K.volume)||_.audioKeyframes.volume.length===0)return 1;const E=[..._.audioKeyframes.volume].sort((R,H)=>R.time-H.time);if(D<=E[0].time)return E[0].value;if(D>=E[E.length-1].time)return E[E.length-1].value;for(let R=0;R<E.length-1;R++)if(D>=E[R].time&&D<=E[R+1].time){const H=E[R],X=E[R+1],ie=(D-H.time)/(X.time-H.time),L=X.easing||"linear";return Xh(H.value,X.value,ie,L)}return 1},Ye=(_,D,te,E,K,R)=>{_.save();const H=c(D.id,E)||{x:0,y:0,rotation:0,scaleX:1,scaleY:1,opacity:1};_.globalAlpha=H.opacity,_.translate(K/2,R/2),_.translate(H.x,H.y),_.rotate(H.rotation*Math.PI/180),_.scale(H.scaleX,H.scaleY);try{if(te.type==="video"){const X=te.element;_.drawImage(X,-X.videoWidth/2,-X.videoHeight/2)}else if(te.type==="image"){const X=te.element;_.drawImage(X,-X.naturalWidth/2,-X.naturalHeight/2)}}catch(X){console.warn("Failed to render clip to canvas during export:",X)}_.restore()},Be=(_,D)=>{r({...e,canvasWidth:_,canvasHeight:D})},vt=_=>{r({...e,timeline:{...e.timeline,duration:_}})},Me=()=>{let _=null;for(const D of e.timeline.tracks){for(const te of D.clips)if(i.includes(te.id)){const E=e.assets.find(K=>K.id===te.assetId);if(E&&E.width&&E.height&&(E.type==="video"||E.type==="image")){_=E;break}}if(_)break}_&&Be(_.width,_.height)},at=()=>{for(const _ of e.timeline.tracks)for(const D of _.clips)if(i.includes(D.id)){const te=e.assets.find(E=>E.id===D.assetId);if(te&&te.width&&te.height&&(te.type==="video"||te.type==="image"))return te}return null};return y.jsxs("div",{className:"toolbar",children:[y.jsx("button",{onClick:O,children:"Import"}),y.jsx("button",{onClick:J,children:"Save"}),y.jsx("button",{onClick:ee,children:"Load"}),y.jsx("button",{onClick:s,disabled:!a(),style:{opacity:a()?1:.5,cursor:a()?"pointer":"not-allowed"},title:"Undo (Ctrl+Z)",children:" Undo"}),y.jsx("button",{onClick:o,disabled:!l(),style:{opacity:l()?1:.5,cursor:l()?"pointer":"not-allowed"},title:"Redo (Ctrl+Y)",children:" Redo"}),y.jsx("button",{onClick:()=>h(!j),children:"Settings"}),y.jsx("button",{onClick:ae,disabled:v,style:{backgroundColor:v?"#666":"#ff4444",color:"white"},children:v?`Exporting... ${u.toFixed(0)}%`:`Export MP4 (${x.charAt(0).toUpperCase()+x.slice(1)})`}),y.jsx("button",{onClick:()=>{const{setShowPNGViewer:_}=ft.getState();_(!0)},style:{backgroundColor:"#4a90e2",color:"white"},title:"PNG Flipbook Viewer - Load and view PNG sequences",children:" PNG Flipbook"}),j&&y.jsxs("div",{style:{position:"absolute",top:"100%",left:"0",background:"#2a2a2a",border:"1px solid #555",padding:"15px",borderRadius:"4px",zIndex:1e3,minWidth:"250px"},children:[y.jsx("h4",{style:{marginBottom:"10px"},children:"Project Settings"}),y.jsxs("div",{style:{marginBottom:"10px"},children:[y.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"12px"},children:"Dimensions:"}),y.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[y.jsx("input",{type:"number",value:e.canvasWidth,onChange:_=>Be(parseInt(_.target.value)||1920,e.canvasHeight),style:{width:"80px",padding:"4px",background:"#3a3a3a",border:"1px solid #555",color:"white"}}),y.jsx("span",{children:""}),y.jsx("input",{type:"number",value:e.canvasHeight,onChange:_=>Be(e.canvasWidth,parseInt(_.target.value)||1080),style:{width:"80px",padding:"4px",background:"#3a3a3a",border:"1px solid #555",color:"white"}}),y.jsx("button",{onClick:Me,disabled:!at(),style:{padding:"4px 8px",fontSize:"10px",background:at()?"#4a90e2":"#666",color:"white",border:"none",borderRadius:"3px",cursor:at()?"pointer":"not-allowed",opacity:at()?1:.6},title:at()?`Adopt dimensions from ${(Z=at())==null?void 0:Z.name} (${(ue=at())==null?void 0:ue.width}${(Fe=at())==null?void 0:Fe.height})`:"Select a video or image clip to adopt its dimensions",children:""})]}),y.jsx("div",{style:{fontSize:"10px",color:"#aaa",marginTop:"5px"},children:"Common: 19201080 (HD), 1280720 (720p), 640360 (360p)"})]}),y.jsxs("div",{style:{marginBottom:"10px"},children:[y.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"12px"},children:"Duration (seconds):"}),y.jsx("input",{type:"number",min:"1",max:"3600",value:e.timeline.duration,onChange:_=>vt(parseFloat(_.target.value)||30),style:{width:"80px",padding:"4px",background:"#3a3a3a",border:"1px solid #555",color:"white"}}),y.jsx("div",{style:{fontSize:"10px",color:"#aaa",marginTop:"5px"},children:"Timeline length (1-3600 seconds)"})]}),y.jsxs("div",{style:{marginBottom:"10px"},children:[y.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"12px"},children:"Frame Rate (FPS):"}),y.jsx("input",{type:"number",min:"1",max:"240",value:e.timeline.fps,onChange:_=>{const D=parseInt(_.target.value)||30;D>=1&&D<=240&&m(D)},style:{width:"100px",padding:"4px",background:"#3a3a3a",border:"1px solid #555",color:"white",borderRadius:"3px",textAlign:"center"}}),y.jsxs("div",{style:{fontSize:"10px",color:"#aaa",marginTop:"5px"},children:["Frame duration: ",(1e3/e.timeline.fps).toFixed(1),"ms",y.jsx("br",{}),"Common: 24 (cinema), 30 (NTSC), 60 (smooth)"]})]}),y.jsxs("div",{style:{marginBottom:"10px"},children:[y.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"12px"},children:"Project Name:"}),y.jsx("input",{type:"text",value:e.name,onChange:_=>r({...e,name:_.target.value}),style:{width:"100%",padding:"4px",background:"#3a3a3a",border:"1px solid #555",color:"white"}})]}),y.jsxs("div",{style:{marginBottom:"10px"},children:[y.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"12px"},children:"Export Quality:"}),y.jsxs("select",{value:x,onChange:_=>S(_.target.value),style:{width:"100%",padding:"4px",background:"#3a3a3a",border:"1px solid #555",color:"white",borderRadius:"3px"},children:[y.jsx("option",{value:"low",children:"Low (1 Mbps - Fast, smaller files)"}),y.jsx("option",{value:"medium",children:"Medium (3 Mbps - Balanced quality)"}),y.jsx("option",{value:"high",children:"High (8 Mbps - Better quality)"}),y.jsx("option",{value:"ultra",children:"Ultra (20 Mbps - Best quality, larger files)"})]}),y.jsx("div",{style:{fontSize:"10px",color:"#aaa",marginTop:"4px"},children:"Higher quality = better video but larger file size"})]}),y.jsxs("div",{style:{marginBottom:"10px",padding:"10px",background:"#1a1a1a",borderRadius:"4px"},children:[y.jsx("div",{style:{fontSize:"12px",fontWeight:"bold",marginBottom:"5px"},children:"Export Format:"}),y.jsxs("div",{style:{fontSize:"11px",color:"#aaa"},children:[" Video: MP4 (H.264)",y.jsx("br",{})," Audio: AAC (industry standard)",y.jsx("br",{})," Quality: ",x.charAt(0).toUpperCase()+x.slice(1)," setting"]})]}),y.jsx("button",{onClick:()=>h(!1),style:{marginTop:"10px"},children:"Close"})]}),y.jsx("input",{ref:g,type:"file",accept:"video/*,audio/*,image/*",multiple:!0,onChange:b,className:"file-input"})]})},jv=({asset:e,isOpen:t,onClose:n})=>{const[r,i]=G.useState(!1),[s,o]=G.useState(0),[a,l]=G.useState(0),[c,d]=G.useState(!1),f=G.useRef(null),m=G.useRef(null),g=G.useRef(null),v=G.useRef(null);if(G.useEffect(()=>{i(!1),o(0),l(0)},[e]),G.useEffect(()=>{if(!e||!t)return;const S=e.type==="video"?f.current:m.current;if(!S)return;const b=()=>{l(S.duration),o(0)},T=()=>{o(S.currentTime)},z=()=>i(!0),O=()=>i(!1),J=()=>{i(!1),o(0),S.currentTime=0};return S.addEventListener("loadedmetadata",b),S.addEventListener("timeupdate",T),S.addEventListener("play",z),S.addEventListener("pause",O),S.addEventListener("ended",J),e.src&&S.src!==e.src&&(S.src=e.src),()=>{S.removeEventListener("loadedmetadata",b),S.removeEventListener("timeupdate",T),S.removeEventListener("play",z),S.removeEventListener("pause",O),S.removeEventListener("ended",J)}},[e,t]),G.useEffect(()=>{if((e==null?void 0:e.type)==="audio"&&e.waveform&&g.current){const S=g.current;Vh(S,e.waveform,0,e.waveform.length,400,60,"#00ff88")}},[e]),G.useEffect(()=>{const S=T=>{if(!c||!v.current||a===0||!e)return;const z=v.current.getBoundingClientRect(),ee=Math.max(0,Math.min(T.clientX-z.left,z.width))/z.width*a;o(ee);const P=e.type==="video"?f.current:m.current;P&&(P.currentTime=ee)},b=()=>{d(!1)};return c&&(document.addEventListener("mousemove",S),document.addEventListener("mouseup",b)),()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",b)}},[c,a,e]),!t||!e)return null;const w=()=>{const S=e.type==="video"?f.current:m.current;S&&(r?S.pause():S.play())},j=S=>{if(!v.current||a===0)return;const b=v.current.getBoundingClientRect(),O=(S.clientX-b.left)/b.width*a;o(O);const J=e.type==="video"?f.current:m.current;J&&(J.currentTime=O)},h=S=>{S.preventDefault(),d(!0),j(S)},u=S=>{if(!c||!v.current||a===0)return;const b=v.current.getBoundingClientRect(),O=Math.max(0,Math.min(S.clientX-b.left,b.width))/b.width*a;o(O);const J=e.type==="video"?f.current:m.current;J&&(J.currentTime=O)},p=()=>{d(!1)},x=S=>{const b=Math.floor(S/60),T=Math.floor(S%60),z=Math.floor(S%1*30);return`${b.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}:${z.toString().padStart(2,"0")}`};return y.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},onClick:n,children:y.jsxs("div",{style:{backgroundColor:"#2a2a2a",borderRadius:"8px",padding:"20px",minWidth:"500px",maxWidth:"800px",maxHeight:"90vh",overflow:"auto",border:"1px solid #555"},onClick:S=>S.stopPropagation(),children:[y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[y.jsx("h3",{style:{color:"white",margin:0},children:e.name}),y.jsx("button",{onClick:n,style:{background:"transparent",border:"none",color:"white",fontSize:"24px",cursor:"pointer",padding:"0",width:"30px",height:"30px"},children:""})]}),y.jsxs("div",{style:{backgroundColor:"#1a1a1a",borderRadius:"4px",padding:"10px",marginBottom:"20px",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"200px"},children:[e.type==="image"&&y.jsx("img",{src:e.src,alt:e.name,style:{maxWidth:"100%",maxHeight:"400px",objectFit:"contain"}}),e.type==="video"&&y.jsx("video",{ref:f,style:{maxWidth:"100%",maxHeight:"400px",backgroundColor:"#000"},controls:!1,muted:!1}),e.type==="audio"&&y.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"20px",width:"100%"},children:[y.jsx("div",{style:{fontSize:"48px",color:"#666"},children:""}),e.waveform&&y.jsxs("div",{style:{position:"relative",width:"400px",height:"60px"},children:[y.jsx("canvas",{ref:g,style:{width:"100%",height:"100%",border:"1px solid #555",borderRadius:"4px"}}),a>0&&y.jsx("div",{style:{position:"absolute",top:0,left:0,width:`${s/a*100}%`,height:"100%",backgroundColor:"rgba(255, 255, 255, 0.3)",pointerEvents:"none",borderRadius:"4px"}})]}),y.jsx("audio",{ref:m})]})]}),(e.type==="video"||e.type==="audio")&&y.jsxs("div",{style:{color:"white"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginBottom:"15px"},children:[y.jsx("button",{onClick:w,style:{backgroundColor:"#4a90e2",color:"white",border:"none",borderRadius:"4px",padding:"8px 12px",cursor:"pointer",fontSize:"14px"},children:r?" Pause":" Play"}),y.jsxs("span",{style:{fontSize:"14px",color:"#ccc"},children:[x(s)," / ",x(a)]})]}),y.jsxs("div",{ref:v,onMouseDown:h,onMouseMove:u,onMouseUp:p,style:{width:"100%",height:"8px",backgroundColor:"#444",borderRadius:"4px",cursor:c?"grabbing":"pointer",position:"relative",userSelect:"none"},children:[y.jsx("div",{style:{width:a>0?`${s/a*100}%`:"0%",height:"100%",backgroundColor:"#4a90e2",borderRadius:"4px",transition:"width 0.1s ease"}}),y.jsx("div",{style:{position:"absolute",left:a>0?`${s/a*100}%`:"0%",top:"50%",transform:"translate(-50%, -50%)",width:"12px",height:"12px",backgroundColor:"#ffffff",borderRadius:"50%",border:"2px solid #4a90e2"}})]})]}),y.jsxs("div",{style:{marginTop:"20px",fontSize:"12px",color:"#aaa",borderTop:"1px solid #444",paddingTop:"15px"},children:[y.jsxs("div",{children:["Type: ",e.type.toUpperCase()]}),e.duration&&y.jsxs("div",{children:["Duration: ",x(e.duration)]}),e.width&&e.height&&y.jsxs("div",{children:["Dimensions: ",e.width,"  ",e.height]})]})]})})},Av=()=>{const{project:e,selectedAssetId:t,selectAsset:n,addClipToTrack:r}=ft(),[i,s]=G.useState(null),[o,a]=G.useState(!1),l=v=>{n(v===t?null:v)},c=v=>{const w=e.assets.find(j=>j.id===v);w&&(s(w),a(!0))},d=v=>{const w=e.assets.find(h=>h.id===v);if(!w)return;const j=e.timeline.tracks.find(h=>(w.type==="video"||w.type==="image")&&h.type==="video"||w.type==="audio"&&h.type==="audio");if(j){const h={id:dt(),assetId:w.id,start:e.timeline.currentTime,duration:w.duration||5};if(r(j.id,h),w.type==="video"){const u=`${w.name} (Audio)`,p=e.assets.find(x=>x.type==="audio"&&x.name===u);if(p){let x=e.timeline.tracks.find(S=>S.type==="audio");if(!x){const{addTrack:S}=ft.getState();S("audio"),x=e.timeline.tracks.find(b=>b.type==="audio")}if(x){const S={id:dt(),assetId:p.id,start:e.timeline.currentTime,duration:p.duration||w.duration||5};r(x.id,S),console.log(`Added synchronized audio clip for ${w.name}`)}}}}},f=()=>{a(!1),s(null)},m=(v,w)=>{v.dataTransfer.setData("application/json",JSON.stringify({type:"asset",assetId:w.id})),window.currentDragAssetType=w.type},g=()=>{window.currentDragAssetType=null};return y.jsxs(y.Fragment,{children:[y.jsxs("div",{style:{padding:"10px"},children:[y.jsx("h3",{style:{marginBottom:"10px",fontSize:"14px"},children:"Assets"}),y.jsxs("div",{style:{marginBottom:"10px",fontSize:"11px",color:"#aaa",fontStyle:"italic"},children:[" Double-click to preview  Drag to timeline  + to add",y.jsx("br",{})," MP4 videos with audio will create both video and audio tracks automatically"]}),y.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[e.assets.map(v=>y.jsxs("div",{className:`asset-item ${t===v.id?"selected":""}`,onClick:()=>l(v.id),onDoubleClick:()=>c(v.id),draggable:!0,onDragStart:w=>m(w,v),onDragEnd:g,style:{backgroundColor:t===v.id?"#007acc":"#3a3a3a",cursor:"grab",userSelect:"none",position:"relative"},title:"Double-click to preview, drag to timeline, or use + button to add",children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"6px 8px",fontSize:"11px",height:"30px",position:"relative"},children:[y.jsxs("span",{style:{marginRight:"6px",fontSize:"12px"},children:[v.type==="video"&&"",v.type==="audio"&&"",v.type==="image"&&""]}),y.jsx("span",{style:{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:v.name}),v.type==="video"&&e.assets.some(w=>w.type==="audio"&&w.name===`${v.name} (Audio)`)&&y.jsx("span",{style:{marginLeft:"4px",fontSize:"10px",backgroundColor:"#00cc66",color:"white",padding:"1px 3px",borderRadius:"2px",fontWeight:"bold"},title:"This video has audio that will be added automatically",children:""}),v.duration&&y.jsxs("span",{style:{marginLeft:"4px",fontSize:"9px",color:"#aaa"},children:[Math.round(v.duration),"s"]})]}),y.jsx("button",{onClick:w=>{w.stopPropagation(),d(v.id)},style:{position:"absolute",top:"6px",right:"6px",width:"24px",height:"24px",borderRadius:"6px",backgroundColor:"#00cc66",color:"white",border:"none",cursor:"pointer",fontSize:"14px",display:"flex",alignItems:"center",justifyContent:"center",opacity:.8,fontWeight:"bold"},title:"Add to timeline at current time",onMouseEnter:w=>{w.currentTarget.style.opacity="1",w.currentTarget.style.transform="scale(1.1)"},onMouseLeave:w=>{w.currentTarget.style.opacity="0.8",w.currentTarget.style.transform="scale(1)"},children:"+"})]},v.id)),e.assets.length===0&&y.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#666",fontSize:"12px"},children:["No assets imported yet.",y.jsx("br",{}),"Use the Import button to add media files."]})]})]}),y.jsx(jv,{asset:i,isOpen:o,onClose:f})]})};function Ae(e,t,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(e,n):i?i.value=n:t.set(e,n),n}function A(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)}let Yh=function(){const{crypto:e}=globalThis;if(e!=null&&e.randomUUID)return Yh=e.randomUUID.bind(e),e.randomUUID();const t=new Uint8Array(1),n=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^n()&15>>+r/4).toString(16))};function oc(e){return typeof e=="object"&&e!==null&&("name"in e&&e.name==="AbortError"||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}const ac=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null){try{if(Object.prototype.toString.call(e)==="[object Error]"){const t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};class Ie extends Error{}class Nt extends Ie{constructor(t,n,r,i){super(`${Nt.makeMessage(t,n,r)}`),this.status=t,this.headers=i,this.requestID=i==null?void 0:i.get("x-request-id"),this.error=n;const s=n;this.code=s==null?void 0:s.code,this.param=s==null?void 0:s.param,this.type=s==null?void 0:s.type}static makeMessage(t,n,r){const i=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return t&&i?`${t} ${i}`:t?`${t} status code (no body)`:i||"(no status code or body)"}static generate(t,n,r,i){if(!t||!i)return new Ea({message:r,cause:ac(n)});const s=n==null?void 0:n.error;return t===400?new Qh(t,s,r,i):t===401?new Jh(t,s,r,i):t===403?new Gh(t,s,r,i):t===404?new qh(t,s,r,i):t===409?new Zh(t,s,r,i):t===422?new em(t,s,r,i):t===429?new tm(t,s,r,i):t>=500?new nm(t,s,r,i):new Nt(t,s,r,i)}}class yn extends Nt{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class Ea extends Nt{constructor({message:t,cause:n}){super(void 0,void 0,t||"Connection error.",void 0),n&&(this.cause=n)}}class pu extends Ea{constructor({message:t}={}){super({message:t??"Request timed out."})}}class Qh extends Nt{}class Jh extends Nt{}class Gh extends Nt{}class qh extends Nt{}class Zh extends Nt{}class em extends Nt{}class tm extends Nt{}class nm extends Nt{}class rm extends Ie{constructor(){super("Could not parse response content as the length limit was reached")}}class im extends Ie{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Ui extends Error{constructor(t){super(t)}}const Rv=/^[a-z][a-z0-9+.-]*:/i,Mv=e=>Rv.test(e);let Jt=e=>(Jt=Array.isArray,Jt(e)),qd=Jt;function $v(e){return typeof e!="object"?{}:e??{}}function Nv(e){if(!e)return!0;for(const t in e)return!1;return!0}function Dv(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function sl(e){return e!=null&&typeof e=="object"&&!Array.isArray(e)}const Ov=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new Ie(`${e} must be an integer`);if(t<0)throw new Ie(`${e} must be a positive integer`);return t},Lv=e=>{try{return JSON.parse(e)}catch{return}},As=e=>new Promise(t=>setTimeout(t,e)),Yr="5.8.2",Fv=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function zv(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const Uv=()=>{var n;const e=zv();if(e==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Yr,"X-Stainless-OS":ef(Deno.build.os),"X-Stainless-Arch":Zd(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((n=Deno.version)==null?void 0:n.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Yr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(e==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Yr,"X-Stainless-OS":ef(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Zd(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const t=Hv();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Yr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Yr,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Hv(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const r=n.exec(navigator.userAgent);if(r){const i=r[1]||0,s=r[2]||0,o=r[3]||0;return{browser:t,version:`${i}.${s}.${o}`}}}return null}const Zd=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",ef=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let tf;const Wv=()=>tf??(tf=Uv());function Bv(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function sm(...e){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function om(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return sm({start(){},async pull(n){const{done:r,value:i}=await t.next();r?n.close():n.enqueue(i)},async cancel(){var n;await((n=t.return)==null?void 0:n.call(t))}})}function am(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const n=await t.read();return n!=null&&n.done&&t.releaseLock(),n}catch(n){throw t.releaseLock(),n}},async return(){const n=t.cancel();return t.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Kv(e){var r,i;if(e===null||typeof e!="object")return;if(e[Symbol.asyncIterator]){await((i=(r=e[Symbol.asyncIterator]()).return)==null?void 0:i.call(r));return}const t=e.getReader(),n=t.cancel();t.releaseLock(),await n}const Xv=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),lm="RFC3986",cm=e=>String(e),nf={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:cm},Vv="RFC1738";let lc=(e,t)=>(lc=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),lc(e,t));const Rn=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),ol=1024,Yv=(e,t,n,r,i)=>{if(e.length===0)return e;let s=e;if(typeof e=="symbol"?s=Symbol.prototype.toString.call(e):typeof e!="string"&&(s=String(e)),n==="iso-8859-1")return escape(s).replace(/%u[0-9a-f]{4}/gi,function(a){return"%26%23"+parseInt(a.slice(2),16)+"%3B"});let o="";for(let a=0;a<s.length;a+=ol){const l=s.length>=ol?s.slice(a,a+ol):s,c=[];for(let d=0;d<l.length;++d){let f=l.charCodeAt(d);if(f===45||f===46||f===95||f===126||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||i===Vv&&(f===40||f===41)){c[c.length]=l.charAt(d);continue}if(f<128){c[c.length]=Rn[f];continue}if(f<2048){c[c.length]=Rn[192|f>>6]+Rn[128|f&63];continue}if(f<55296||f>=57344){c[c.length]=Rn[224|f>>12]+Rn[128|f>>6&63]+Rn[128|f&63];continue}d+=1,f=65536+((f&1023)<<10|l.charCodeAt(d)&1023),c[c.length]=Rn[240|f>>18]+Rn[128|f>>12&63]+Rn[128|f>>6&63]+Rn[128|f&63]}o+=c.join("")}return o};function Qv(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}function rf(e,t){if(Jt(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const um={brackets(e){return String(e)+"[]"},comma:"comma",indices(e,t){return String(e)+"["+t+"]"},repeat(e){return String(e)}},dm=function(e,t){Array.prototype.push.apply(e,Jt(t)?t:[t])};let sf;const _t={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Yv,encodeValuesOnly:!1,format:lm,formatter:cm,indices:!1,serializeDate(e){return(sf??(sf=Function.prototype.call.bind(Date.prototype.toISOString)))(e)},skipNulls:!1,strictNullHandling:!1};function Jv(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"}const al={};function fm(e,t,n,r,i,s,o,a,l,c,d,f,m,g,v,w,j,h){let u=e,p=h,x=0,S=!1;for(;(p=p.get(al))!==void 0&&!S;){const J=p.get(e);if(x+=1,typeof J<"u"){if(J===x)throw new RangeError("Cyclic object value");S=!0}typeof p.get(al)>"u"&&(x=0)}if(typeof c=="function"?u=c(t,u):u instanceof Date?u=m==null?void 0:m(u):n==="comma"&&Jt(u)&&(u=rf(u,function(J){return J instanceof Date?m==null?void 0:m(J):J})),u===null){if(s)return l&&!w?l(t,_t.encoder,j,"key",g):t;u=""}if(Jv(u)||Qv(u)){if(l){const J=w?t:l(t,_t.encoder,j,"key",g);return[(v==null?void 0:v(J))+"="+(v==null?void 0:v(l(u,_t.encoder,j,"value",g)))]}return[(v==null?void 0:v(t))+"="+(v==null?void 0:v(String(u)))]}const b=[];if(typeof u>"u")return b;let T;if(n==="comma"&&Jt(u))w&&l&&(u=rf(u,l)),T=[{value:u.length>0?u.join(",")||null:void 0}];else if(Jt(c))T=c;else{const J=Object.keys(u);T=d?J.sort(d):J}const z=a?String(t).replace(/\./g,"%2E"):String(t),O=r&&Jt(u)&&u.length===1?z+"[]":z;if(i&&Jt(u)&&u.length===0)return O+"[]";for(let J=0;J<T.length;++J){const ee=T[J],P=typeof ee=="object"&&typeof ee.value<"u"?ee.value:u[ee];if(o&&P===null)continue;const _e=f&&a?ee.replace(/\./g,"%2E"):ee,ht=Jt(u)?typeof n=="function"?n(O,_e):O:O+(f?"."+_e:"["+_e+"]");h.set(e,x);const Je=new WeakMap;Je.set(al,h),dm(b,fm(P,ht,n,r,i,s,o,a,n==="comma"&&w&&Jt(u)?null:l,c,d,f,m,g,v,w,j,Je))}return b}function Gv(e=_t){if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");const t=e.charset||_t.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=lm;if(typeof e.format<"u"){if(!lc(nf,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=nf[n];let i=_t.filter;(typeof e.filter=="function"||Jt(e.filter))&&(i=e.filter);let s;if(e.arrayFormat&&e.arrayFormat in um?s=e.arrayFormat:"indices"in e?s=e.indices?"indices":"repeat":s=_t.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const o=typeof e.allowDots>"u"?e.encodeDotInKeys?!0:_t.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:_t.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:_t.allowEmptyArrays,arrayFormat:s,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:_t.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?_t.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:_t.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:_t.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:_t.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:_t.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:_t.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:_t.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:_t.strictNullHandling}}function qv(e,t={}){let n=e;const r=Gv(t);let i,s;typeof r.filter=="function"?(s=r.filter,n=s("",n)):Jt(r.filter)&&(s=r.filter,i=s);const o=[];if(typeof n!="object"||n===null)return"";const a=um[r.arrayFormat],l=a==="comma"&&r.commaRoundTrip;i||(i=Object.keys(n)),r.sort&&i.sort(r.sort);const c=new WeakMap;for(let m=0;m<i.length;++m){const g=i[m];r.skipNulls&&n[g]===null||dm(o,fm(n[g],g,a,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const d=o.join(r.delimiter);let f=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),d.length>0?f+d:""}function Zv(e){let t=0;for(const i of e)t+=i.length;const n=new Uint8Array(t);let r=0;for(const i of e)n.set(i,r),r+=i.length;return n}let of;function hu(e){let t;return(of??(t=new globalThis.TextEncoder,of=t.encode.bind(t)))(e)}let af;function lf(e){let t;return(af??(t=new globalThis.TextDecoder,af=t.decode.bind(t)))(e)}var sn,on;class ba{constructor(){sn.set(this,void 0),on.set(this,void 0),Ae(this,sn,new Uint8Array,"f"),Ae(this,on,null,"f")}decode(t){if(t==null)return[];const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?hu(t):t;Ae(this,sn,Zv([A(this,sn,"f"),n]),"f");const r=[];let i;for(;(i=ew(A(this,sn,"f"),A(this,on,"f")))!=null;){if(i.carriage&&A(this,on,"f")==null){Ae(this,on,i.index,"f");continue}if(A(this,on,"f")!=null&&(i.index!==A(this,on,"f")+1||i.carriage)){r.push(lf(A(this,sn,"f").subarray(0,A(this,on,"f")-1))),Ae(this,sn,A(this,sn,"f").subarray(A(this,on,"f")),"f"),Ae(this,on,null,"f");continue}const s=A(this,on,"f")!==null?i.preceding-1:i.preceding,o=lf(A(this,sn,"f").subarray(0,s));r.push(o),Ae(this,sn,A(this,sn,"f").subarray(i.index),"f"),Ae(this,on,null,"f")}return r}flush(){return A(this,sn,"f").length?this.decode(`
`):[]}}sn=new WeakMap,on=new WeakMap;ba.NEWLINE_CHARS=new Set([`
`,"\r"]);ba.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function ew(e,t){for(let i=t??0;i<e.length;i++){if(e[i]===10)return{preceding:i,index:i+1,carriage:!1};if(e[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function tw(e){for(let r=0;r<e.length-1;r++){if(e[r]===10&&e[r+1]===10||e[r]===13&&e[r+1]===13)return r+2;if(e[r]===13&&e[r+1]===10&&r+3<e.length&&e[r+2]===13&&e[r+3]===10)return r+4}return-1}class Dn{constructor(t,n){this.iterator=t,this.controller=n}static fromSSEResponse(t,n){let r=!1;async function*i(){if(r)throw new Ie("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const o of nw(t,n))if(!s){if(o.data.startsWith("[DONE]")){s=!0;continue}if(o.event===null||o.event.startsWith("response.")||o.event.startsWith("transcript.")){let a;try{a=JSON.parse(o.data)}catch(l){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),l}if(a&&a.error)throw new Nt(void 0,a.error,void 0,t.headers);yield a}else{let a;try{a=JSON.parse(o.data)}catch(l){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),l}if(o.event=="error")throw new Nt(void 0,a.error,a.message,void 0);yield{event:o.event,data:a}}}s=!0}catch(o){if(oc(o))return;throw o}finally{s||n.abort()}}return new Dn(i,n)}static fromReadableStream(t,n){let r=!1;async function*i(){const o=new ba,a=am(t);for await(const l of a)for(const c of o.decode(l))yield c;for(const l of o.flush())yield l}async function*s(){if(r)throw new Ie("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const a of i())o||a&&(yield JSON.parse(a));o=!0}catch(a){if(oc(a))return;throw a}finally{o||n.abort()}}return new Dn(s,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],n=[],r=this.iterator(),i=s=>({next:()=>{if(s.length===0){const o=r.next();t.push(o),n.push(o)}return s.shift()}});return[new Dn(()=>i(t),this.controller),new Dn(()=>i(n),this.controller)]}toReadableStream(){const t=this;let n;return sm({async start(){n=t[Symbol.asyncIterator]()},async pull(r){try{const{value:i,done:s}=await n.next();if(s)return r.close();const o=hu(JSON.stringify(i)+`
`);r.enqueue(o)}catch(i){r.error(i)}},async cancel(){var r;await((r=n.return)==null?void 0:r.call(n))}})}}async function*nw(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Ie("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Ie("Attempted to iterate over a response with no body");const n=new iw,r=new ba,i=am(e.body);for await(const s of rw(i))for(const o of r.decode(s)){const a=n.decode(o);a&&(yield a)}for(const s of r.flush()){const o=n.decode(s);o&&(yield o)}}async function*rw(e){let t=new Uint8Array;for await(const n of e){if(n==null)continue;const r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?hu(n):n;let i=new Uint8Array(t.length+r.length);i.set(t),i.set(r,t.length),t=i;let s;for(;(s=tw(t))!==-1;)yield t.slice(0,s),t=t.slice(s)}t.length>0&&(yield t)}class iw{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(t),t.startsWith(":"))return null;let[n,r,i]=sw(t,":");return i.startsWith(" ")&&(i=i.substring(1)),n==="event"?this.event=i:n==="data"&&this.data.push(i),null}}function sw(e,t){const n=e.indexOf(t);return n!==-1?[e.substring(0,n),t,e.substring(n+t.length)]:[e,"",""]}const ta={off:0,error:200,warn:300,info:400,debug:500},cf=(e,t,n)=>{if(e){if(Dv(ta,e))return e;Lt(n).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(ta))}`)}};function Hi(){}function to(e,t,n){return!t||ta[e]>ta[n]?Hi:t[e].bind(t)}const ow={error:Hi,warn:Hi,info:Hi,debug:Hi};let uf=new WeakMap;function Lt(e){const t=e.logger,n=e.logLevel??"off";if(!t)return ow;const r=uf.get(t);if(r&&r[0]===n)return r[1];const i={error:to("error",t,n),warn:to("warn",t,n),info:to("info",t,n),debug:to("debug",t,n)};return uf.set(t,[n,i]),i}const Er=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([t,n])=>[t,t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);async function pm(e,t){const{response:n,requestLogID:r,retryOfRequestLogID:i,startTime:s}=t,o=await(async()=>{var f;if(t.options.stream)return Lt(e).debug("response",n.status,n.url,n.headers,n.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(n,t.controller):Dn.fromSSEResponse(n,t.controller);if(n.status===204)return null;if(t.options.__binaryResponse)return n;const a=n.headers.get("content-type"),l=(f=a==null?void 0:a.split(";")[0])==null?void 0:f.trim();if((l==null?void 0:l.includes("application/json"))||(l==null?void 0:l.endsWith("+json"))){const m=await n.json();return hm(m,n)}return await n.text()})();return Lt(e).debug(`[${r}] response parsed`,Er({retryOfRequestLogID:i,url:n.url,status:n.status,body:o,durationMs:Date.now()-s})),o}function hm(e,t){return!e||typeof e!="object"||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}var Wi;class Ta extends Promise{constructor(t,n,r=pm){super(i=>{i(null)}),this.responsePromise=n,this.parseResponse=r,Wi.set(this,void 0),Ae(this,Wi,t,"f")}_thenUnwrap(t){return new Ta(A(this,Wi,"f"),this.responsePromise,async(n,r)=>hm(t(await this.parseResponse(n,r),r),r.response))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(A(this,Wi,"f"),t))),this.parsedPromise}then(t,n){return this.parse().then(t,n)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}Wi=new WeakMap;var no;class mm{constructor(t,n,r,i){no.set(this,void 0),Ae(this,no,t,"f"),this.options=i,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const t=this.nextPageRequestOptions();if(!t)throw new Ie("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await A(this,no,"f").requestAPIList(this.constructor,t)}async*iterPages(){let t=this;for(yield t;t.hasNextPage();)t=await t.getNextPage(),yield t}async*[(no=new WeakMap,Symbol.asyncIterator)](){for await(const t of this.iterPages())for(const n of t.getPaginatedItems())yield n}}class aw extends Ta{constructor(t,n,r){super(t,n,async(i,s)=>new r(i,s.response,await pm(i,s),s.options))}async*[Symbol.asyncIterator](){const t=await this;for await(const n of t)yield n}}class Pa extends mm{constructor(t,n,r,i){super(t,n,r,i),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class yt extends mm{constructor(t,n,r,i){super(t,n,r,i),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var r;const t=this.getPaginatedItems(),n=(r=t[t.length-1])==null?void 0:r.id;return n?{...this.options,query:{...$v(this.options.query),after:n}}:null}}const gm=()=>{var e;if(typeof File>"u"){const{process:t}=globalThis,n=typeof((e=t==null?void 0:t.versions)==null?void 0:e.node)=="string"&&parseInt(t.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ss(e,t,n){return gm(),new File(e,t??"unknown_file",n)}function ko(e){return(typeof e=="object"&&e!==null&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}const ym=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function",Fr=async(e,t)=>({...e,body:await cw(e.body,t)}),df=new WeakMap;function lw(e){const t=typeof e=="function"?e:e.fetch,n=df.get(t);if(n)return n;const r=(async()=>{try{const i="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;return s.toString()!==await new i(s).text()}catch{return!0}})();return df.set(t,r),r}const cw=async(e,t)=>{if(!await lw(t))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const n=new FormData;return await Promise.all(Object.entries(e||{}).map(([r,i])=>cc(n,r,i))),n},uw=e=>e instanceof Blob&&"name"in e,cc=async(e,t,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")e.append(t,String(n));else if(n instanceof Response)e.append(t,ss([await n.blob()],ko(n)));else if(ym(n))e.append(t,ss([await new Response(om(n)).blob()],ko(n)));else if(uw(n))e.append(t,n,ko(n));else if(Array.isArray(n))await Promise.all(n.map(r=>cc(e,t+"[]",r)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([r,i])=>cc(e,`${t}[${r}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}},vm=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",dw=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&vm(e),fw=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function";async function pw(e,t,n){if(gm(),e=await e,dw(e))return e instanceof File?e:ss([await e.arrayBuffer()],e.name);if(fw(e)){const i=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),ss(await uc(i),t,n)}const r=await uc(e);if(t||(t=ko(e)),!(n!=null&&n.type)){const i=r.find(s=>typeof s=="object"&&"type"in s&&s.type);typeof i=="string"&&(n={...n,type:i})}return ss(r,t,n)}async function uc(e){var n;let t=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(vm(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(ym(e))for await(const r of e)t.push(...await uc(r));else{const r=(n=e==null?void 0:e.constructor)==null?void 0:n.name;throw new Error(`Unexpected data type: ${typeof e}${r?`; constructor: ${r}`:""}${hw(e)}`)}return t}function hw(e){return typeof e!="object"||e===null?"":`; props: [${Object.getOwnPropertyNames(e).map(n=>`"${n}"`).join(", ")}]`}class Re{constructor(t){this._client=t}}function wm(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const mw=(e=wm)=>function(n,...r){if(n.length===1)return n[0];let i=!1;const s=n.reduce((d,f,m)=>(/[?#]/.test(f)&&(i=!0),d+f+(m===r.length?"":(i?encodeURIComponent:e)(String(r[m])))),""),o=s.split(/[?#]/,1)[0],a=[],l=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=l.exec(o))!==null;)a.push({start:c.index,length:c[0].length});if(a.length>0){let d=0;const f=a.reduce((m,g)=>{const v=" ".repeat(g.start-d),w="^".repeat(g.length);return d=g.start+g.length,m+v+w},"");throw new Ie(`Path parameters result in path with invalid segments:
${s}
${f}`)}return s},se=mw(wm);let xm=class extends Re{list(t,n={},r){return this._client.getAPIList(se`/chat/completions/${t}/messages`,yt,{query:n,...r})}};function gw(e){return typeof e.parse=="function"}const na=e=>(e==null?void 0:e.role)==="assistant",Sm=e=>(e==null?void 0:e.role)==="tool";var dc,_o,Co,Bi,Ki,Eo,Xi,zn,Vi,ra,ia,Qr,km;class mu{constructor(){dc.add(this),this.controller=new AbortController,_o.set(this,void 0),Co.set(this,()=>{}),Bi.set(this,()=>{}),Ki.set(this,void 0),Eo.set(this,()=>{}),Xi.set(this,()=>{}),zn.set(this,{}),Vi.set(this,!1),ra.set(this,!1),ia.set(this,!1),Qr.set(this,!1),Ae(this,_o,new Promise((t,n)=>{Ae(this,Co,t,"f"),Ae(this,Bi,n,"f")}),"f"),Ae(this,Ki,new Promise((t,n)=>{Ae(this,Eo,t,"f"),Ae(this,Xi,n,"f")}),"f"),A(this,_o,"f").catch(()=>{}),A(this,Ki,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emitFinal(),this._emit("end")},A(this,dc,"m",km).bind(this))},0)}_connected(){this.ended||(A(this,Co,"f").call(this),this._emit("connect"))}get ended(){return A(this,Vi,"f")}get errored(){return A(this,ra,"f")}get aborted(){return A(this,ia,"f")}abort(){this.controller.abort()}on(t,n){return(A(this,zn,"f")[t]||(A(this,zn,"f")[t]=[])).push({listener:n}),this}off(t,n){const r=A(this,zn,"f")[t];if(!r)return this;const i=r.findIndex(s=>s.listener===n);return i>=0&&r.splice(i,1),this}once(t,n){return(A(this,zn,"f")[t]||(A(this,zn,"f")[t]=[])).push({listener:n,once:!0}),this}emitted(t){return new Promise((n,r)=>{Ae(this,Qr,!0,"f"),t!=="error"&&this.once("error",r),this.once(t,n)})}async done(){Ae(this,Qr,!0,"f"),await A(this,Ki,"f")}_emit(t,...n){if(A(this,Vi,"f"))return;t==="end"&&(Ae(this,Vi,!0,"f"),A(this,Eo,"f").call(this));const r=A(this,zn,"f")[t];if(r&&(A(this,zn,"f")[t]=r.filter(i=>!i.once),r.forEach(({listener:i})=>i(...n))),t==="abort"){const i=n[0];!A(this,Qr,"f")&&!(r!=null&&r.length)&&Promise.reject(i),A(this,Bi,"f").call(this,i),A(this,Xi,"f").call(this,i),this._emit("end");return}if(t==="error"){const i=n[0];!A(this,Qr,"f")&&!(r!=null&&r.length)&&Promise.reject(i),A(this,Bi,"f").call(this,i),A(this,Xi,"f").call(this,i),this._emit("end")}}_emitFinal(){}}_o=new WeakMap,Co=new WeakMap,Bi=new WeakMap,Ki=new WeakMap,Eo=new WeakMap,Xi=new WeakMap,zn=new WeakMap,Vi=new WeakMap,ra=new WeakMap,ia=new WeakMap,Qr=new WeakMap,dc=new WeakSet,km=function(t){if(Ae(this,ra,!0,"f"),t instanceof Error&&t.name==="AbortError"&&(t=new yn),t instanceof yn)return Ae(this,ia,!0,"f"),this._emit("abort",t);if(t instanceof Ie)return this._emit("error",t);if(t instanceof Error){const n=new Ie(t.message);return n.cause=t,this._emit("error",n)}return this._emit("error",new Ie(String(t)))};function gu(e){return(e==null?void 0:e.$brand)==="auto-parseable-response-format"}function Rs(e){return(e==null?void 0:e.$brand)==="auto-parseable-tool"}function yw(e,t){return!t||!_m(t)?{...e,choices:e.choices.map(n=>({...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:yu(e,t)}function yu(e,t){const n=e.choices.map(r=>{var i;if(r.finish_reason==="length")throw new rm;if(r.finish_reason==="content_filter")throw new im;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:((i=r.message.tool_calls)==null?void 0:i.map(s=>ww(t,s)))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?vw(t,r.message.content):null}}});return{...e,choices:n}}function vw(e,t){var n,r;return((n=e.response_format)==null?void 0:n.type)!=="json_schema"?null:((r=e.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in e.response_format?e.response_format.$parseRaw(t):JSON.parse(t):null}function ww(e,t){var r;const n=(r=e.tools)==null?void 0:r.find(i=>{var s;return((s=i.function)==null?void 0:s.name)===t.function.name});return{...t,function:{...t.function,parsed_arguments:Rs(n)?n.$parseRaw(t.function.arguments):n!=null&&n.function.strict?JSON.parse(t.function.arguments):null}}}function xw(e,t){var r;if(!e)return!1;const n=(r=e.tools)==null?void 0:r.find(i=>{var s;return((s=i.function)==null?void 0:s.name)===t.function.name});return Rs(n)||(n==null?void 0:n.function.strict)||!1}function _m(e){var t;return gu(e.response_format)?!0:((t=e.tools)==null?void 0:t.some(n=>Rs(n)||n.type==="function"&&n.function.strict===!0))??!1}function Sw(e){for(const t of e??[]){if(t.type!=="function")throw new Ie(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(t.function.strict!==!0)throw new Ie(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Wt,fc,sa,pc,hc,mc,Cm,Em;const kw=10;class bm extends mu{constructor(){super(...arguments),Wt.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(t){var r;this._chatCompletions.push(t),this._emit("chatCompletion",t);const n=(r=t.choices[0])==null?void 0:r.message;return n&&this._addMessage(n),t}_addMessage(t,n=!0){if("content"in t||(t.content=null),this.messages.push(t),n){if(this._emit("message",t),Sm(t)&&t.content)this._emit("functionToolCallResult",t.content);else if(na(t)&&t.tool_calls)for(const r of t.tool_calls)r.type==="function"&&this._emit("functionToolCall",r.function)}}async finalChatCompletion(){await this.done();const t=this._chatCompletions[this._chatCompletions.length-1];if(!t)throw new Ie("stream ended without producing a ChatCompletion");return t}async finalContent(){return await this.done(),A(this,Wt,"m",fc).call(this)}async finalMessage(){return await this.done(),A(this,Wt,"m",sa).call(this)}async finalFunctionToolCall(){return await this.done(),A(this,Wt,"m",pc).call(this)}async finalFunctionToolCallResult(){return await this.done(),A(this,Wt,"m",hc).call(this)}async totalUsage(){return await this.done(),A(this,Wt,"m",mc).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const t=this._chatCompletions[this._chatCompletions.length-1];t&&this._emit("finalChatCompletion",t);const n=A(this,Wt,"m",sa).call(this);n&&this._emit("finalMessage",n);const r=A(this,Wt,"m",fc).call(this);r&&this._emit("finalContent",r);const i=A(this,Wt,"m",pc).call(this);i&&this._emit("finalFunctionToolCall",i);const s=A(this,Wt,"m",hc).call(this);s!=null&&this._emit("finalFunctionToolCallResult",s),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",A(this,Wt,"m",mc).call(this))}async _createChatCompletion(t,n,r){const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),A(this,Wt,"m",Cm).call(this,n);const s=await t.chat.completions.create({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(yu(s,n))}async _runChatCompletion(t,n,r){for(const i of n.messages)this._addMessage(i,!1);return await this._createChatCompletion(t,n,r)}async _runTools(t,n,r){var g,v,w;const i="tool",{tool_choice:s="auto",stream:o,...a}=n,l=typeof s!="string"&&((g=s==null?void 0:s.function)==null?void 0:g.name),{maxChatCompletions:c=kw}=r||{},d=n.tools.map(j=>{if(Rs(j)){if(!j.$callback)throw new Ie("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:j.$callback,name:j.function.name,description:j.function.description||"",parameters:j.function.parameters,parse:j.$parseRaw,strict:!0}}}return j}),f={};for(const j of d)j.type==="function"&&(f[j.function.name||j.function.function.name]=j.function);const m="tools"in n?d.map(j=>j.type==="function"?{type:"function",function:{name:j.function.name||j.function.function.name,parameters:j.function.parameters,description:j.function.description,strict:j.function.strict}}:j):void 0;for(const j of n.messages)this._addMessage(j,!1);for(let j=0;j<c;++j){const u=(v=(await this._createChatCompletion(t,{...a,tool_choice:s,tools:m,messages:[...this.messages]},r)).choices[0])==null?void 0:v.message;if(!u)throw new Ie("missing message in ChatCompletion response");if(!((w=u.tool_calls)!=null&&w.length))return;for(const p of u.tool_calls){if(p.type!=="function")continue;const x=p.id,{name:S,arguments:b}=p.function,T=f[S];if(T){if(l&&l!==S){const ee=`Invalid tool_call: ${JSON.stringify(S)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:i,tool_call_id:x,content:ee});continue}}else{const ee=`Invalid tool_call: ${JSON.stringify(S)}. Available options are: ${Object.keys(f).map(P=>JSON.stringify(P)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:x,content:ee});continue}let z;try{z=gw(T)?await T.parse(b):b}catch(ee){const P=ee instanceof Error?ee.message:String(ee);this._addMessage({role:i,tool_call_id:x,content:P});continue}const O=await T.function(z,this),J=A(this,Wt,"m",Em).call(this,O);if(this._addMessage({role:i,tool_call_id:x,content:J}),l)return}}}}Wt=new WeakSet,fc=function(){return A(this,Wt,"m",sa).call(this).content??null},sa=function(){let t=this.messages.length;for(;t-- >0;){const n=this.messages[t];if(na(n))return{...n,content:n.content??null,refusal:n.refusal??null}}throw new Ie("stream ended without producing a ChatCompletionMessage with role=assistant")},pc=function(){var t,n;for(let r=this.messages.length-1;r>=0;r--){const i=this.messages[r];if(na(i)&&((t=i==null?void 0:i.tool_calls)!=null&&t.length))return(n=i.tool_calls.at(-1))==null?void 0:n.function}},hc=function(){for(let t=this.messages.length-1;t>=0;t--){const n=this.messages[t];if(Sm(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(r=>{var i;return r.role==="assistant"&&((i=r.tool_calls)==null?void 0:i.some(s=>s.type==="function"&&s.id===n.tool_call_id))}))return n.content}},mc=function(){const t={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(t.completion_tokens+=n.completion_tokens,t.prompt_tokens+=n.prompt_tokens,t.total_tokens+=n.total_tokens);return t},Cm=function(t){if(t.n!=null&&t.n>1)throw new Ie("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Em=function(t){return typeof t=="string"?t:t===void 0?"undefined":JSON.stringify(t)};class vu extends bm{static runTools(t,n,r){const i=new vu,s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(t,n,s)),i}_addMessage(t,n=!0){super._addMessage(t,n),na(t)&&t.content&&this._emit("content",t.content)}}const Tm=1,Pm=2,Im=4,jm=8,Am=16,Rm=32,Mm=64,$m=128,Nm=256,Dm=$m|Nm,Om=Am|Rm|Dm|Mm,Lm=Tm|Pm|Om,Fm=Im|jm,_w=Lm|Fm,Tt={STR:Tm,NUM:Pm,ARR:Im,OBJ:jm,NULL:Am,BOOL:Rm,NAN:Mm,INFINITY:$m,MINUS_INFINITY:Nm,INF:Dm,SPECIAL:Om,ATOM:Lm,COLLECTION:Fm,ALL:_w};class Cw extends Error{}class Ew extends Error{}function bw(e,t=Tt.ALL){if(typeof e!="string")throw new TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw new Error(`${e} is empty`);return Tw(e.trim(),t)}const Tw=(e,t)=>{const n=e.length;let r=0;const i=m=>{throw new Cw(`${m} at position ${r}`)},s=m=>{throw new Ew(`${m} at position ${r}`)},o=()=>(f(),r>=n&&i("Unexpected end of input"),e[r]==='"'?a():e[r]==="{"?l():e[r]==="["?c():e.substring(r,r+4)==="null"||Tt.NULL&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):e.substring(r,r+4)==="true"||Tt.BOOL&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):e.substring(r,r+5)==="false"||Tt.BOOL&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):e.substring(r,r+8)==="Infinity"||Tt.INFINITY&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):e.substring(r,r+9)==="-Infinity"||Tt.MINUS_INFINITY&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):e.substring(r,r+3)==="NaN"||Tt.NAN&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):d()),a=()=>{const m=r;let g=!1;for(r++;r<n&&(e[r]!=='"'||g&&e[r-1]==="\\");)g=e[r]==="\\"?!g:!1,r++;if(e.charAt(r)=='"')try{return JSON.parse(e.substring(m,++r-Number(g)))}catch(v){s(String(v))}else if(Tt.STR&t)try{return JSON.parse(e.substring(m,r-Number(g))+'"')}catch{return JSON.parse(e.substring(m,e.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},l=()=>{r++,f();const m={};try{for(;e[r]!=="}";){if(f(),r>=n&&Tt.OBJ&t)return m;const g=a();f(),r++;try{const v=o();Object.defineProperty(m,g,{value:v,writable:!0,enumerable:!0,configurable:!0})}catch(v){if(Tt.OBJ&t)return m;throw v}f(),e[r]===","&&r++}}catch{if(Tt.OBJ&t)return m;i("Expected '}' at end of object")}return r++,m},c=()=>{r++;const m=[];try{for(;e[r]!=="]";)m.push(o()),f(),e[r]===","&&r++}catch{if(Tt.ARR&t)return m;i("Expected ']' at end of array")}return r++,m},d=()=>{if(r===0){e==="-"&&Tt.NUM&t&&i("Not sure what '-' is");try{return JSON.parse(e)}catch(g){if(Tt.NUM&t)try{return e[e.length-1]==="."?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch{}s(String(g))}}const m=r;for(e[r]==="-"&&r++;e[r]&&!",]}".includes(e[r]);)r++;r==n&&!(Tt.NUM&t)&&i("Unterminated number literal");try{return JSON.parse(e.substring(m,r))}catch{e.substring(m,r)==="-"&&Tt.NUM&t&&i("Not sure what '-' is");try{return JSON.parse(e.substring(m,e.lastIndexOf("e")))}catch(v){s(String(v))}}},f=()=>{for(;r<n&&` 
\r	`.includes(e[r]);)r++};return o()},ff=e=>bw(e,Tt.ALL^Tt.NUM);var kt,Fn,Kr,Zn,ll,ro,cl,ul,dl,io,fl,pf;class Es extends bm{constructor(t){super(),kt.add(this),Fn.set(this,void 0),Kr.set(this,void 0),Zn.set(this,void 0),Ae(this,Fn,t,"f"),Ae(this,Kr,[],"f")}get currentChatCompletionSnapshot(){return A(this,Zn,"f")}static fromReadableStream(t){const n=new Es(null);return n._run(()=>n._fromReadableStream(t)),n}static createChatCompletion(t,n,r){const i=new Es(n);return i._run(()=>i._runChatCompletion(t,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(t,n,r){var o;super._createChatCompletion;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),A(this,kt,"m",ll).call(this);const s=await t.chat.completions.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const a of s)A(this,kt,"m",cl).call(this,a);if((o=s.controller.signal)!=null&&o.aborted)throw new yn;return this._addChatCompletion(A(this,kt,"m",io).call(this))}async _fromReadableStream(t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),A(this,kt,"m",ll).call(this),this._connected();const i=Dn.fromReadableStream(t,this.controller);let s;for await(const a of i)s&&s!==a.id&&this._addChatCompletion(A(this,kt,"m",io).call(this)),A(this,kt,"m",cl).call(this,a),s=a.id;if((o=i.controller.signal)!=null&&o.aborted)throw new yn;return this._addChatCompletion(A(this,kt,"m",io).call(this))}[(Fn=new WeakMap,Kr=new WeakMap,Zn=new WeakMap,kt=new WeakSet,ll=function(){this.ended||Ae(this,Zn,void 0,"f")},ro=function(n){let r=A(this,Kr,"f")[n.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},A(this,Kr,"f")[n.index]=r,r)},cl=function(n){var i,s,o,a,l,c,d,f,m,g,v,w,j,h,u;if(this.ended)return;const r=A(this,kt,"m",pf).call(this,n);this._emit("chunk",n,r);for(const p of n.choices){const x=r.choices[p.index];p.delta.content!=null&&((i=x.message)==null?void 0:i.role)==="assistant"&&((s=x.message)!=null&&s.content)&&(this._emit("content",p.delta.content,x.message.content),this._emit("content.delta",{delta:p.delta.content,snapshot:x.message.content,parsed:x.message.parsed})),p.delta.refusal!=null&&((o=x.message)==null?void 0:o.role)==="assistant"&&((a=x.message)!=null&&a.refusal)&&this._emit("refusal.delta",{delta:p.delta.refusal,snapshot:x.message.refusal}),((l=p.logprobs)==null?void 0:l.content)!=null&&((c=x.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(d=p.logprobs)==null?void 0:d.content,snapshot:((f=x.logprobs)==null?void 0:f.content)??[]}),((m=p.logprobs)==null?void 0:m.refusal)!=null&&((g=x.message)==null?void 0:g.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(v=p.logprobs)==null?void 0:v.refusal,snapshot:((w=x.logprobs)==null?void 0:w.refusal)??[]});const S=A(this,kt,"m",ro).call(this,x);x.finish_reason&&(A(this,kt,"m",dl).call(this,x),S.current_tool_call_index!=null&&A(this,kt,"m",ul).call(this,x,S.current_tool_call_index));for(const b of p.delta.tool_calls??[])S.current_tool_call_index!==b.index&&(A(this,kt,"m",dl).call(this,x),S.current_tool_call_index!=null&&A(this,kt,"m",ul).call(this,x,S.current_tool_call_index)),S.current_tool_call_index=b.index;for(const b of p.delta.tool_calls??[]){const T=(j=x.message.tool_calls)==null?void 0:j[b.index];T!=null&&T.type&&((T==null?void 0:T.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(h=T.function)==null?void 0:h.name,index:b.index,arguments:T.function.arguments,parsed_arguments:T.function.parsed_arguments,arguments_delta:((u=b.function)==null?void 0:u.arguments)??""}):(T==null||T.type,void 0))}}},ul=function(n,r){var o,a,l;if(A(this,kt,"m",ro).call(this,n).done_tool_calls.has(r))return;const s=(o=n.message.tool_calls)==null?void 0:o[r];if(!s)throw new Error("no tool call snapshot");if(!s.type)throw new Error("tool call snapshot missing `type`");if(s.type==="function"){const c=(l=(a=A(this,Fn,"f"))==null?void 0:a.tools)==null?void 0:l.find(d=>d.type==="function"&&d.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:r,arguments:s.function.arguments,parsed_arguments:Rs(c)?c.$parseRaw(s.function.arguments):c!=null&&c.function.strict?JSON.parse(s.function.arguments):null})}else s.type},dl=function(n){var i,s;const r=A(this,kt,"m",ro).call(this,n);if(n.message.content&&!r.content_done){r.content_done=!0;const o=A(this,kt,"m",fl).call(this);this._emit("content.done",{content:n.message.content,parsed:o?o.$parseRaw(n.message.content):null})}n.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(i=n.logprobs)!=null&&i.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(s=n.logprobs)!=null&&s.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},io=function(){if(this.ended)throw new Ie("stream has ended, this shouldn't happen");const n=A(this,Zn,"f");if(!n)throw new Ie("request ended without sending any chunks");return Ae(this,Zn,void 0,"f"),Ae(this,Kr,[],"f"),Pw(n,A(this,Fn,"f"))},fl=function(){var r;const n=(r=A(this,Fn,"f"))==null?void 0:r.response_format;return gu(n)?n:null},pf=function(n){var r,i,s,o;let a=A(this,Zn,"f");const{choices:l,...c}=n;a?Object.assign(a,c):a=Ae(this,Zn,{...c,choices:[]},"f");for(const{delta:d,finish_reason:f,index:m,logprobs:g=null,...v}of n.choices){let w=a.choices[m];if(w||(w=a.choices[m]={finish_reason:f,index:m,message:{},logprobs:g,...v}),g)if(!w.logprobs)w.logprobs=Object.assign({},g);else{const{content:b,refusal:T,...z}=g;Object.assign(w.logprobs,z),b&&((r=w.logprobs).content??(r.content=[]),w.logprobs.content.push(...b)),T&&((i=w.logprobs).refusal??(i.refusal=[]),w.logprobs.refusal.push(...T))}if(f&&(w.finish_reason=f,A(this,Fn,"f")&&_m(A(this,Fn,"f")))){if(f==="length")throw new rm;if(f==="content_filter")throw new im}if(Object.assign(w,v),!d)continue;const{content:j,refusal:h,function_call:u,role:p,tool_calls:x,...S}=d;if(Object.assign(w.message,S),h&&(w.message.refusal=(w.message.refusal||"")+h),p&&(w.message.role=p),u&&(w.message.function_call?(u.name&&(w.message.function_call.name=u.name),u.arguments&&((s=w.message.function_call).arguments??(s.arguments=""),w.message.function_call.arguments+=u.arguments)):w.message.function_call=u),j&&(w.message.content=(w.message.content||"")+j,!w.message.refusal&&A(this,kt,"m",fl).call(this)&&(w.message.parsed=ff(w.message.content))),x){w.message.tool_calls||(w.message.tool_calls=[]);for(const{index:b,id:T,type:z,function:O,...J}of x){const ee=(o=w.message.tool_calls)[b]??(o[b]={});Object.assign(ee,J),T&&(ee.id=T),z&&(ee.type=z),O&&(ee.function??(ee.function={name:O.name??"",arguments:""})),O!=null&&O.name&&(ee.function.name=O.name),O!=null&&O.arguments&&(ee.function.arguments+=O.arguments,xw(A(this,Fn,"f"),ee)&&(ee.function.parsed_arguments=ff(ee.function.arguments)))}}}return a},Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("chunk",i=>{const s=n.shift();s?s.resolve(i):t.push(i)}),this.on("end",()=>{r=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{r=!0;for(const s of n)s.reject(i);n.length=0}),this.on("error",i=>{r=!0;for(const s of n)s.reject(i);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,o)=>n.push({resolve:s,reject:o})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Dn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Pw(e,t){const{id:n,choices:r,created:i,model:s,system_fingerprint:o,...a}=e,l={...a,id:n,choices:r.map(({message:c,finish_reason:d,index:f,logprobs:m,...g})=>{if(!d)throw new Ie(`missing finish_reason for choice ${f}`);const{content:v=null,function_call:w,tool_calls:j,...h}=c,u=c.role;if(!u)throw new Ie(`missing role for choice ${f}`);if(w){const{arguments:p,name:x}=w;if(p==null)throw new Ie(`missing function_call.arguments for choice ${f}`);if(!x)throw new Ie(`missing function_call.name for choice ${f}`);return{...g,message:{content:v,function_call:{arguments:p,name:x},role:u,refusal:c.refusal??null},finish_reason:d,index:f,logprobs:m}}return j?{...g,index:f,finish_reason:d,logprobs:m,message:{...h,role:u,content:v,refusal:c.refusal??null,tool_calls:j.map((p,x)=>{const{function:S,type:b,id:T,...z}=p,{arguments:O,name:J,...ee}=S||{};if(T==null)throw new Ie(`missing choices[${f}].tool_calls[${x}].id
${so(e)}`);if(b==null)throw new Ie(`missing choices[${f}].tool_calls[${x}].type
${so(e)}`);if(J==null)throw new Ie(`missing choices[${f}].tool_calls[${x}].function.name
${so(e)}`);if(O==null)throw new Ie(`missing choices[${f}].tool_calls[${x}].function.arguments
${so(e)}`);return{...z,id:T,type:b,function:{...ee,name:J,arguments:O}}})}}:{...g,message:{...h,content:v,role:u,refusal:c.refusal??null},finish_reason:d,index:f,logprobs:m}}),created:i,model:s,object:"chat.completion",...o?{system_fingerprint:o}:{}};return yw(l,t)}function so(e){return JSON.stringify(e)}class oa extends Es{static fromReadableStream(t){const n=new oa(null);return n._run(()=>n._fromReadableStream(t)),n}static runTools(t,n,r){const i=new oa(n),s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(t,n,s)),i}}let wu=class extends Re{constructor(){super(...arguments),this.messages=new xm(this._client)}create(t,n){return this._client.post("/chat/completions",{body:t,...n,stream:t.stream??!1})}retrieve(t,n){return this._client.get(se`/chat/completions/${t}`,n)}update(t,n,r){return this._client.post(se`/chat/completions/${t}`,{body:n,...r})}list(t={},n){return this._client.getAPIList("/chat/completions",yt,{query:t,...n})}delete(t,n){return this._client.delete(se`/chat/completions/${t}`,n)}parse(t,n){return Sw(t.tools),this._client.chat.completions.create(t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(r=>yu(r,t))}runTools(t,n){return t.stream?oa.runTools(this._client,t,n):vu.runTools(this._client,t,n)}stream(t,n){return Es.createChatCompletion(this._client,t,n)}};wu.Messages=xm;class xu extends Re{constructor(){super(...arguments),this.completions=new wu(this._client)}}xu.Completions=wu;const zm=Symbol("brand.privateNullableHeaders");function*Iw(e){if(!e)return;if(zm in e){const{values:r,nulls:i}=e;yield*r.entries();for(const s of i)yield[s,null];return}let t=!1,n;e instanceof Headers?n=e.entries():qd(e)?n=e:(t=!0,n=Object.entries(e??{}));for(let r of n){const i=r[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const s=qd(r[1])?r[1]:[r[1]];let o=!1;for(const a of s)a!==void 0&&(t&&!o&&(o=!0,yield[i,null]),yield[i,a])}}const Ce=e=>{const t=new Headers,n=new Set;for(const r of e){const i=new Set;for(const[s,o]of Iw(r)){const a=s.toLowerCase();i.has(a)||(t.delete(s),i.add(a)),o===null?(t.delete(s),n.add(a)):(t.append(s,o),n.delete(a))}}return{[zm]:!0,values:t,nulls:n}};class Um extends Re{create(t,n){return this._client.post("/audio/speech",{body:t,...n,headers:Ce([{Accept:"application/octet-stream"},n==null?void 0:n.headers]),__binaryResponse:!0})}}class Hm extends Re{create(t,n){return this._client.post("/audio/transcriptions",Fr({body:t,...n,stream:t.stream??!1,__metadata:{model:t.model}},this._client))}}class Wm extends Re{create(t,n){return this._client.post("/audio/translations",Fr({body:t,...n,__metadata:{model:t.model}},this._client))}}let Ms=class extends Re{constructor(){super(...arguments),this.transcriptions=new Hm(this._client),this.translations=new Wm(this._client),this.speech=new Um(this._client)}};Ms.Transcriptions=Hm;Ms.Translations=Wm;Ms.Speech=Um;class Bm extends Re{create(t,n){return this._client.post("/batches",{body:t,...n})}retrieve(t,n){return this._client.get(se`/batches/${t}`,n)}list(t={},n){return this._client.getAPIList("/batches",yt,{query:t,...n})}cancel(t,n){return this._client.post(se`/batches/${t}/cancel`,n)}}class Km extends Re{create(t,n){return this._client.post("/assistants",{body:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(t,n){return this._client.get(se`/assistants/${t}`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(t,n,r){return this._client.post(se`/assistants/${t}`,{body:n,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(t={},n){return this._client.getAPIList("/assistants",yt,{query:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(t,n){return this._client.delete(se`/assistants/${t}`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class Xm extends Re{create(t,n){return this._client.post("/realtime/sessions",{body:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class Vm extends Re{create(t,n){return this._client.post("/realtime/transcription_sessions",{body:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}class Ia extends Re{constructor(){super(...arguments),this.sessions=new Xm(this._client),this.transcriptionSessions=new Vm(this._client)}}Ia.Sessions=Xm;Ia.TranscriptionSessions=Vm;class Ym extends Re{create(t,n,r){return this._client.post(se`/threads/${t}/messages`,{body:n,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(t,n,r){const{thread_id:i}=n;return this._client.get(se`/threads/${i}/messages/${t}`,{...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(t,n,r){const{thread_id:i,...s}=n;return this._client.post(se`/threads/${i}/messages/${t}`,{body:s,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(t,n={},r){return this._client.getAPIList(se`/threads/${t}/messages`,yt,{query:n,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(t,n,r){const{thread_id:i}=n;return this._client.delete(se`/threads/${i}/messages/${t}`,{...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}class Qm extends Re{retrieve(t,n,r){const{thread_id:i,run_id:s,...o}=n;return this._client.get(se`/threads/${i}/runs/${s}/steps/${t}`,{query:o,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(t,n,r){const{thread_id:i,...s}=n;return this._client.getAPIList(se`/threads/${i}/runs/${t}/steps`,yt,{query:s,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}const jw=e=>{if(typeof Buffer<"u"){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}else{const t=atob(e),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.charCodeAt(i);return Array.from(new Float32Array(r.buffer))}},Xr=e=>{var t,n,r,i,s;if(typeof globalThis.process<"u")return((n=(t=globalThis.process.env)==null?void 0:t[e])==null?void 0:n.trim())??void 0;if(typeof globalThis.Deno<"u")return(s=(i=(r=globalThis.Deno.env)==null?void 0:r.get)==null?void 0:i.call(r,e))==null?void 0:s.trim()};var Rt,jr,gc,$n,bo,En,Ar,ci,br,aa,an,To,Po,os,Yi,Qi,hf,mf,gf,yf,vf,wf,xf;class as extends mu{constructor(){super(...arguments),Rt.add(this),gc.set(this,[]),$n.set(this,{}),bo.set(this,{}),En.set(this,void 0),Ar.set(this,void 0),ci.set(this,void 0),br.set(this,void 0),aa.set(this,void 0),an.set(this,void 0),To.set(this,void 0),Po.set(this,void 0),os.set(this,void 0)}[(gc=new WeakMap,$n=new WeakMap,bo=new WeakMap,En=new WeakMap,Ar=new WeakMap,ci=new WeakMap,br=new WeakMap,aa=new WeakMap,an=new WeakMap,To=new WeakMap,Po=new WeakMap,os=new WeakMap,Rt=new WeakSet,Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("event",i=>{const s=n.shift();s?s.resolve(i):t.push(i)}),this.on("end",()=>{r=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{r=!0;for(const s of n)s.reject(i);n.length=0}),this.on("error",i=>{r=!0;for(const s of n)s.reject(i);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,o)=>n.push({resolve:s,reject:o})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(t){const n=new jr;return n._run(()=>n._fromReadableStream(t)),n}async _fromReadableStream(t,n){var s;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=Dn.fromReadableStream(t,this.controller);for await(const o of i)A(this,Rt,"m",Yi).call(this,o);if((s=i.controller.signal)!=null&&s.aborted)throw new yn;return this._addRun(A(this,Rt,"m",Qi).call(this))}toReadableStream(){return new Dn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(t,n,r,i){const s=new jr;return s._run(()=>s._runToolAssistantStream(t,n,r,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createToolAssistantStream(t,n,r,i){var l;const s=i==null?void 0:i.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const o={...r,stream:!0},a=await t.submitToolOutputs(n,o,{...i,signal:this.controller.signal});this._connected();for await(const c of a)A(this,Rt,"m",Yi).call(this,c);if((l=a.controller.signal)!=null&&l.aborted)throw new yn;return this._addRun(A(this,Rt,"m",Qi).call(this))}static createThreadAssistantStream(t,n,r){const i=new jr;return i._run(()=>i._threadAssistantStream(t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(t,n,r,i){const s=new jr;return s._run(()=>s._runAssistantStream(t,n,r,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return A(this,To,"f")}currentRun(){return A(this,Po,"f")}currentMessageSnapshot(){return A(this,En,"f")}currentRunStepSnapshot(){return A(this,os,"f")}async finalRunSteps(){return await this.done(),Object.values(A(this,$n,"f"))}async finalMessages(){return await this.done(),Object.values(A(this,bo,"f"))}async finalRun(){if(await this.done(),!A(this,Ar,"f"))throw Error("Final run was not received.");return A(this,Ar,"f")}async _createThreadAssistantStream(t,n,r){var a;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const s={...n,stream:!0},o=await t.createAndRun(s,{...r,signal:this.controller.signal});this._connected();for await(const l of o)A(this,Rt,"m",Yi).call(this,l);if((a=o.controller.signal)!=null&&a.aborted)throw new yn;return this._addRun(A(this,Rt,"m",Qi).call(this))}async _createAssistantStream(t,n,r,i){var l;const s=i==null?void 0:i.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const o={...r,stream:!0},a=await t.create(n,o,{...i,signal:this.controller.signal});this._connected();for await(const c of a)A(this,Rt,"m",Yi).call(this,c);if((l=a.controller.signal)!=null&&l.aborted)throw new yn;return this._addRun(A(this,Rt,"m",Qi).call(this))}static accumulateDelta(t,n){for(const[r,i]of Object.entries(n)){if(!t.hasOwnProperty(r)){t[r]=i;continue}let s=t[r];if(s==null){t[r]=i;continue}if(r==="index"||r==="type"){t[r]=i;continue}if(typeof s=="string"&&typeof i=="string")s+=i;else if(typeof s=="number"&&typeof i=="number")s+=i;else if(sl(s)&&sl(i))s=this.accumulateDelta(s,i);else if(Array.isArray(s)&&Array.isArray(i)){if(s.every(o=>typeof o=="string"||typeof o=="number")){s.push(...i);continue}for(const o of i){if(!sl(o))throw new Error(`Expected array delta entry to be an object but got: ${o}`);const a=o.index;if(a==null)throw console.error(o),new Error("Expected array delta entry to have an `index` property");if(typeof a!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${a}`);const l=s[a];l==null?s.push(o):s[a]=this.accumulateDelta(l,o)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${i}, accValue: ${s}`);t[r]=s}return t}_addRun(t){return t}async _threadAssistantStream(t,n,r){return await this._createThreadAssistantStream(n,t,r)}async _runAssistantStream(t,n,r,i){return await this._createAssistantStream(n,t,r,i)}async _runToolAssistantStream(t,n,r,i){return await this._createToolAssistantStream(n,t,r,i)}}jr=as,Yi=function(t){if(!this.ended)switch(Ae(this,To,t,"f"),A(this,Rt,"m",gf).call(this,t),t.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":A(this,Rt,"m",xf).call(this,t);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":A(this,Rt,"m",mf).call(this,t);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":A(this,Rt,"m",hf).call(this,t);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Qi=function(){if(this.ended)throw new Ie("stream has ended, this shouldn't happen");if(!A(this,Ar,"f"))throw Error("Final run has not been received");return A(this,Ar,"f")},hf=function(t){const[n,r]=A(this,Rt,"m",vf).call(this,t,A(this,En,"f"));Ae(this,En,n,"f"),A(this,bo,"f")[n.id]=n;for(const i of r){const s=n.content[i.index];(s==null?void 0:s.type)=="text"&&this._emit("textCreated",s.text)}switch(t.event){case"thread.message.created":this._emit("messageCreated",t.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",t.data.delta,n),t.data.delta.content)for(const i of t.data.delta.content){if(i.type=="text"&&i.text){let s=i.text,o=n.content[i.index];if(o&&o.type=="text")this._emit("textDelta",s,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=A(this,ci,"f")){if(A(this,br,"f"))switch(A(this,br,"f").type){case"text":this._emit("textDone",A(this,br,"f").text,A(this,En,"f"));break;case"image_file":this._emit("imageFileDone",A(this,br,"f").image_file,A(this,En,"f"));break}Ae(this,ci,i.index,"f")}Ae(this,br,n.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(A(this,ci,"f")!==void 0){const i=t.data.content[A(this,ci,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,A(this,En,"f"));break;case"text":this._emit("textDone",i.text,A(this,En,"f"));break}}A(this,En,"f")&&this._emit("messageDone",t.data),Ae(this,En,void 0,"f")}},mf=function(t){const n=A(this,Rt,"m",yf).call(this,t);switch(Ae(this,os,n,"f"),t.event){case"thread.run.step.created":this._emit("runStepCreated",t.data);break;case"thread.run.step.delta":const r=t.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const s of r.step_details.tool_calls)s.index==A(this,aa,"f")?this._emit("toolCallDelta",s,n.step_details.tool_calls[s.index]):(A(this,an,"f")&&this._emit("toolCallDone",A(this,an,"f")),Ae(this,aa,s.index,"f"),Ae(this,an,n.step_details.tool_calls[s.index],"f"),A(this,an,"f")&&this._emit("toolCallCreated",A(this,an,"f")));this._emit("runStepDelta",t.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ae(this,os,void 0,"f"),t.data.step_details.type=="tool_calls"&&A(this,an,"f")&&(this._emit("toolCallDone",A(this,an,"f")),Ae(this,an,void 0,"f")),this._emit("runStepDone",t.data,n);break}},gf=function(t){A(this,gc,"f").push(t),this._emit("event",t)},yf=function(t){switch(t.event){case"thread.run.step.created":return A(this,$n,"f")[t.data.id]=t.data,t.data;case"thread.run.step.delta":let n=A(this,$n,"f")[t.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let r=t.data;if(r.delta){const i=jr.accumulateDelta(n,r.delta);A(this,$n,"f")[t.data.id]=i}return A(this,$n,"f")[t.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":A(this,$n,"f")[t.data.id]=t.data;break}if(A(this,$n,"f")[t.data.id])return A(this,$n,"f")[t.data.id];throw new Error("No snapshot available")},vf=function(t,n){let r=[];switch(t.event){case"thread.message.created":return[t.data,r];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=t.data;if(i.delta.content)for(const s of i.delta.content)if(s.index in n.content){let o=n.content[s.index];n.content[s.index]=A(this,Rt,"m",wf).call(this,s,o)}else n.content[s.index]=s,r.push(s);return[n,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},wf=function(t,n){return jr.accumulateDelta(n,t)},xf=function(t){switch(Ae(this,Po,t.data,"f"),t.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":Ae(this,Ar,t.data,"f"),A(this,an,"f")&&(this._emit("toolCallDone",A(this,an,"f")),Ae(this,an,void 0,"f"));break}};let Su=class extends Re{constructor(){super(...arguments),this.steps=new Qm(this._client)}create(t,n,r){const{include:i,...s}=n;return this._client.post(se`/threads/${t}/runs`,{query:{include:i},body:s,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:n.stream??!1})}retrieve(t,n,r){const{thread_id:i}=n;return this._client.get(se`/threads/${i}/runs/${t}`,{...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(t,n,r){const{thread_id:i,...s}=n;return this._client.post(se`/threads/${i}/runs/${t}`,{body:s,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(t,n={},r){return this._client.getAPIList(se`/threads/${t}/runs`,yt,{query:n,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}cancel(t,n,r){const{thread_id:i}=n;return this._client.post(se`/threads/${i}/runs/${t}/cancel`,{...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(t,n,r){const i=await this.create(t,n,r);return await this.poll(i.id,{thread_id:t},r)}createAndStream(t,n,r){return as.createAssistantStream(t,this._client.beta.threads.runs,n,r)}async poll(t,n,r){var s;const i=Ce([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((s=r==null?void 0:r.pollIntervalMs)==null?void 0:s.toString())??void 0}]);for(;;){const{data:o,response:a}=await this.retrieve(t,n,{...r,headers:{...r==null?void 0:r.headers,...i}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let l=5e3;if(r!=null&&r.pollIntervalMs)l=r.pollIntervalMs;else{const c=a.headers.get("openai-poll-after-ms");if(c){const d=parseInt(c);isNaN(d)||(l=d)}}await As(l);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(t,n,r){return as.createAssistantStream(t,this._client.beta.threads.runs,n,r)}submitToolOutputs(t,n,r){const{thread_id:i,...s}=n;return this._client.post(se`/threads/${i}/runs/${t}/submit_tool_outputs`,{body:s,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:n.stream??!1})}async submitToolOutputsAndPoll(t,n,r){const i=await this.submitToolOutputs(t,n,r);return await this.poll(i.id,n,r)}submitToolOutputsStream(t,n,r){return as.createToolAssistantStream(t,this._client.beta.threads.runs,n,r)}};Su.Steps=Qm;class ja extends Re{constructor(){super(...arguments),this.runs=new Su(this._client),this.messages=new Ym(this._client)}create(t={},n){return this._client.post("/threads",{body:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(t,n){return this._client.get(se`/threads/${t}`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(t,n,r){return this._client.post(se`/threads/${t}`,{body:n,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(t,n){return this._client.delete(se`/threads/${t}`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}createAndRun(t,n){return this._client.post("/threads/runs",{body:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:t.stream??!1})}async createAndRunPoll(t,n){const r=await this.createAndRun(t,n);return await this.runs.poll(r.id,{thread_id:r.thread_id},n)}createAndRunStream(t,n){return as.createThreadAssistantStream(t,this._client.beta.threads,n)}}ja.Runs=Su;ja.Messages=Ym;class $s extends Re{constructor(){super(...arguments),this.realtime=new Ia(this._client),this.assistants=new Km(this._client),this.threads=new ja(this._client)}}$s.Realtime=Ia;$s.Assistants=Km;$s.Threads=ja;class Jm extends Re{create(t,n){return this._client.post("/completions",{body:t,...n,stream:t.stream??!1})}}class Gm extends Re{retrieve(t,n,r){const{container_id:i}=n;return this._client.get(se`/containers/${i}/files/${t}/content`,{...r,headers:Ce([{Accept:"application/binary"},r==null?void 0:r.headers]),__binaryResponse:!0})}}let ku=class extends Re{constructor(){super(...arguments),this.content=new Gm(this._client)}create(t,n,r){return this._client.post(se`/containers/${t}/files`,Fr({body:n,...r},this._client))}retrieve(t,n,r){const{container_id:i}=n;return this._client.get(se`/containers/${i}/files/${t}`,r)}list(t,n={},r){return this._client.getAPIList(se`/containers/${t}/files`,yt,{query:n,...r})}delete(t,n,r){const{container_id:i}=n;return this._client.delete(se`/containers/${i}/files/${t}`,{...r,headers:Ce([{Accept:"*/*"},r==null?void 0:r.headers])})}};ku.Content=Gm;class _u extends Re{constructor(){super(...arguments),this.files=new ku(this._client)}create(t,n){return this._client.post("/containers",{body:t,...n})}retrieve(t,n){return this._client.get(se`/containers/${t}`,n)}list(t={},n){return this._client.getAPIList("/containers",yt,{query:t,...n})}delete(t,n){return this._client.delete(se`/containers/${t}`,{...n,headers:Ce([{Accept:"*/*"},n==null?void 0:n.headers])})}}_u.Files=ku;class qm extends Re{create(t,n){const r=!!t.encoding_format;let i=r?t.encoding_format:"base64";r&&Lt(this._client).debug("embeddings/user defined encoding_format:",t.encoding_format);const s=this._client.post("/embeddings",{body:{...t,encoding_format:i},...n});return r?s:(Lt(this._client).debug("embeddings/decoding base64 embeddings from base64"),s._thenUnwrap(o=>(o&&o.data&&o.data.forEach(a=>{const l=a.embedding;a.embedding=jw(l)}),o)))}}class Zm extends Re{retrieve(t,n,r){const{eval_id:i,run_id:s}=n;return this._client.get(se`/evals/${i}/runs/${s}/output_items/${t}`,r)}list(t,n,r){const{eval_id:i,...s}=n;return this._client.getAPIList(se`/evals/${i}/runs/${t}/output_items`,yt,{query:s,...r})}}class Cu extends Re{constructor(){super(...arguments),this.outputItems=new Zm(this._client)}create(t,n,r){return this._client.post(se`/evals/${t}/runs`,{body:n,...r})}retrieve(t,n,r){const{eval_id:i}=n;return this._client.get(se`/evals/${i}/runs/${t}`,r)}list(t,n={},r){return this._client.getAPIList(se`/evals/${t}/runs`,yt,{query:n,...r})}delete(t,n,r){const{eval_id:i}=n;return this._client.delete(se`/evals/${i}/runs/${t}`,r)}cancel(t,n,r){const{eval_id:i}=n;return this._client.post(se`/evals/${i}/runs/${t}`,r)}}Cu.OutputItems=Zm;class Eu extends Re{constructor(){super(...arguments),this.runs=new Cu(this._client)}create(t,n){return this._client.post("/evals",{body:t,...n})}retrieve(t,n){return this._client.get(se`/evals/${t}`,n)}update(t,n,r){return this._client.post(se`/evals/${t}`,{body:n,...r})}list(t={},n){return this._client.getAPIList("/evals",yt,{query:t,...n})}delete(t,n){return this._client.delete(se`/evals/${t}`,n)}}Eu.Runs=Cu;let eg=class extends Re{create(t,n){return this._client.post("/files",Fr({body:t,...n},this._client))}retrieve(t,n){return this._client.get(se`/files/${t}`,n)}list(t={},n){return this._client.getAPIList("/files",yt,{query:t,...n})}delete(t,n){return this._client.delete(se`/files/${t}`,n)}content(t,n){return this._client.get(se`/files/${t}/content`,{...n,headers:Ce([{Accept:"application/binary"},n==null?void 0:n.headers]),__binaryResponse:!0})}async waitForProcessing(t,{pollInterval:n=5e3,maxWait:r=30*60*1e3}={}){const i=new Set(["processed","error","deleted"]),s=Date.now();let o=await this.retrieve(t);for(;!o.status||!i.has(o.status);)if(await As(n),o=await this.retrieve(t),Date.now()-s>r)throw new pu({message:`Giving up on waiting for file ${t} to finish processing after ${r} milliseconds.`});return o}};class tg extends Re{}let ng=class extends Re{run(t,n){return this._client.post("/fine_tuning/alpha/graders/run",{body:t,...n})}validate(t,n){return this._client.post("/fine_tuning/alpha/graders/validate",{body:t,...n})}};class bu extends Re{constructor(){super(...arguments),this.graders=new ng(this._client)}}bu.Graders=ng;class rg extends Re{create(t,n,r){return this._client.getAPIList(se`/fine_tuning/checkpoints/${t}/permissions`,Pa,{body:n,method:"post",...r})}retrieve(t,n={},r){return this._client.get(se`/fine_tuning/checkpoints/${t}/permissions`,{query:n,...r})}delete(t,n,r){const{fine_tuned_model_checkpoint:i}=n;return this._client.delete(se`/fine_tuning/checkpoints/${i}/permissions/${t}`,r)}}let Tu=class extends Re{constructor(){super(...arguments),this.permissions=new rg(this._client)}};Tu.Permissions=rg;class ig extends Re{list(t,n={},r){return this._client.getAPIList(se`/fine_tuning/jobs/${t}/checkpoints`,yt,{query:n,...r})}}class Pu extends Re{constructor(){super(...arguments),this.checkpoints=new ig(this._client)}create(t,n){return this._client.post("/fine_tuning/jobs",{body:t,...n})}retrieve(t,n){return this._client.get(se`/fine_tuning/jobs/${t}`,n)}list(t={},n){return this._client.getAPIList("/fine_tuning/jobs",yt,{query:t,...n})}cancel(t,n){return this._client.post(se`/fine_tuning/jobs/${t}/cancel`,n)}listEvents(t,n={},r){return this._client.getAPIList(se`/fine_tuning/jobs/${t}/events`,yt,{query:n,...r})}pause(t,n){return this._client.post(se`/fine_tuning/jobs/${t}/pause`,n)}resume(t,n){return this._client.post(se`/fine_tuning/jobs/${t}/resume`,n)}}Pu.Checkpoints=ig;class Pi extends Re{constructor(){super(...arguments),this.methods=new tg(this._client),this.jobs=new Pu(this._client),this.checkpoints=new Tu(this._client),this.alpha=new bu(this._client)}}Pi.Methods=tg;Pi.Jobs=Pu;Pi.Checkpoints=Tu;Pi.Alpha=bu;class sg extends Re{}class Iu extends Re{constructor(){super(...arguments),this.graderModels=new sg(this._client)}}Iu.GraderModels=sg;class og extends Re{createVariation(t,n){return this._client.post("/images/variations",Fr({body:t,...n},this._client))}edit(t,n){return this._client.post("/images/edits",Fr({body:t,...n},this._client))}generate(t,n){return this._client.post("/images/generations",{body:t,...n})}}class ag extends Re{retrieve(t,n){return this._client.get(se`/models/${t}`,n)}list(t){return this._client.getAPIList("/models",Pa,t)}delete(t,n){return this._client.delete(se`/models/${t}`,n)}}class lg extends Re{create(t,n){return this._client.post("/moderations",{body:t,...n})}}function Aw(e,t){return!t||!Mw(t)?{...e,output_parsed:null,output:e.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(r=>({...r,parsed:null}))}:n)}:cg(e,t)}function cg(e,t){const n=e.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:Dw(t,i)};if(i.type==="message"){const s=i.content.map(o=>o.type==="output_text"?{...o,parsed:Rw(t,o.text)}:o);return{...i,content:s}}return i}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||yc(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const i of r.output)if(i.type==="message"){for(const s of i.content)if(s.type==="output_text"&&s.parsed!==null)return s.parsed}return null}}),r}function Rw(e,t){var n,r,i,s;return((r=(n=e.text)==null?void 0:n.format)==null?void 0:r.type)!=="json_schema"?null:"$parseRaw"in((i=e.text)==null?void 0:i.format)?((s=e.text)==null?void 0:s.format).$parseRaw(t):JSON.parse(t)}function Mw(e){var t;return!!gu((t=e.text)==null?void 0:t.format)}function $w(e){return(e==null?void 0:e.$brand)==="auto-parseable-tool"}function Nw(e,t){return e.find(n=>n.type==="function"&&n.name===t)}function Dw(e,t){const n=Nw(e.tools??[],t.name);return{...t,...t,parsed_arguments:$w(n)?n.$parseRaw(t.arguments):n!=null&&n.strict?JSON.parse(t.arguments):null}}function yc(e){const t=[];for(const n of e.output)if(n.type==="message")for(const r of n.content)r.type==="output_text"&&t.push(r.text);e.output_text=t.join("")}var Vr,oo,er,ao,Sf,kf,_f,Cf;class ju extends mu{constructor(t){super(),Vr.add(this),oo.set(this,void 0),er.set(this,void 0),ao.set(this,void 0),Ae(this,oo,t,"f")}static createResponse(t,n,r){const i=new ju(n);return i._run(()=>i._createOrRetrieveResponse(t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(t,n,r){var a;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),A(this,Vr,"m",Sf).call(this);let s,o=null;"response_id"in n?(s=await t.responses.retrieve(n.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),o=n.starting_after??null):s=await t.responses.create({...n,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(const l of s)A(this,Vr,"m",kf).call(this,l,o);if((a=s.controller.signal)!=null&&a.aborted)throw new yn;return A(this,Vr,"m",_f).call(this)}[(oo=new WeakMap,er=new WeakMap,ao=new WeakMap,Vr=new WeakSet,Sf=function(){this.ended||Ae(this,er,void 0,"f")},kf=function(n,r){if(this.ended)return;const i=(o,a)=>{(r==null||a.sequence_number>r)&&this._emit(o,a)},s=A(this,Vr,"m",Cf).call(this,n);switch(i("event",n),n.type){case"response.output_text.delta":{const o=s.output[n.output_index];if(!o)throw new Ie(`missing output at index ${n.output_index}`);if(o.type==="message"){const a=o.content[n.content_index];if(!a)throw new Ie(`missing content at index ${n.content_index}`);if(a.type!=="output_text")throw new Ie(`expected content to be 'output_text', got ${a.type}`);i("response.output_text.delta",{...n,snapshot:a.text})}break}case"response.function_call_arguments.delta":{const o=s.output[n.output_index];if(!o)throw new Ie(`missing output at index ${n.output_index}`);o.type==="function_call"&&i("response.function_call_arguments.delta",{...n,snapshot:o.arguments});break}default:i(n.type,n);break}},_f=function(){if(this.ended)throw new Ie("stream has ended, this shouldn't happen");const n=A(this,er,"f");if(!n)throw new Ie("request ended without sending any events");Ae(this,er,void 0,"f");const r=Ow(n,A(this,oo,"f"));return Ae(this,ao,r,"f"),r},Cf=function(n){let r=A(this,er,"f");if(!r){if(n.type!=="response.created")throw new Ie(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return r=Ae(this,er,n.response,"f"),r}switch(n.type){case"response.output_item.added":{r.output.push(n.item);break}case"response.content_part.added":{const i=r.output[n.output_index];if(!i)throw new Ie(`missing output at index ${n.output_index}`);i.type==="message"&&i.content.push(n.part);break}case"response.output_text.delta":{const i=r.output[n.output_index];if(!i)throw new Ie(`missing output at index ${n.output_index}`);if(i.type==="message"){const s=i.content[n.content_index];if(!s)throw new Ie(`missing content at index ${n.content_index}`);if(s.type!=="output_text")throw new Ie(`expected content to be 'output_text', got ${s.type}`);s.text+=n.delta}break}case"response.function_call_arguments.delta":{const i=r.output[n.output_index];if(!i)throw new Ie(`missing output at index ${n.output_index}`);i.type==="function_call"&&(i.arguments+=n.delta);break}case"response.completed":{Ae(this,er,n.response,"f");break}}return r},Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("event",i=>{const s=n.shift();s?s.resolve(i):t.push(i)}),this.on("end",()=>{r=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{r=!0;for(const s of n)s.reject(i);n.length=0}),this.on("error",i=>{r=!0;for(const s of n)s.reject(i);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,o)=>n.push({resolve:s,reject:o})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const t=A(this,ao,"f");if(!t)throw new Ie("stream ended without producing a ChatCompletion");return t}}function Ow(e,t){return Aw(e,t)}class ug extends Re{list(t,n={},r){return this._client.getAPIList(se`/responses/${t}/input_items`,yt,{query:n,...r})}}class Au extends Re{constructor(){super(...arguments),this.inputItems=new ug(this._client)}create(t,n){return this._client.post("/responses",{body:t,...n,stream:t.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&yc(r),r))}retrieve(t,n={},r){return this._client.get(se`/responses/${t}`,{query:n,...r,stream:(n==null?void 0:n.stream)??!1})._thenUnwrap(i=>("object"in i&&i.object==="response"&&yc(i),i))}delete(t,n){return this._client.delete(se`/responses/${t}`,{...n,headers:Ce([{Accept:"*/*"},n==null?void 0:n.headers])})}parse(t,n){return this._client.responses.create(t,n)._thenUnwrap(r=>cg(r,t))}stream(t,n){return ju.createResponse(this._client,t,n)}cancel(t,n){return this._client.post(se`/responses/${t}/cancel`,n)}}Au.InputItems=ug;class dg extends Re{create(t,n,r){return this._client.post(se`/uploads/${t}/parts`,Fr({body:n,...r},this._client))}}class Ru extends Re{constructor(){super(...arguments),this.parts=new dg(this._client)}create(t,n){return this._client.post("/uploads",{body:t,...n})}cancel(t,n){return this._client.post(se`/uploads/${t}/cancel`,n)}complete(t,n,r){return this._client.post(se`/uploads/${t}/complete`,{body:n,...r})}}Ru.Parts=dg;const Lw=async e=>{const t=await Promise.allSettled(e),n=t.filter(i=>i.status==="rejected");if(n.length){for(const i of n)console.error(i.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const i of t)i.status==="fulfilled"&&r.push(i.value);return r};class fg extends Re{create(t,n,r){return this._client.post(se`/vector_stores/${t}/file_batches`,{body:n,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(t,n,r){const{vector_store_id:i}=n;return this._client.get(se`/vector_stores/${i}/file_batches/${t}`,{...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}cancel(t,n,r){const{vector_store_id:i}=n;return this._client.post(se`/vector_stores/${i}/file_batches/${t}/cancel`,{...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(t,n,r){const i=await this.create(t,n);return await this.poll(t,i.id,r)}listFiles(t,n,r){const{vector_store_id:i,...s}=n;return this._client.getAPIList(se`/vector_stores/${i}/file_batches/${t}/files`,yt,{query:s,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async poll(t,n,r){var s;const i=Ce([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((s=r==null?void 0:r.pollIntervalMs)==null?void 0:s.toString())??void 0}]);for(;;){const{data:o,response:a}=await this.retrieve(n,{vector_store_id:t},{...r,headers:i}).withResponse();switch(o.status){case"in_progress":let l=5e3;if(r!=null&&r.pollIntervalMs)l=r.pollIntervalMs;else{const c=a.headers.get("openai-poll-after-ms");if(c){const d=parseInt(c);isNaN(d)||(l=d)}}await As(l);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(t,{files:n,fileIds:r=[]},i){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const s=(i==null?void 0:i.maxConcurrency)??5,o=Math.min(s,n.length),a=this._client,l=n.values(),c=[...r];async function d(m){for(let g of m){const v=await a.files.create({file:g,purpose:"assistants"},i);c.push(v.id)}}const f=Array(o).fill(l).map(d);return await Lw(f),await this.createAndPoll(t,{file_ids:c})}}class pg extends Re{create(t,n,r){return this._client.post(se`/vector_stores/${t}/files`,{body:n,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(t,n,r){const{vector_store_id:i}=n;return this._client.get(se`/vector_stores/${i}/files/${t}`,{...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(t,n,r){const{vector_store_id:i,...s}=n;return this._client.post(se`/vector_stores/${i}/files/${t}`,{body:s,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(t,n={},r){return this._client.getAPIList(se`/vector_stores/${t}/files`,yt,{query:n,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(t,n,r){const{vector_store_id:i}=n;return this._client.delete(se`/vector_stores/${i}/files/${t}`,{...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(t,n,r){const i=await this.create(t,n,r);return await this.poll(t,i.id,r)}async poll(t,n,r){var s;const i=Ce([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((s=r==null?void 0:r.pollIntervalMs)==null?void 0:s.toString())??void 0}]);for(;;){const o=await this.retrieve(n,{vector_store_id:t},{...r,headers:i}).withResponse(),a=o.data;switch(a.status){case"in_progress":let l=5e3;if(r!=null&&r.pollIntervalMs)l=r.pollIntervalMs;else{const c=o.response.headers.get("openai-poll-after-ms");if(c){const d=parseInt(c);isNaN(d)||(l=d)}}await As(l);break;case"failed":case"completed":return a}}}async upload(t,n,r){const i=await this._client.files.create({file:n,purpose:"assistants"},r);return this.create(t,{file_id:i.id},r)}async uploadAndPoll(t,n,r){const i=await this.upload(t,n,r);return await this.poll(t,i.id,r)}content(t,n,r){const{vector_store_id:i}=n;return this._client.getAPIList(se`/vector_stores/${i}/files/${t}/content`,Pa,{...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}class Aa extends Re{constructor(){super(...arguments),this.files=new pg(this._client),this.fileBatches=new fg(this._client)}create(t,n){return this._client.post("/vector_stores",{body:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(t,n){return this._client.get(se`/vector_stores/${t}`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(t,n,r){return this._client.post(se`/vector_stores/${t}`,{body:n,...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(t={},n){return this._client.getAPIList("/vector_stores",yt,{query:t,...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(t,n){return this._client.delete(se`/vector_stores/${t}`,{...n,headers:Ce([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}search(t,n,r){return this._client.getAPIList(se`/vector_stores/${t}/search`,Pa,{body:n,method:"post",...r,headers:Ce([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}Aa.Files=pg;Aa.FileBatches=fg;var Jr,hg,Io;class mg extends Re{constructor(){super(...arguments),Jr.add(this)}async unwrap(t,n,r=this._client.webhookSecret,i=300){return await this.verifySignature(t,n,r,i),JSON.parse(t)}async verifySignature(t,n,r=this._client.webhookSecret,i=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");A(this,Jr,"m",hg).call(this,r);const s=Ce([n]).values,o=A(this,Jr,"m",Io).call(this,s,"webhook-signature"),a=A(this,Jr,"m",Io).call(this,s,"webhook-timestamp"),l=A(this,Jr,"m",Io).call(this,s,"webhook-id"),c=parseInt(a,10);if(isNaN(c))throw new Ui("Invalid webhook timestamp format");const d=Math.floor(Date.now()/1e3);if(d-c>i)throw new Ui("Webhook timestamp is too old");if(c>d+i)throw new Ui("Webhook timestamp is too new");const f=o.split(" ").map(w=>w.startsWith("v1,")?w.substring(3):w),m=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),g=l?`${l}.${a}.${t}`:`${a}.${t}`,v=await crypto.subtle.importKey("raw",m,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const w of f)try{const j=Buffer.from(w,"base64");if(await crypto.subtle.verify("HMAC",v,j,new TextEncoder().encode(g)))return}catch{continue}throw new Ui("The given webhook signature does not match the expected signature")}}Jr=new WeakSet,hg=function(t){if(typeof t!="string"||t.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Io=function(t,n){if(!t)throw new Error("Headers are required");const r=t.get(n);if(r==null)throw new Error(`Missing required header: ${n}`);return r};var vc,Mu,jo,gg;class He{constructor({baseURL:t=Xr("OPENAI_BASE_URL"),apiKey:n=Xr("OPENAI_API_KEY"),organization:r=Xr("OPENAI_ORG_ID")??null,project:i=Xr("OPENAI_PROJECT_ID")??null,webhookSecret:s=Xr("OPENAI_WEBHOOK_SECRET")??null,...o}={}){if(vc.add(this),jo.set(this,void 0),this.completions=new Jm(this),this.chat=new xu(this),this.embeddings=new qm(this),this.files=new eg(this),this.images=new og(this),this.audio=new Ms(this),this.moderations=new lg(this),this.models=new ag(this),this.fineTuning=new Pi(this),this.graders=new Iu(this),this.vectorStores=new Aa(this),this.webhooks=new mg(this),this.beta=new $s(this),this.batches=new Bm(this),this.uploads=new Ru(this),this.responses=new Au(this),this.evals=new Eu(this),this.containers=new _u(this),n===void 0)throw new Ie("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:n,organization:r,project:i,webhookSecret:s,...o,baseURL:t||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&Fv())throw new Ie(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=a.baseURL,this.timeout=a.timeout??Mu.DEFAULT_TIMEOUT,this.logger=a.logger??console;const l="warn";this.logLevel=l,this.logLevel=cf(a.logLevel,"ClientOptions.logLevel",this)??cf(Xr("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??l,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??Bv(),Ae(this,jo,Xv,"f"),this._options=a,this.apiKey=n,this.organization=r,this.project=i,this.webhookSecret=s}withOptions(t){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...t})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:n}){}authHeaders(t){return Ce([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(t){return qv(t,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Yr}`}defaultIdempotencyKey(){return`stainless-node-retry-${Yh()}`}makeStatusError(t,n,r,i){return Nt.generate(t,n,r,i)}buildURL(t,n,r){const i=!A(this,vc,"m",gg).call(this)&&r||this.baseURL,s=Mv(t)?new URL(t):new URL(i+(i.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),o=this.defaultQuery();return Nv(o)||(n={...o,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(s.search=this.stringifyQuery(n)),s.toString()}async prepareOptions(t){}async prepareRequest(t,{url:n,options:r}){}get(t,n){return this.methodRequest("get",t,n)}post(t,n){return this.methodRequest("post",t,n)}patch(t,n){return this.methodRequest("patch",t,n)}put(t,n){return this.methodRequest("put",t,n)}delete(t,n){return this.methodRequest("delete",t,n)}methodRequest(t,n,r){return this.request(Promise.resolve(r).then(i=>({method:t,path:n,...i})))}request(t,n=null){return new Ta(this,this.makeRequest(t,n,void 0))}async makeRequest(t,n,r){var h,u;const i=await t,s=i.maxRetries??this.maxRetries;n==null&&(n=s),await this.prepareOptions(i);const{req:o,url:a,timeout:l}=this.buildRequest(i,{retryCount:s-n});await this.prepareRequest(o,{url:a,options:i});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=r===void 0?"":`, retryOf: ${r}`,f=Date.now();if(Lt(this).debug(`[${c}] sending request`,Er({retryOfRequestLogID:r,method:i.method,url:a,options:i,headers:o.headers})),(h=i.signal)!=null&&h.aborted)throw new yn;const m=new AbortController,g=await this.fetchWithTimeout(a,o,l,m).catch(ac),v=Date.now();if(g instanceof Error){const p=`retrying, ${n} attempts remaining`;if((u=i.signal)!=null&&u.aborted)throw new yn;const x=oc(g)||/timed? ?out/i.test(String(g)+("cause"in g?String(g.cause):""));if(n)return Lt(this).info(`[${c}] connection ${x?"timed out":"failed"} - ${p}`),Lt(this).debug(`[${c}] connection ${x?"timed out":"failed"} (${p})`,Er({retryOfRequestLogID:r,url:a,durationMs:v-f,message:g.message})),this.retryRequest(i,n,r??c);throw Lt(this).info(`[${c}] connection ${x?"timed out":"failed"} - error; no more retries left`),Lt(this).debug(`[${c}] connection ${x?"timed out":"failed"} (error; no more retries left)`,Er({retryOfRequestLogID:r,url:a,durationMs:v-f,message:g.message})),x?new pu:new Ea({cause:g})}const w=[...g.headers.entries()].filter(([p])=>p==="x-request-id").map(([p,x])=>", "+p+": "+JSON.stringify(x)).join(""),j=`[${c}${d}${w}] ${o.method} ${a} ${g.ok?"succeeded":"failed"} with status ${g.status} in ${v-f}ms`;if(!g.ok){const p=this.shouldRetry(g);if(n&&p){const O=`retrying, ${n} attempts remaining`;return await Kv(g.body),Lt(this).info(`${j} - ${O}`),Lt(this).debug(`[${c}] response error (${O})`,Er({retryOfRequestLogID:r,url:g.url,status:g.status,headers:g.headers,durationMs:v-f})),this.retryRequest(i,n,r??c,g.headers)}const x=p?"error; no more retries left":"error; not retryable";Lt(this).info(`${j} - ${x}`);const S=await g.text().catch(O=>ac(O).message),b=Lv(S),T=b?void 0:S;throw Lt(this).debug(`[${c}] response error (${x})`,Er({retryOfRequestLogID:r,url:g.url,status:g.status,headers:g.headers,message:T,durationMs:Date.now()-f})),this.makeStatusError(g.status,b,T,g.headers)}return Lt(this).info(j),Lt(this).debug(`[${c}] response start`,Er({retryOfRequestLogID:r,url:g.url,status:g.status,headers:g.headers,durationMs:v-f})),{response:g,options:i,controller:m,requestLogID:c,retryOfRequestLogID:r,startTime:f}}getAPIList(t,n,r){return this.requestAPIList(n,{method:"get",path:t,...r})}requestAPIList(t,n){const r=this.makeRequest(n,null,void 0);return new aw(this,r,t)}async fetchWithTimeout(t,n,r,i){const{signal:s,method:o,...a}=n||{};s&&s.addEventListener("abort",()=>i.abort());const l=setTimeout(()=>i.abort(),r),c=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||typeof a.body=="object"&&a.body!==null&&Symbol.asyncIterator in a.body,d={signal:i.signal,...c?{duplex:"half"}:{},method:"GET",...a};o&&(d.method=o.toUpperCase());try{return await this.fetch.call(void 0,t,d)}finally{clearTimeout(l)}}shouldRetry(t){const n=t.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,n,r,i){let s;const o=i==null?void 0:i.get("retry-after-ms");if(o){const l=parseFloat(o);Number.isNaN(l)||(s=l)}const a=i==null?void 0:i.get("retry-after");if(a&&!s){const l=parseFloat(a);Number.isNaN(l)?s=Date.parse(a)-Date.now():s=l*1e3}if(!(s&&0<=s&&s<60*1e3)){const l=t.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(n,l)}return await As(s),this.makeRequest(t,n-1,r)}calculateDefaultRetryTimeoutMillis(t,n){const s=n-t,o=Math.min(.5*Math.pow(2,s),8),a=1-Math.random()*.25;return o*a*1e3}buildRequest(t,{retryCount:n=0}={}){const r={...t},{method:i,path:s,query:o,defaultBaseURL:a}=r,l=this.buildURL(s,o,a);"timeout"in r&&Ov("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const{bodyHeaders:c,body:d}=this.buildBody({options:r}),f=this.buildHeaders({options:t,method:i,bodyHeaders:c,retryCount:n});return{req:{method:i,headers:f,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&d instanceof globalThis.ReadableStream&&{duplex:"half"},...d&&{body:d},...this.fetchOptions??{},...r.fetchOptions??{}},url:l,timeout:r.timeout}}buildHeaders({options:t,method:n,bodyHeaders:r,retryCount:i}){let s={};this.idempotencyHeader&&n!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=t.idempotencyKey);const o=Ce([s,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{},...Wv(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(t),this._options.defaultHeaders,r,t.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:t,headers:n}}){if(!t)return{bodyHeaders:void 0,body:void 0};const r=Ce([n]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&r.values.has("content-type")||t instanceof Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:om(t)}:A(this,jo,"f").call(this,{body:t,headers:r})}}Mu=He,jo=new WeakMap,vc=new WeakSet,gg=function(){return this.baseURL!=="https://api.openai.com/v1"};He.OpenAI=Mu;He.DEFAULT_TIMEOUT=6e5;He.OpenAIError=Ie;He.APIError=Nt;He.APIConnectionError=Ea;He.APIConnectionTimeoutError=pu;He.APIUserAbortError=yn;He.NotFoundError=qh;He.ConflictError=Zh;He.RateLimitError=tm;He.BadRequestError=Qh;He.AuthenticationError=Jh;He.InternalServerError=nm;He.PermissionDeniedError=Gh;He.UnprocessableEntityError=em;He.InvalidWebhookSignatureError=Ui;He.toFile=pw;He.Completions=Jm;He.Chat=xu;He.Embeddings=qm;He.Files=eg;He.Images=og;He.Audio=Ms;He.Moderations=lg;He.Models=ag;He.FineTuning=Pi;He.Graders=Iu;He.VectorStores=Aa;He.Webhooks=mg;He.Beta=$s;He.Batches=Bm;He.Uploads=Ru;He.Responses=Au;He.Evals=Eu;He.Containers=_u;const Ef="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",bf=`You are an AI assistant that helps users edit video projects in Video Editor video editor. Your task is to interpret user commands and modify the provided project JSON to implement the requested changes.

## Video Editor Project Structure

You will receive a JSON project with this structure:
- \`assets\`: Array of video, audio, and image assets
- \`timeline\`: Contains tracks with clips, each clip has timing, keyframes, and properties
- \`canvasWidth/Height\`: Canvas dimensions
- \`backgroundColor\`: Background color

## Available Editing Operations

### Timing Operations
- Move clips to different positions
- Change clip duration, in/out points
- Adjust playback speed (\`playbackSpeed\`: 1.0 = normal, 0.5 = half speed, 2.0 = double speed)
- Reverse clips (\`reversed\`: true/false)

### Animation & Effects
- **Transform keyframes**: Position (x,y), rotation (degrees), scale (x,y), opacity (0-1)
- **Audio keyframes**: Volume (0-1)
- **Easing**: "linear", "ease-in", "ease-out", "ease-in-out"

### Track Operations
- Add/remove/reorder tracks
- Show/hide tracks (\`visible\`: true/false)
- Lock/unlock tracks (\`locked\`: true/false)

### Project Settings
- Change canvas dimensions
- Modify background color
- Adjust timeline duration and FPS

## Command Examples

**"Make the first clip fade in over 2 seconds"**
 Add opacity keyframes: time 0 = 0, time 2 = 1

**"Slow down the second clip to half speed"**
 Set \`playbackSpeed\` to 0.5

**"Move the music track to start at 5 seconds"**
 Change audio clip \`start\` to 5

**"Make the video zoom in gradually"**
 Add scale keyframes: time 0 = { "scaleX": 0.5, "scaleY": 0.5 }, time end = { "scaleX": 1.0, "scaleY": 1.0 }

**"Lower the music volume during the first 10 seconds"**
 Add volume keyframes: time 0 = 0.3, time 10 = 0.8

## Response Format

Respond ONLY with a valid JSON object representing the COMPLETE modified project. The response must:
- Be valid JSON that matches the Project interface
- Include ALL original data (don't remove existing assets/tracks/clips)
- Only modify the specific elements requested
- Preserve asset IDs and references
- Maintain proper keyframe structure with time, value, and easing

## Keyframe Structure
\`\`\`typescript
{
  "keyframes": {
    "position": [{ "time": 0, "value": { "x": 0, "y": 0 }, "easing": "linear" }],
    "rotation": [{ "time": 0, "value": 0, "easing": "linear" }],
    "scale": [{ "time": 0, "value": { "scaleX": 1, "scaleY": 1 }, "easing": "linear" }],
    "opacity": [{ "time": 0, "value": 1, "easing": "linear" }]
  },
  "audioKeyframes": {
    "volume": [{ "time": 0, "value": 0.8, "easing": "linear" }]
  }
}
\`\`\`

## Important Rules
- Always preserve existing assets and their IDs
- Times are in seconds (not frames)
- Keyframe times are relative to clip start
- Don't add assets - only modify existing ones
- If a request is unclear, make reasonable assumptions
- If impossible, return the original project unchanged
- CRITICAL: Scale keyframes must always use "scaleX" and "scaleY" properties, never "x" and "y"

Analyze the user command and project context, then output ONLY the modified project JSON.`;let gi=null;try{Ef&&(gi=new He({apiKey:Ef,dangerouslyAllowBrowser:!0}))}catch(e){console.error("Failed to initialize OpenAI client:",e),gi=null}async function Fw(e,t){var n,r,i;if(!gi)return console.error("OpenAI client not initialized. Cannot interpret command."),null;try{const s={...t,assets:t.assets.map(c=>({id:c.id,name:c.name,type:c.type,duration:c.duration}))},o=`User Command: "${e}"

Current Project JSON:
${JSON.stringify(s,null,2)}`;console.log("Sending to AI (User Command):",e),console.log("Request payload size:",o.length,"characters");let a;try{console.log("Trying GPT-4.1-mini..."),a=await gi.chat.completions.create({model:"gpt-4.1-mini",messages:[{role:"system",content:bf},{role:"user",content:o}],temperature:.1,response_format:{type:"json_object"},max_tokens:32768})}catch(c){console.warn("GPT-4o failed, trying GPT-4.1:",c),a=await gi.chat.completions.create({model:"gpt-4.1",messages:[{role:"system",content:bf},{role:"user",content:o}],temperature:.1,response_format:{type:"json_object"},max_tokens:32768})}const l=(r=(n=a.choices[0])==null?void 0:n.message)==null?void 0:r.content;if(console.log("Raw AI Response received:",l?"Success":"Empty response"),console.log("Response length:",(l==null?void 0:l.length)||0,"characters"),!l)return console.error("OpenAI response content is empty."),null;try{const c=JSON.parse(l);return c.id&&c.name&&c.assets&&c.timeline?(console.log("Successfully parsed AI response"),c):(console.error("Parsed OpenAI response does not match Project structure"),null)}catch(c){return console.error("Failed to parse OpenAI JSON response:",c),console.error("Raw response content:",l),null}}catch(s){return console.error("Error calling OpenAI API:",s),s instanceof Error&&(console.error("Error message:",s.message),console.error("Error stack:",s.stack)),(i=s==null?void 0:s.error)!=null&&i.message&&console.error("OpenAI API error message:",s.error.message),s!=null&&s.status&&console.error("HTTP status:",s.status),null}}function zw(){return gi!==null}const Uw=({onProjectUpdate:e})=>{const{project:t}=ft(),[n,r]=G.useState(""),[i,s]=G.useState(!1),[o,a]=G.useState(!1),[l,c]=G.useState([]),[d,f]=G.useState(!1),[m,g]=G.useState(!1),v=G.useRef(null),w=G.useRef(null),j=G.useRef(null);G.useEffect(()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const S=window.SpeechRecognition||window.webkitSpeechRecognition;j.current=new S,j.current.continuous=!1,j.current.interimResults=!1,j.current.lang="en-US",j.current.onresult=b=>{const T=b.results[0][0].transcript;r(T),a(!1)},j.current.onerror=b=>{console.error("Speech recognition error:",b.error),a(!1)},j.current.onend=()=>{a(!1)}}},[]),G.useEffect(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},[l]);const h=async S=>{if(S.preventDefault(),!n.trim()||i)return;const b=n.trim();r(""),s(!0),c(T=>[...T,{text:b,type:"user"}]);try{const T=new Promise((O,J)=>setTimeout(()=>J(new Error("Request timed out after 120 seconds")),12e4)),z=await Promise.race([Fw(b,t),T]);z?(e(z),c(O=>[...O,{text:"Project updated successfully!",type:"ai"}])):c(O=>[...O,{text:"Sorry, I couldn't process that request. Please check the console for errors and try rephrasing.",type:"error"}])}catch(T){console.error("AI command error:",T);let z="An error occurred while processing your request.";T instanceof Error&&(T.message.includes("timeout")?z="Request timed out. The AI might be overloaded - please try again.":T.message.includes("API key")?z="API key issue. Please check your OpenAI API key.":(T.message.includes("quota")||T.message.includes("limit"))&&(z="API quota exceeded. Please check your OpenAI usage limits.")),c(O=>[...O,{text:z,type:"error"}])}finally{s(!1)}},u=()=>{j.current&&!o&&(a(!0),j.current.start())},p=()=>{j.current&&o&&(j.current.stop(),a(!1))},x=()=>{c([])};return zw()?m?y.jsxs("div",{style:{position:"absolute",bottom:"10px",right:"10px",backgroundColor:"#2a2a2a",border:"1px solid #555",borderRadius:"8px",width:"48px",height:"48px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",zIndex:1e3,transition:"all 0.3s ease"},onClick:()=>g(!1),title:"Open AI Assistant",children:[y.jsx("span",{style:{fontSize:"20px"},children:""}),i&&y.jsx("div",{style:{position:"absolute",top:"2px",right:"2px",width:"8px",height:"8px",backgroundColor:"#4a90e2",borderRadius:"50%",animation:"pulse 1s infinite"}})]}):y.jsxs("div",{style:{position:"absolute",bottom:"10px",left:"10px",right:"10px",backgroundColor:"#2a2a2a",border:"1px solid #555",borderRadius:"8px",maxHeight:d?"300px":"50px",transition:"max-height 0.3s ease",display:"flex",flexDirection:"column",zIndex:1e3},children:[d&&y.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 12px",borderBottom:"1px solid #555"},children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"12px",color:"#fff"},children:[y.jsx("span",{children:""}),y.jsx("span",{children:"AI Assistant"}),i&&y.jsx("span",{style:{color:"#4a90e2"},children:""})]}),y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[l.length>0&&y.jsx("button",{onClick:S=>{S.stopPropagation(),x()},style:{background:"none",border:"none",color:"#888",fontSize:"12px",cursor:"pointer",padding:"2px 4px"},title:"Clear chat",children:""}),y.jsx("button",{onClick:()=>g(!0),style:{background:"none",border:"none",color:"#888",fontSize:"12px",cursor:"pointer",padding:"2px 4px"},title:"Minimize to icon",children:""}),y.jsx("button",{onClick:()=>f(!1),style:{background:"none",border:"none",color:"#888",fontSize:"12px",cursor:"pointer",padding:"2px 4px"},title:"Collapse",children:""})]})]}),d&&y.jsx("div",{ref:w,style:{flex:1,padding:"8px 12px",overflowY:"auto",maxHeight:"200px",minHeight:"60px"},children:l.length===0?y.jsx("div",{style:{color:"#888",fontSize:"12px",textAlign:"center",padding:"20px"},children:'Ask me to edit your video! Try: "make the first clip fade in" or "slow down the music"'}):l.map((S,b)=>y.jsxs("div",{style:{marginBottom:"8px",padding:"4px 8px",backgroundColor:S.type==="user"?"#4a90e2":S.type==="error"?"#d32f2f":"#333",borderRadius:"4px",fontSize:"12px",color:"#fff"},children:[y.jsxs("strong",{children:[S.type==="user"?"You":S.type==="error"?"Error":"AI",":"]})," ",S.text]},b))}),y.jsxs("form",{onSubmit:h,style:{display:"flex",padding:"8px 12px",gap:"6px",alignItems:"center",minHeight:"34px"},children:[!d&&y.jsx("button",{type:"button",onClick:()=>f(!0),style:{padding:"4px 6px",backgroundColor:"transparent",border:"1px solid #555",borderRadius:"4px",color:"#fff",fontSize:"12px",cursor:"pointer",minWidth:"24px",display:"flex",alignItems:"center",justifyContent:"center"},title:"Expand chat",children:""}),y.jsx("input",{ref:v,type:"text",value:n,onChange:S=>r(S.target.value),placeholder:o?"Listening...":"Ask me to edit your video...",disabled:i||o,style:{flex:1,padding:"4px 6px",backgroundColor:"#1a1a1a",border:"1px solid #555",borderRadius:"3px",color:"#fff",fontSize:"11px",outline:"none",minHeight:"18px"}}),j.current&&y.jsx("button",{type:"button",onClick:o?p:u,disabled:i,style:{padding:"4px 6px",backgroundColor:o?"#d32f2f":"#4a90e2",border:"none",borderRadius:"3px",color:"#fff",fontSize:"10px",cursor:i?"not-allowed":"pointer",opacity:i?.6:1,minWidth:"24px",minHeight:"24px",display:"flex",alignItems:"center",justifyContent:"center"},title:o?"Stop listening":"Start voice input",children:o?"":""}),y.jsx("button",{type:"submit",disabled:!n.trim()||i||o,style:{padding:"4px 8px",backgroundColor:"#4a90e2",border:"none",borderRadius:"3px",color:"#fff",fontSize:"10px",cursor:!n.trim()||i||o?"not-allowed":"pointer",opacity:!n.trim()||i||o?.6:1,minHeight:"24px"},children:i?"...":""}),!d&&y.jsx("button",{type:"button",onClick:()=>g(!0),style:{padding:"4px 6px",backgroundColor:"transparent",border:"1px solid #555",borderRadius:"4px",color:"#888",fontSize:"10px",cursor:"pointer",minWidth:"24px",minHeight:"24px",display:"flex",alignItems:"center",justifyContent:"center"},title:"Minimize to icon",children:""})]})]}):y.jsx("div",{style:{position:"absolute",bottom:"10px",left:"10px",right:"10px",backgroundColor:"#2a2a2a",border:"1px solid #555",borderRadius:"8px",padding:"10px",color:"#aaa",fontSize:"12px",textAlign:"center"},children:"AI Assistant unavailable - Add your OpenAI API key to src/ai/aiInterpreter.ts"})},Hw=()=>{var X,ie;const e=G.useRef(null),{project:t,playback:n,assetsLoading:r,canvasSelectedClipId:i,selectCanvasClip:s,getClipAtCanvasPosition:o,updateClipTransform:a,saveHistory:l,getClipTransform:c,getEffectiveDuration:d,setProject:f}=ft(),m=L=>{const U={...L,assets:L.assets.map(W=>{const B=t.assets.find(F=>F.id===W.id);return{...W,element:B==null?void 0:B.element,thumbnail:B==null?void 0:B.thumbnail,waveform:B==null?void 0:B.waveform}})};f(U),l("AI Edit")},[g,v]=G.useState({width:640,height:360}),[w,j]=G.useState({x:0,y:0}),[h,u]=G.useState(!1),[p,x]=G.useState({x:0,y:0}),[S,b]=G.useState("move"),[T,z]=G.useState(null),[O,J]=G.useState({x:0,y:0,scaleX:1,scaleY:1,rotation:0}),[ee,P]=G.useState({x:0,y:0}),[_e,ht]=G.useState(1),[Je,Ut]=G.useState({x:0,y:0}),[Yt,ae]=G.useState({x:0,y:0}),fe=[.1,.25,.5,.75,1,1.25,1.5,2,3,4,5,10];G.useEffect(()=>{const L=()=>{if(!e.current)return;const U=e.current.parentElement;if(!U)return;const W=U.clientWidth-40,B=U.clientHeight-40,F=t.canvasWidth/t.canvasHeight;let q=W,V=q/F;V>B&&(V=B,q=V*F),q=Math.max(q,320),V=Math.max(V,180),v({width:q,height:V})};return L(),window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[t.canvasWidth,t.canvasHeight]),G.useEffect(()=>{vt(),Ye()},[t,n.currentTime,g,n.isPlaying,_e,Je]),G.useEffect(()=>{const L=W=>{if(!e.current)return;const F=e.current.getBoundingClientRect(),q=W.clientX-F.left,V=W.clientY-F.top;if(q>=0&&q<=F.width&&V>=0&&V<=F.height){W.preventDefault();const xe=fe.findIndex(Se=>Math.abs(Se-_e)<.001),Y=W.deltaY>0?-1:1;let Pe;if(xe===-1){const Se=fe.reduce((ke,De)=>Math.abs(De-_e)<Math.abs(ke-_e)?De:ke);Pe=fe.indexOf(Se)+Y}else Pe=xe+Y;Pe=Math.max(0,Math.min(fe.length-1,Pe));const Ee=fe[Pe];Ee!==_e&&ht(Ee)}},U=e.current;if(U)return U.addEventListener("wheel",L,{passive:!1}),()=>U.removeEventListener("wheel",L)},[_e,Je,g]);const ve=()=>{ht(1),Ut({x:0,y:0})};G.useEffect(()=>{const L=U=>{if(!(U.target instanceof HTMLInputElement||U.target instanceof HTMLTextAreaElement)){if(U.key==="0"&&(U.ctrlKey||U.metaKey))U.preventDefault(),ht(1),Ut({x:0,y:0});else if(U.key==="="&&(U.ctrlKey||U.metaKey)){U.preventDefault();const W=fe.findIndex(F=>Math.abs(F-_e)<.001),B=W===-1?fe.findIndex(F=>F>_e):Math.min(fe.length-1,W+1);B!==-1&&ht(fe[B])}else if(U.key==="-"&&(U.ctrlKey||U.metaKey)){U.preventDefault();const W=fe.findIndex(F=>Math.abs(F-_e)<.001),B=W===-1?[...fe].reverse().findIndex(F=>F<_e):Math.max(0,W-1);if(B!==-1){const F=W===-1?fe.length-1-B:B;ht(fe[F])}}}};return window.addEventListener("keydown",L),()=>window.removeEventListener("keydown",L)},[]),G.useEffect(()=>{const L=W=>{if(!h||!i)return;const B=_();if(!B)return;const F=e.current;if(!F)return;const q=F.getBoundingClientRect(),V=W.clientX-q.left,xe=W.clientY-q.top,Y=W.clientX-p.x,Pe=W.clientY-p.y,Ee=n.currentTime-B.start;if(S==="pan"){const Se=Yt.x+Y,ke=Yt.y+Pe;Ut({x:Se,y:ke})}else if(S==="move"){const Se=O.x+Y/g.width*t.canvasWidth,ke=O.y+Pe/g.height*t.canvasHeight;a(i,"position",{x:Se,y:ke},Ee)}else if(S==="scale"&&T){let Se=O.scaleX,ke=O.scaleY,De=O.x,$e=O.y;if(T.corner)if(W.ctrlKey)if(W.shiftKey){const Te=1+Y/200,be=1+-Pe/200;Se=Math.max(.1,O.scaleX*Te),ke=Math.max(.1,O.scaleY*be)}else{const Te=Math.sqrt(Math.pow(p.x-ee.x,2)+Math.pow(p.y-ee.y,2)),be=Math.sqrt(Math.pow(W.clientX-ee.x,2)+Math.pow(W.clientY-ee.y,2)),Oe=Te>0?be/Te:1;Se=Math.max(.1,O.scaleX*Oe),ke=Math.max(.1,O.scaleY*Oe)}else if(W.shiftKey){const Te=1+Y/200,be=1+-Pe/200;Se=Math.max(.1,O.scaleX*Te),ke=Math.max(.1,O.scaleY*be);const Oe=_(),je=Oe?t.assets.find(ne=>ne.id===Oe.assetId):null;if(je!=null&&je.element){let ne=100,Ne=100;je.element instanceof HTMLVideoElement?(ne=je.element.videoWidth,Ne=je.element.videoHeight):je.element instanceof HTMLImageElement&&(ne=je.element.naturalWidth,Ne=je.element.naturalHeight);const le=Se-O.scaleX,ze=ke-O.scaleY;T.corner==="tl"?(De=O.x-ne*le/2,$e=O.y-Ne*ze/2):T.corner==="tr"?(De=O.x+ne*le/2,$e=O.y-Ne*ze/2):T.corner==="bl"?(De=O.x-ne*le/2,$e=O.y+Ne*ze/2):T.corner==="br"&&(De=O.x+ne*le/2,$e=O.y+Ne*ze/2)}}else{const Te=1+(Math.abs(Y)>Math.abs(Pe)?Y/200:-Pe/200);Se=Math.max(.1,O.scaleX*Te),ke=Math.max(.1,O.scaleY*Te);const be=_(),Oe=be?t.assets.find(je=>je.id===be.assetId):null;if(Oe!=null&&Oe.element){let je=100,ne=100;Oe.element instanceof HTMLVideoElement?(je=Oe.element.videoWidth,ne=Oe.element.videoHeight):Oe.element instanceof HTMLImageElement&&(je=Oe.element.naturalWidth,ne=Oe.element.naturalHeight);const Ne=Se-O.scaleX;T.corner==="tl"?(De=O.x-je*Ne/2,$e=O.y-ne*Ne/2):T.corner==="tr"?(De=O.x+je*Ne/2,$e=O.y-ne*Ne/2):T.corner==="bl"?(De=O.x-je*Ne/2,$e=O.y+ne*Ne/2):T.corner==="br"&&(De=O.x+je*Ne/2,$e=O.y+ne*Ne/2)}}else if(T.edge)if(W.ctrlKey)if(T.edge==="left"||T.edge==="right"){const Te=1+Y/200;Se=Math.max(.1,O.scaleX*Te)}else{const Te=1+-Pe/200;ke=Math.max(.1,O.scaleY*Te)}else{const Te=_(),be=Te?t.assets.find(Oe=>Oe.id===Te.assetId):null;if(be!=null&&be.element){let Oe=100,je=100;if(be.element instanceof HTMLVideoElement?(Oe=be.element.videoWidth,je=be.element.videoHeight):be.element instanceof HTMLImageElement&&(Oe=be.element.naturalWidth,je=be.element.naturalHeight),T.edge==="left"||T.edge==="right"){const ne=T.edge==="right"?1:-1,Ne=1+Y*ne/200;Se=Math.max(.1,O.scaleX*Ne);const le=Se-O.scaleX;T.edge==="left"?De=O.x-Oe*le/2:De=O.x+Oe*le/2}else{const ne=T.edge==="bottom"?1:-1,Ne=1+Pe*ne/200;ke=Math.max(.1,O.scaleY*Ne);const le=ke-O.scaleY;T.edge==="top"?$e=O.y-je*le/2:$e=O.y+je*le/2}}}Se=Math.min(Se,5),ke=Math.min(ke,5),a(i,"scale",{scaleX:Se,scaleY:ke},Ee),(De!==O.x||$e!==O.y)&&a(i,"position",{x:De,y:$e},Ee)}else if(S==="rotate"){const Se=g.width/2,ke=g.height/2,De=Math.atan2(p.y-q.top-ke,p.x-q.left-Se),Te=(Math.atan2(xe-ke,V-Se)-De)*(180/Math.PI),be=O.rotation+Te;a(i,"rotation",be,Ee)}},U=()=>{if(h&&i){const W=_();if(W){const B=n.currentTime-W.start,F=E(W,B);S==="move"?a(i,"position",{x:F.x,y:F.y},B,!0):S==="scale"?a(i,"scale",{scaleX:F.scaleX,scaleY:F.scaleY},B,!0):S==="rotate"&&a(i,"rotation",F.rotation,B,!0)}}u(!1),z(null)};return h&&(document.addEventListener("mousemove",L),document.addEventListener("mouseup",U)),()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",U)}},[h,p,S,T,i,O,ee,g,t.canvasWidth,t.canvasHeight,n.currentTime]);const Ye=()=>{try{const L=t.timeline.currentTime,{clipElementMap:U,createClipElement:W}=ft.getState();t.timeline.tracks.forEach(B=>{B.visible&&B.clips.forEach(F=>{const q=F.start+d(F),V=t.assets.find(Y=>Y.id===F.assetId);if(!V){console.log(`Asset not found for clip ${F.id.slice(-4)}`);return}(V==null?void 0:V.type)==="audio"&&!U.has(F.id)&&W(F.id,F.assetId);const xe=U.get(F.id);if((V==null?void 0:V.type)==="video"){const Y=xe||V.element;if(!Y||typeof Y.pause!="function"){console.log(`Invalid video element for clip ${F.id.slice(-4)}`);return}if(Y.muted||(Y.muted=!0),L>=F.start&&L<=q){const Pe=L-F.start,Ee=F.inPoint||0,Se=F.outPoint||V.duration||F.duration;let ke;const De=F.playbackSpeed||1;if(F.reversed){const Te=1-Pe/d(F);ke=Ee+Te*(Se-Ee)}else ke=Pe*De+Ee;if(ke>=Ee&&ke<=Se){const $e=F.reversed?.033:.1;Math.abs(Y.currentTime-ke)>$e&&(Y.currentTime=ke)}else Y.paused||Y.pause();Y.playbackRate!==De&&(Y.playbackRate=De),n.isPlaying&&Y.paused?Y.play().catch($e=>console.log("Video play failed:",$e)):!n.isPlaying&&!Y.paused&&Y.pause()}else Y.paused||Y.pause()}if((V==null?void 0:V.type)==="audio"){if(r){console.log(`Assets still loading, skipping audio for clip ${F.id.slice(-4)}`);return}const Y=xe||V.element;if(!Y||typeof Y.pause!="function"){console.log(`Invalid audio element for clip ${F.id.slice(-4)}`);return}if(Y===V.element&&!xe&&console.log(`Warning: clip ${F.id.slice(-4)} using shared audio element instead of independent element`),Y.readyState<1){console.log(`Audio not ready for clip ${F.id.slice(-4)}, readyState: ${Y.readyState}`);return}if(Y.seeking){console.log(`Audio seeking for clip ${F.id.slice(-4)}, skipping frame`);return}if(L>=F.start&&L<=q){const Pe=L-F.start,Ee=F.inPoint||0,Se=F.outPoint||V.duration||F.duration;let ke;const De=F.playbackSpeed||1;if(F.reversed){const Te=1-Pe/d(F);ke=Ee+Te*(Se-Ee)}else ke=Pe*De+Ee;if(ke>=Ee&&ke<=Se){const $e=F.reversed?.033:.1;if(Math.abs(Y.currentTime-ke)>$e)try{Y.currentTime=ke}catch(be){console.log(`Failed to seek audio for clip ${F.id.slice(-4)}:`,be);return}const Te=Be(F,Pe);try{Y.volume=Math.max(0,Math.min(1,Te))}catch(be){console.log(`Failed to set volume for clip ${F.id.slice(-4)}:`,be)}Y.playbackRate!==De&&(Y.playbackRate=De),n.isPlaying&&Y.paused&&!Y.seeking?Y.play().catch(be=>console.log(`Audio play failed for clip ${F.id.slice(-4)}:`,be)):!n.isPlaying&&!Y.paused&&Y.pause()}else Y.paused||Y.pause()}else Y.paused||Y.pause()}})})}catch(L){console.error("Error in syncVideoElements:",L)}},Be=(L,U)=>{var V;if(!((V=L.audioKeyframes)!=null&&V.volume)||L.audioKeyframes.volume.length===0)return 1;const W=L.audioKeyframes.volume;if(W.length===1)return W[0].value;let B=W[0],F=W[W.length-1];for(let xe=0;xe<W.length-1;xe++)if(U>=W[xe].time&&U<=W[xe+1].time){B=W[xe],F=W[xe+1];break}const q=(U-B.time)/(F.time-B.time);return B.value+(F.value-B.value)*q},vt=()=>{const L=e.current;if(!L)return;const U=L.getContext("2d");if(!U)return;L.width=g.width,L.height=g.height,U.fillStyle=t.backgroundColor,U.fillRect(0,0,L.width,L.height);const W=t.timeline.currentTime;[...t.timeline.tracks].reverse().forEach(F=>{F.visible&&F.clips.forEach(q=>{const V=q.start+d(q);W>=q.start&&W<=V&&Me(U,q,W-q.start)})})},Me=(L,U,W)=>{const B=t.assets.find(Ee=>Ee.id===U.assetId);if(!B||!B.element)return;const F=B.element;if(!F||F instanceof HTMLVideoElement&&(!F.videoWidth||typeof F.pause!="function")||F instanceof HTMLImageElement&&!F.complete||F instanceof HTMLAudioElement)return;const q=at(U,W);L.save();const V=g.width/t.canvasWidth*q.scaleX,xe=g.height/t.canvasHeight*q.scaleY,Y=q.x/t.canvasWidth*g.width,Pe=q.y/t.canvasHeight*g.height;L.globalAlpha=q.opacity,L.translate(Y+g.width/2,Pe+g.height/2),L.rotate(q.rotation*Math.PI/180),L.scale(V,xe);try{B.type==="video"&&F instanceof HTMLVideoElement?L.drawImage(F,-F.videoWidth/2,-F.videoHeight/2):B.type==="image"&&F instanceof HTMLImageElement&&L.drawImage(F,-F.naturalWidth/2,-F.naturalHeight/2)}catch(Ee){console.warn("Failed to render clip:",Ee),L.fillStyle="#333",L.fillRect(-50,-30,100,60),L.fillStyle="#666",L.font="12px Arial",L.textAlign="center",L.fillText("Missing",0,-5),L.fillText("Media",0,10)}L.restore()},at=(L,U)=>c(L.id,U)||{x:0,y:0,rotation:0,scaleX:1,scaleY:1,opacity:1},Z=L=>{const U=e.current;if(!U)return;const W=U.getBoundingClientRect(),B=L.clientX-W.left,F=L.clientY-W.top;if(j({x:B,y:F}),x({x:L.clientX,y:L.clientY}),L.button===1||L.ctrlKey||L.metaKey){u(!0),b("pan"),ae({...Je});return}const q=D(B,F),V=o(q.x,q.y,g.width,g.height);if(V){s(V),u(!0),b("move");const xe=te(V);if(xe){const Y=E(xe,n.currentTime-xe.start);J(Y)}}else s(null)},ue=L=>{const U=e.current;if(!U)return;const W=U.getBoundingClientRect(),B=L.clientX-W.left,F=L.clientY-W.top;j({x:B,y:F})},Fe=()=>{},_=()=>i?te(i):null,D=(L,U)=>({x:L,y:U}),te=L=>{for(const U of t.timeline.tracks)for(const W of U.clips)if(W.id===L)return W;return null},E=(L,U)=>c(L.id,U)||{x:0,y:0,rotation:0,scaleX:1,scaleY:1,opacity:1},K=L=>{var Ht;const U=te(L);if(!U)return[];const W=t.assets.find(rn=>rn.id===U.assetId);if(!W||W.type==="audio")return[];const B=n.currentTime;if(B<U.start||B>U.start+U.duration)return[];const F=B-U.start,q=E(U,F),V=e.current;if(!V)return[];const xe=V.getBoundingClientRect(),Y=(Ht=V.parentElement)==null?void 0:Ht.getBoundingClientRect();if(!Y)return[];const Pe=xe.left-Y.left,Ee=xe.top-Y.top,Se=g.width/t.canvasWidth*q.scaleX,ke=g.height/t.canvasHeight*q.scaleY,De=q.x/t.canvasWidth*g.width,$e=q.y/t.canvasHeight*g.height;let Te=100,be=100;W.element&&(W.element instanceof HTMLVideoElement?(Te=W.element.videoWidth,be=W.element.videoHeight):W.element instanceof HTMLImageElement&&(Te=W.element.naturalWidth,be=W.element.naturalHeight));const Oe=Te*Se,je=be*ke,ne=Oe*_e,Ne=je*_e,le=Pe+(De+g.width/2)*_e+Je.x,ze=Ee+($e+g.height/2)*_e+Je.y,Xe=ne/2,lt=Ne/2,Qt=q.rotation*Math.PI/180,Sn=(rn,ct)=>{const xr=Math.cos(Qt),Sr=Math.sin(Qt),Ns=rn-le,Ds=ct-ze;return{x:le+(Ns*xr-Ds*Sr),y:ze+(Ns*Sr+Ds*xr)}};return[{x:le-Xe,y:ze-lt,type:"corner",cursor:"nw-resize",corner:"tl"},{x:le+Xe,y:ze-lt,type:"corner",cursor:"ne-resize",corner:"tr"},{x:le-Xe,y:ze+lt,type:"corner",cursor:"sw-resize",corner:"bl"},{x:le+Xe,y:ze+lt,type:"corner",cursor:"se-resize",corner:"br"},{x:le,y:ze-lt,type:"edge",cursor:"n-resize",edge:"top"},{x:le,y:ze+lt,type:"edge",cursor:"s-resize",edge:"bottom"},{x:le-Xe,y:ze,type:"edge",cursor:"w-resize",edge:"left"},{x:le+Xe,y:ze,type:"edge",cursor:"e-resize",edge:"right"},{x:le,y:ze-lt-20*_e,type:"rotate",cursor:"crosshair"}].map(rn=>{const ct=Sn(rn.x,rn.y);return{...rn,x:ct.x,y:ct.y}})},R=()=>{var ze;if(!i)return null;const L=te(i);if(!L)return null;const U=t.assets.find(Xe=>Xe.id===L.assetId);if(!U||U.type==="audio")return null;const W=n.currentTime;if(W<L.start||W>L.start+L.duration)return null;const B=W-L.start,F=E(L,B),q=e.current;if(!q)return null;const V=q.getBoundingClientRect(),xe=(ze=q.parentElement)==null?void 0:ze.getBoundingClientRect();if(!xe)return null;const Y=V.left-xe.left,Pe=V.top-xe.top,Ee=g.width/t.canvasWidth*F.scaleX,Se=g.height/t.canvasHeight*F.scaleY,ke=F.x/t.canvasWidth*g.width,De=F.y/t.canvasHeight*g.height;let $e=100,Te=100;U.element&&(U.element instanceof HTMLVideoElement?($e=U.element.videoWidth,Te=U.element.videoHeight):U.element instanceof HTMLImageElement&&($e=U.element.naturalWidth,Te=U.element.naturalHeight));const be=$e*Ee,Oe=Te*Se;Y+ke+g.width/2,Pe+De+g.height/2;const je=be*_e,ne=Oe*_e,Ne=Y+(ke+g.width/2)*_e+Je.x,le=Pe+(De+g.height/2)*_e+Je.y;return y.jsx("div",{className:"canvas-selection-border",style:{position:"absolute",left:Ne-je/2,top:le-ne/2,width:je,height:ne,transform:`rotate(${F.rotation}deg)`,transformOrigin:"center",pointerEvents:"none"}})},H=()=>{if(!i)return null;const L=K(i),U=Math.max(6,8*Math.min(_e,1.5)),W=U/2;return L.map((B,F)=>y.jsx("div",{className:`transform-handle ${B.type} ${B.corner||B.edge||""}`,style:{position:"absolute",left:B.x-W,top:B.y-W,width:U,height:U,backgroundColor:B.type==="rotate"?"#ff6600":"#00cc99",border:"1px solid white",cursor:B.cursor,zIndex:20,borderRadius:B.type==="rotate"?"50%":"0",pointerEvents:"all"},onMouseDown:q=>{q.preventDefault(),q.stopPropagation(),u(!0),z(B),b(B.type==="rotate"?"rotate":"scale"),x({x:q.clientX,y:q.clientY});const V=_();if(V){const xe=E(V,n.currentTime-V.start);if(J(xe),B.type!=="rotate"){const Y=e.current,Pe=Y==null?void 0:Y.getBoundingClientRect();if(Pe){const Ee=xe.x/t.canvasWidth*g.width,Se=xe.y/t.canvasHeight*g.height,ke=Pe.left+(Ee+g.width/2)*_e+Je.x,De=Pe.top+(Se+g.height/2)*_e+Je.y;P({x:ke,y:De})}}}}},F))};return y.jsxs("div",{className:"canvas-container",style:{position:"relative"},children:[y.jsxs("div",{style:{position:"absolute",top:"10px",right:"10px",background:"rgba(0, 0, 0, 0.7)",color:"white",padding:"6px 10px",borderRadius:"4px",fontSize:"12px",zIndex:10},children:[t.canvasWidth,"",t.canvasHeight," | ",Math.round(_e*100),"%"]}),i&&y.jsxs("div",{style:{position:"absolute",top:"10px",left:"10px",background:"rgba(0, 204, 153, 0.8)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"11px",zIndex:10},children:["Selected: ",(X=te(i))!=null&&X.assetId&&((ie=t.assets.find(L=>{var U;return L.id===((U=te(i))==null?void 0:U.assetId)}))==null?void 0:ie.name)||"Clip"]}),y.jsx("canvas",{ref:e,className:"preview-canvas",width:g.width,height:g.height,onMouseDown:Z,onMouseMove:ue,onMouseUp:Fe,onDoubleClick:ve,style:{cursor:h?"grabbing":S==="pan"?"move":"grab",transform:`scale(${_e}) translate(${Je.x/_e}px, ${Je.y/_e}px)`,transformOrigin:"center"}}),R(),H(),y.jsx(Uw,{onProjectUpdate:m})]})},Ww=({clip:e,asset:t,clipWidth:n,pixelsPerSecond:r})=>{const i=G.useRef(null);return G.useEffect(()=>{if(!i.current||!t.waveform)return;const s=i.current,o=t.waveform,a=o.length,l=e.inPoint||0,c=e.outPoint||t.duration||e.duration,d=t.duration||e.duration,f=l/d*a,m=c/d*a;let g="#00ff88";e.reversed&&(g="#ff88ff"),Vh(s,o,f,m,n,24,g)},[e,t,n,r]),y.jsx("canvas",{ref:i,style:{position:"absolute",left:0,top:3,width:n,height:24,pointerEvents:"none",zIndex:1}})},Bw=()=>{const{project:e,playback:t,selectedClipIds:n,canvasSelectedClipId:r,selectClip:i,selectCanvasClip:s,updateClip:o,removeClip:a,addClipToTrack:l,addTrack:c,removeTrack:d,splitClip:f,reverseClip:m,takeSnapshot:g,exportAllFrames:v,copyClips:w,pasteClips:j,play:h,pause:u,stop:p,seek:x,saveHistory:S,removeKeyframe:b,moveKeyframe:T,updateClipTransform:z,getEffectiveDuration:O,getClipTransform:J}=ft(),ee=G.useRef(null),[P,_e]=G.useState({isDragging:!1,dragType:"move",clipId:null,startX:0,startY:0,startTime:0,startDuration:0,originalTrackId:null,currentTrackId:null}),[ht,Je]=G.useState({clipId:null,edge:null}),[Ut,Yt]=G.useState(!1),[ae,fe]=G.useState(!1),[ve,Ye]=G.useState(!0),[Be,vt]=G.useState({isSnapped:!1,snapPosition:0,snapType:"start",snapTargetClipId:null,originalPosition:0}),[Me,at]=G.useState({isDragging:!1,isPotentialDrag:!1,startX:0,startY:0,currentX:0,currentY:0}),[Z,ue]=G.useState(e.timeline.tracks.length>0?e.timeline.tracks[0].id:null),[Fe,_]=G.useState({isDragging:!1}),[D,te]=G.useState(50),E=()=>{if(!ee.current)return;const C=ee.current,M=e.timeline.currentTime*D,$=C.clientWidth,k=C.scrollLeft,I=100,N=Math.max(e.timeline.duration*D,1e3),he=$-I,oe=Math.max(0,N-he),ge=k,ye=k+he;if(M<ge||M>ye-50){const me=M-he/2;C.scrollLeft=Math.max(0,Math.min(me,oe))}},K=[10,25,50,100,200,500],R=K.indexOf(D),H=()=>{const C=Math.min(R+1,K.length-1);te(K[C])},X=()=>{const C=Math.max(R-1,0);te(K[C])};G.useEffect(()=>{E()},[e.timeline.currentTime,D]);const ie=C=>{for(const M of e.timeline.tracks)if(M.clips.some($=>$.id===C))return M;return null},L=(C,M,$,k,I)=>{if(!C)return $;const N=C.clips.filter(oe=>!(oe.id===M||I&&I.includes(oe.id))),he=$+k;for(const oe of N){const ge=oe.start,ye=oe.start+O(oe);if(!(he<=ge||$>=ye))return $<ge?Math.max(0,ge-k):ye}return Math.max(0,$)},U=(C,M,$,k,I,N)=>{if(!C)return{start:I,duration:N};const he=C.clips.filter(ye=>ye.id!==M);let oe=I,ge=N;for(const ye of he){const me=ye.start,ce=ye.start+O(ye);oe<ce&&oe+ge>me&&oe<ce&&oe<$&&(oe=ce,ge=$+k-oe,ge=Math.max(.1,ge));const de=oe+ge;oe<ce&&de>me&&de>me&&de>$+k&&(ge=me-oe,ge=Math.max(.1,ge))}return{start:Math.max(0,oe),duration:Math.max(.1,ge)}},W=(C,M,$)=>{if(!C)return M;const k=[...C.clips].sort((oe,ge)=>oe.start-ge.start),I=M+$;let N=!1;for(const oe of k)if(!(I<=oe.start||M>=oe.start+O(oe))){N=!0;break}if(!N)return Math.max(0,M);for(let oe=0;oe<k.length;oe++){const ge=k[oe],ye=k[oe+1],me=ge.start+O(ge);if(ye){if(ye.start-me>=$)return me}else return me}if(k.length===0)return Math.max(0,M);const he=k[k.length-1];return he.start+O(he)},B=(C,M,$)=>{const k=[];for(const I of e.timeline.tracks)if(I.id!==M)for(const N of I.clips)N.id!==C&&(k.push({position:N.start,type:"start",clipId:N.id,distance:0}),k.push({position:N.start+O(N),type:"end",clipId:N.id,distance:0}));return k},F=(C,M,$,k,I)=>{const N=10/D,he=20/D,oe=C+M,ge=B($,k);if(ge.push({position:e.timeline.currentTime,type:"start",clipId:"playhead",distance:0}),I.isSnapped)return Math.abs(C-I.originalPosition)>he?{position:C,isSnapped:!1,snapPosition:0,snapType:"start",snapTargetClipId:null,originalPosition:C}:{position:I.snapPosition,isSnapped:!0,snapPosition:I.snapPosition,snapType:I.snapType,snapTargetClipId:I.snapTargetClipId,originalPosition:I.originalPosition};let ye=null,me=N;for(const ce of ge){const de=Math.abs(C-ce.position);de<me&&(ye={position:ce.position,snapType:"start",distance:de,targetClipId:ce.clipId},me=de);const we=Math.abs(oe-ce.position);we<me&&(ye={position:ce.position-M,snapType:"end",distance:we,targetClipId:ce.clipId},me=we)}return ye?{position:ye.position,isSnapped:!0,snapPosition:ye.position,snapType:ye.snapType,snapTargetClipId:ye.targetClipId,originalPosition:C}:{position:C,isSnapped:!1,snapPosition:0,snapType:"start",snapTargetClipId:null,originalPosition:C}},q=(C,M,$,k,I)=>{if(!ve)return{position:C,isSnapped:!1,snapPosition:0,snapType:"start",snapTargetClipId:null,originalPosition:C};const N=10/D,he=20/D,oe=B(M,$);if(oe.push({position:e.timeline.currentTime,type:"start",clipId:"playhead",distance:0}),k.isSnapped)return Math.abs(C-k.originalPosition)>he?{position:C,isSnapped:!1,snapPosition:0,snapType:"start",snapTargetClipId:null,originalPosition:C}:{position:k.snapPosition,isSnapped:!0,snapPosition:k.snapPosition,snapType:k.snapType,snapTargetClipId:k.snapTargetClipId,originalPosition:k.originalPosition};let ge=null,ye=N;for(const me of oe){const ce=Math.abs(C-me.position);ce<ye&&(ge={position:me.position,snapType:I==="left"?"start":"end",distance:ce,targetClipId:me.clipId},ye=ce)}return ge?{position:ge.position,isSnapped:!0,snapPosition:ge.position,snapType:ge.snapType,snapTargetClipId:ge.targetClipId,originalPosition:C}:{position:C,isSnapped:!1,snapPosition:0,snapType:"start",snapTargetClipId:null,originalPosition:C}},V=()=>{if(!ee.current)return;ee.current.getBoundingClientRect();const C=ee.current.scrollLeft,M=100,$=40,k=40,I=Math.min(Me.startX,Me.currentX)-M+C,N=Math.max(Me.startX,Me.currentX)-M+C,he=Math.min(Me.startY,Me.currentY)-$,oe=Math.max(Me.startY,Me.currentY)-$,ge=Math.max(0,I/D),ye=N/D,me=[];if(e.timeline.tracks.forEach((ce,de)=>{const we=de*k,Le=we+k;oe>=we&&he<=Le&&ce.clips.forEach(re=>{const Ge=re.start;re.start+re.duration>=ge&&Ge<=ye&&me.push(re.id)})}),me.length>0){i(me[0],!1);for(let ce=1;ce<me.length;ce++)i(me[ce],!0)}};G.useEffect(()=>{const C=k=>{if(Fe.isDragging&&ee.current){const ce=ee.current.getBoundingClientRect(),de=ee.current.scrollLeft,we=k.clientX-ce.left-100+de,Le=Math.max(0,Math.min(we/D,e.timeline.duration));x(Le);return}if(Me.isPotentialDrag&&!Me.isDragging&&ee.current){const ce=ee.current.getBoundingClientRect(),de=k.clientX-ce.left,we=k.clientY-ce.top;Math.abs(de-Me.startX)+Math.abs(we-Me.startY)>5?at(re=>({...re,isDragging:!0,isPotentialDrag:!1,currentX:de,currentY:we})):at(re=>({...re,currentX:de,currentY:we}));return}if(Me.isDragging&&ee.current){const ce=ee.current.getBoundingClientRect();at(de=>({...de,currentX:k.clientX-ce.left,currentY:k.clientY-ce.top})),V();return}if(!P.isDragging||!P.clipId)return;let I=null,N=null;for(const ce of e.timeline.tracks){const de=ce.clips.find(we=>we.id===P.clipId);if(de){I=de,N=e.assets.find(we=>we.id===de.assetId);break}}if(!I||!N)return;const oe=(k.clientX-P.startX)/D,ge=I.inPoint||0,ye=I.outPoint||(N.type==="image"?P.startDuration:N.duration)||P.startDuration,me=N.type==="image"?30:N.duration||P.startDuration;if(P.dragType==="move"){const ce=Math.max(0,P.startTime+oe);if(n.length>1&&n.includes(P.clipId)&&P.originalPositions){const We=P.originalPositions[P.clipId],Ze=ce-We;let wt=Ze,bt=!1;for(const Ve of n){const et=P.originalPositions[Ve];if(et===void 0)continue;let xt=null,mt=null;for(const Du of e.timeline.tracks){const Ou=Du.clips.find(kg=>kg.id===Ve);if(Ou){xt=Ou,mt=Du;break}}if(!xt||!mt)continue;const St=Math.max(0,et+Ze),Hr=L(mt,Ve,St,O(xt),n),kr=Hr-et;Ze>=0?kr<wt&&(wt=kr):kr>wt&&(wt=kr),Math.abs(Hr-St)>.01&&(bt=!0)}for(const Ve of n){const et=P.originalPositions[Ve];if(et===void 0)continue;const xt=Math.max(0,et+wt);o(Ve,{start:xt},!0)}fe(bt);return}const de=ie(P.clipId),we=(de==null?void 0:de.id)||P.currentTrackId;let Le;ve?Le=F(ce,O(I),P.clipId,we||"",Be):Le={position:ce,isSnapped:!1,snapPosition:0,snapType:"start",snapTargetClipId:null,originalPosition:ce},vt({isSnapped:Le.isSnapped,snapPosition:Le.snapPosition,snapType:Le.snapType,snapTargetClipId:Le.snapTargetClipId,originalPosition:Le.originalPosition});const re=Le.position;if(ee.current){const We=ee.current.getBoundingClientRect(),Ze=k.clientY-We.top,wt=40,Ve=Math.floor((Ze-40)/wt);if(Ve>=0&&Ve<e.timeline.tracks.length){const et=e.timeline.tracks[Ve];if((et.type==="video"&&(N.type==="video"||N.type==="image")||et.type==="audio"&&N.type==="audio")&&et.id!==P.currentTrackId){const mt=W(et,re,O(I));fe(Math.abs(mt-re)>.01),a(P.clipId);const St={...I,id:dt(),start:mt};l(et.id,St),_e(Hr=>({...Hr,clipId:St.id,currentTrackId:et.id,startTime:mt})),i(St.id),vt({isSnapped:!1,snapPosition:0,snapType:"start",snapTargetClipId:null,originalPosition:0});return}}}const Ge=L(de,P.clipId,re,O(I));fe(Math.abs(Ge-re)>.01),o(P.clipId,{start:Ge},!0)}else if(P.dragType==="trim-left")if(I.reversed){const ce=-oe,de=P.startTime-ce,we=ie(P.clipId),Le=(we==null?void 0:we.id)||P.currentTrackId;let re;ve?re=q(de,P.clipId,Le||"",Be,"left"):re={position:de,isSnapped:!1,snapPosition:0,snapType:"start",snapTargetClipId:null,originalPosition:de},vt({isSnapped:re.isSnapped,snapPosition:re.snapPosition,snapType:re.snapType,snapTargetClipId:re.snapTargetClipId,originalPosition:re.originalPosition});const Ge=re.position,We=P.startTime-Ge,Ze=me-ye,wt=P.startDuration-.1,bt=P.startTime;let Ve;We>0?Ve=Math.min(We,Ze,bt):Ve=Math.max(We,-wt);const et=Math.max(0,P.startTime-Ve),xt=P.startDuration+Ve,mt=ie(P.clipId),St=U(mt,P.clipId,P.startTime,P.startDuration,et,xt),Hr=St.start-P.startTime+(St.duration-P.startDuration),kr=ye-Hr;fe(Math.abs(St.start-et)>.01||Math.abs(St.duration-xt)>.01),o(P.clipId,{start:St.start,duration:St.duration,outPoint:kr<=me?kr:void 0},!0)}else{const ce=oe,de=P.startTime+ce,we=ie(P.clipId),Le=(we==null?void 0:we.id)||P.currentTrackId;let re;ve?re=q(de,P.clipId,Le||"",Be,"left"):re={position:de,isSnapped:!1,snapPosition:0,snapType:"start",snapTargetClipId:null,originalPosition:de},vt({isSnapped:re.isSnapped,snapPosition:re.snapPosition,snapType:re.snapType,snapTargetClipId:re.snapTargetClipId,originalPosition:re.originalPosition});const We=re.position-P.startTime,Ze=Math.min(P.startDuration-.1,ye-ge-.1),bt=Math.max(-ge,Math.min(Ze,We)),Ve=Math.max(0,P.startTime+bt),et=P.startDuration-bt,xt=ie(P.clipId),mt=U(xt,P.clipId,P.startTime,P.startDuration,Ve,et),St=ge+(mt.start-P.startTime);fe(Math.abs(mt.start-Ve)>.01||Math.abs(mt.duration-et)>.01),o(P.clipId,{start:mt.start,duration:mt.duration,inPoint:St>0?St:void 0},!0)}else if(P.dragType==="trim-right")if(I.reversed){const ce=-oe,de=P.startTime+P.startDuration-ce,we=ie(P.clipId),Le=(we==null?void 0:we.id)||P.currentTrackId;let re;ve?re=q(de,P.clipId,Le||"",Be,"right"):re={position:de,isSnapped:!1,snapPosition:0,snapType:"end",snapTargetClipId:null,originalPosition:de},vt({isSnapped:re.isSnapped,snapPosition:re.snapPosition,snapType:re.snapType,snapTargetClipId:re.snapTargetClipId,originalPosition:re.originalPosition});const Ge=re.position,We=P.startTime+P.startDuration-Ge,Ze=ge,wt=P.startDuration-.1;let bt;We<0?bt=Math.max(We,-Ze):bt=Math.min(We,wt);const Ve=P.startDuration-bt,et=ie(P.clipId),xt=U(et,P.clipId,P.startTime,P.startDuration,P.startTime,Ve),mt=P.startDuration-xt.duration,St=ge+mt;fe(Math.abs(xt.duration-Ve)>.01),o(P.clipId,{duration:xt.duration,inPoint:St>0?St:void 0},!0)}else{const ce=oe,de=P.startTime+P.startDuration+ce,we=ie(P.clipId),Le=(we==null?void 0:we.id)||P.currentTrackId;let re;ve?re=q(de,P.clipId,Le||"",Be,"right"):re={position:de,isSnapped:!1,snapPosition:0,snapType:"end",snapTargetClipId:null,originalPosition:de},vt({isSnapped:re.isSnapped,snapPosition:re.snapPosition,snapType:re.snapType,snapTargetClipId:re.snapTargetClipId,originalPosition:re.originalPosition});const We=re.position-(P.startTime+P.startDuration),Ze=me-ye,wt=P.startDuration-.1,bt=Math.max(-wt,Math.min(Ze,We)),Ve=P.startDuration+bt,et=ie(P.clipId),xt=U(et,P.clipId,P.startTime,P.startDuration,P.startTime,Ve),mt=ye+(xt.duration-P.startDuration);fe(Math.abs(xt.duration-Ve)>.01),o(P.clipId,{duration:xt.duration,outPoint:mt<me?mt:void 0},!0)}else if(P.dragType==="slip"){const de=(k.clientX-P.startX)/D,we=(P.startInPoint||0)+de;(P.startOutPoint||0)+de;const Le=me-P.startDuration,re=Math.max(0,Math.min(Le,we)),Ge=re+P.startDuration;o(P.clipId,{inPoint:re>0?re:void 0,outPoint:Ge<me?Ge:void 0},!0)}},M=()=>{const k=P.isDragging,I=Fe.isDragging,N=Me.isDragging,he=Me.isPotentialDrag;if(k&&P.clipId&&(console.log(` Completed ${P.dragType} operation for clip ${P.clipId.slice(-4)}`),P.historyAction&&(console.log(` Saving history after operation: ${P.historyAction}`),S(P.historyAction))),he&&!N&&ee.current){const ye=Me.startX-100,me=Me.startY-40,ce=Math.max(0,ye/D),de=Math.floor(me/40);me>=0&&de>=0&&de<e.timeline.tracks.length&&(x(ce),ue(e.timeline.tracks[de].id))}_e({isDragging:!1,dragType:"move",clipId:null,startX:0,startY:0,startTime:0,startDuration:0,originalTrackId:null,currentTrackId:null,originalPositions:void 0,historyAction:void 0,startInPoint:void 0,startOutPoint:void 0}),_({isDragging:!1}),at({isDragging:!1,isPotentialDrag:!1,startX:0,startY:0,currentX:0,currentY:0}),fe(!1),vt({isSnapped:!1,snapPosition:0,snapType:"start",snapTargetClipId:null,originalPosition:0}),(k||I||N)&&(Yt(!0),setTimeout(()=>Yt(!1),100))},$=k=>{const I=k.target;I.tagName==="INPUT"||I.tagName==="TEXTAREA"||I.contentEditable==="true"||(k.key==="s"||k.key==="S"?n.length>0&&(xr(),k.preventDefault()):(k.key==="c"||k.key==="C")&&(k.ctrlKey||k.metaKey)?(k.preventDefault(),n.length>0&&w()):(k.key==="v"||k.key==="V")&&(k.ctrlKey||k.metaKey)?(k.preventDefault(),j(Z||void 0)):k.key==="Delete"||k.key==="Backspace"?(k.preventDefault(),n.forEach(N=>a(N))):k.key===" "?(k.preventDefault(),t.isPlaying?u():h()):k.key==="Escape"?(k.preventDefault(),u()):k.key==="Home"?(k.preventDefault(),x(0)):k.key==="+"||k.key==="="?(k.preventDefault(),H()):k.key==="-"||k.key==="_"?(k.preventDefault(),X()):k.key==="o"||k.key==="O"?(k.preventDefault(),r&&Xe()):k.key==="p"||k.key==="P"?(k.preventDefault(),r&&lt()):k.key==="r"||k.key==="R"?(k.preventDefault(),r&&Qt()):k.key==="t"||k.key==="T"?(k.preventDefault(),r&&Sn()):(k.key==="i"||k.key==="I")&&(k.preventDefault(),k.shiftKey?Nu():$u()))};return(P.isDragging||Fe.isDragging||Me.isDragging||Me.isPotentialDrag)&&(document.addEventListener("mousemove",C),document.addEventListener("mouseup",M)),document.addEventListener("keydown",$),()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",M),document.removeEventListener("keydown",$)}},[P,Fe,Me,o,D,n,f,w,j,a,t.isPlaying,h,u,x,e.timeline.currentTime,e.timeline.duration]);const xe=(C,M)=>{C.stopPropagation();const $=C.ctrlKey||C.metaKey||C.shiftKey;(!n.includes(M.id)||$)&&(i(M.id,$),s(M.id));const I=ie(M.id);I&&ue(I.id);const N=C.target.getBoundingClientRect(),he=C.clientX-N.left,oe=O(M)*D,ge=8;let ye="move";he<ge?ye="trim-left":he>oe-ge&&(ye="trim-right");const me=ie(M.id);let ce;if(ye==="move"&&n.length>1&&n.includes(M.id)){ce={};for(const Le of e.timeline.tracks)for(const re of Le.clips)n.includes(re.id)&&(ce[re.id]=re.start)}const de=ye==="move"?"Move clip":"Trim clip",we=Date.now();console.log(` Starting ${ye} operation for clip ${M.id.slice(-4)} at ${we}`),_e({isDragging:!0,dragType:ye,clipId:M.id,startX:C.clientX,startY:C.clientY,startTime:M.start,startDuration:M.duration,originalTrackId:(me==null?void 0:me.id)||null,currentTrackId:(me==null?void 0:me.id)||null,originalPositions:ce,historyAction:`${de} (${we.toString().slice(-6)})`})},Y=(C,M)=>{C.preventDefault(),C.stopPropagation(),n.includes(M.id)||(i(M.id,!1),s(M.id));const $=ie(M.id);$&&ue($.id);const k=e.assets.find(N=>N.id===M.assetId);if(!k)return;const I=Date.now();console.log(` Starting slip operation for clip ${M.id.slice(-4)} at ${I}`),_e({isDragging:!0,dragType:"slip",clipId:M.id,startX:C.clientX,startY:C.clientY,startTime:M.start,startDuration:M.duration,originalTrackId:($==null?void 0:$.id)||null,currentTrackId:($==null?void 0:$.id)||null,historyAction:`Slip clip (${I.toString().slice(-6)})`,startInPoint:M.inPoint||0,startOutPoint:M.outPoint||(k.type==="image"?M.duration:k.duration)||M.duration})},Pe=(C,M)=>{M.stopPropagation(),a(C)},Ee=C=>{if(!ee.current||P.isDragging||Ut||Fe.isDragging||Me.isDragging||Me.isPotentialDrag||C.target.closest(".keyframe"))return;const $=ee.current.getBoundingClientRect(),k=ee.current.scrollLeft,I=C.clientX-$.left-100+k,N=Math.max(0,I/D);x(N),i(null),s(null)},Se=C=>{if(!ee.current)return;const M=C.target;if(M.closest(".clip")||M.closest(".playhead")||M.closest(".track-label"))return;const $=ee.current.getBoundingClientRect(),k=ee.current.scrollLeft,I=C.clientX-$.left,N=C.clientY-$.top,he=100,oe=40,ge=40,ye=I-he+k,me=N-oe,ce=Math.max(0,ye/D),de=Math.floor(me/ge);let we=!1;if(de>=0&&de<e.timeline.tracks.length){const Le=e.timeline.tracks[de];for(const re of Le.clips)if(re.start<=ce&&re.start+re.duration>=ce){we=!0;break}}we||me<0||de<0||de>=e.timeline.tracks.length||(at({isDragging:!1,isPotentialDrag:!0,startX:I,startY:N,currentX:I,currentY:N}),!C.ctrlKey&&!C.metaKey&&(i(null),s(null)))},ke=C=>{C.stopPropagation(),_({isDragging:!0})},De=(C,M)=>{var k;C.preventDefault();const $=C.target;$.className="track-content",$.style.borderColor="transparent";try{const I=JSON.parse(C.dataTransfer.getData("application/json"));if(I.type==="asset"){const N=e.assets.find(re=>re.id===I.assetId),he=e.timeline.tracks.find(re=>re.id===M);if(!N||!he)return;if(!(he.type==="video"&&(N.type==="video"||N.type==="image")||he.type==="audio"&&N.type==="audio")){console.warn(`Cannot add ${N.type} asset to ${he.type} track`);return}const ge=C.target.getBoundingClientRect(),ye=((k=ee.current)==null?void 0:k.scrollLeft)||0,me=C.clientX-ge.left+ye,ce=Math.max(0,me/D),de=N.duration||5,we=W(he,ce,de),Le={id:dt(),assetId:N.id,start:we,duration:de};if(l(M,Le),N.type==="video"){const re=`${N.name} (Audio)`,Ge=e.assets.find(We=>We.type==="audio"&&We.name===re);if(Ge){let We=e.timeline.tracks.find(Ze=>Ze.type==="audio");if(We||(c("audio"),We=e.timeline.tracks.find(Ze=>Ze.type==="audio")),We){const Ze=W(We,we,de),wt={id:dt(),assetId:Ge.id,start:Ze,duration:Ge.duration||de};l(We.id,wt),console.log(`Added synchronized audio clip for ${N.name} at time ${Ze}`)}}}}}catch(I){console.error("Drop error:",I)}},$e=(C,M)=>{C.preventDefault();try{const $=JSON.parse(C.dataTransfer.getData("application/json")),k=e.timeline.tracks.find(N=>N.id===M);if(!k)return;let I=!1;if($.type==="asset"){const N=e.assets.find(he=>he.id===$.assetId);N&&(I=k.type==="video"&&(N.type==="video"||N.type==="image")||k.type==="audio"&&N.type==="audio")}C.dataTransfer.dropEffect=I?"move":"none"}catch{C.dataTransfer.dropEffect="move"}},Te=C=>{const M=Math.floor(C/60),$=Math.floor(C%60),k=Math.floor(C%1*e.timeline.fps);return`${M.toString().padStart(2,"0")}:${$.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}`},be=()=>{const C=e.timeline.duration,M=[];let $,k;D>=500?($=.1,k=.05):D>=200?($=.5,k=.1):D>=100?($=.5,k=.25):D>=50?($=1,k=.5):D>=25?($=2,k=1):($=5,k=1);for(let I=0;I<=C;I+=$)M.push(y.jsx("div",{style:{position:"absolute",left:I*D,top:0,width:"1px",height:"20px",backgroundColor:"#666"},children:y.jsx("span",{style:{position:"absolute",top:"20px",left:"-20px",fontSize:"10px",color:"#aaa",width:"40px",textAlign:"center",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none"},children:Te(I)})},`major-${I}`));if(D>=50)for(let I=0;I<=C;I+=k)I%$!==0&&M.push(y.jsx("div",{style:{position:"absolute",left:I*D,top:0,width:"1px",height:"10px",backgroundColor:"#444"}},`minor-${I}`));return M},Oe=()=>40,je=()=>{const C=n.length>0?n:r?[r]:[];if(C.length===0)return[];const M=[];C.forEach(k=>{const I=kn(k),N=I?ie(I.id):null;!I||!N||(I.keyframes&&N.type==="video"&&Object.keys(I.keyframes).forEach(he=>{const oe=I.keyframes[he];if(!oe||oe.length===0)return;let ge="",ye="#fff",me="#666";switch(he){case"position":ge="",ye="#fff",me="#007acc";break;case"scale":ge="",ye="#fff",me="#ff6600";break;case"rotation":ge="",ye="#fff",me="#9933ff";break;case"opacity":ge="",ye="#fff",me="#00cc66";break;default:ge="",ye="#fff",me="#666";break}oe.forEach((ce,de)=>{let we=ce.time;ne.isDragging&&ne.clipId===I.id&&ne.property===he&&(ne.isShiftDrag?Math.abs(ne.originalTime-ce.time)<.01&&(we=ne.currentTime):Math.abs(ne.originalKeyframeTime-ce.time)<.01&&(we=ne.currentTime));const Le=I.start+we,re=Le*D;M.push({property:he,keyframe:ce,index:de,effectiveTime:we,absoluteTime:Le,leftPosition:re,icon:ge,color:ye,bgColor:me,clipId:I.id})})}),I.audioKeyframes&&N.type==="audio"&&Object.keys(I.audioKeyframes).forEach(he=>{const oe=I.audioKeyframes[he];if(!oe||oe.length===0)return;let ge="",ye="#fff",me="#666";switch(he){case"volume":ge="",ye="#fff",me="#00cc66";break;default:ge="",ye="#fff",me="#666";break}oe.forEach((ce,de)=>{let we=ce.time;ne.isDragging&&ne.clipId===I.id&&ne.property===he&&(ne.isShiftDrag?Math.abs(ne.originalTime-ce.time)<.01&&(we=ne.currentTime):Math.abs(ne.originalKeyframeTime-ce.time)<.01&&(we=ne.currentTime));const Le=I.start+we,re=Le*D;M.push({property:he,keyframe:ce,index:de,effectiveTime:we,absoluteTime:Le,leftPosition:re,icon:ge,color:ye,bgColor:me,clipId:I.id})})}))});const $=[];if(M.forEach(k=>{let I;switch(k.property){case"position":I=6;break;case"rotation":I=16;break;case"scale":I=26;break;case"opacity":case"volume":I=36;break;default:I=46;break}$.push(y.jsx("div",{className:"keyframe",style:{position:"absolute",left:k.leftPosition-6,top:I,width:"12px",height:"12px",backgroundColor:k.bgColor,color:k.color,border:"1px solid white",borderRadius:"2px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"8px",cursor:"pointer",zIndex:15,userSelect:"none",fontWeight:"bold",lineHeight:"1"},title:`${k.property} keyframe at ${k.effectiveTime.toFixed(2)}s`,onMouseDown:N=>le(N,k.clipId,k.property,k.keyframe.time),onContextMenu:N=>ze(N,k.clipId,k.property,k.keyframe.time),onClick:N=>{N.preventDefault(),N.stopPropagation();const he=e.timeline.tracks.flatMap(oe=>oe.clips).find(oe=>oe.id===k.clipId);if(he){const oe=he.start+k.keyframe.time;x(oe),setTimeout(()=>{E()},10)}},children:k.icon},`${k.clipId}-${k.property}-${k.index}`))}),ne.isDragging&&ne.isShiftDrag){const k=M.find(I=>I.clipId===ne.clipId&&I.property===ne.property&&Math.abs(I.keyframe.time-ne.originalTime)<.01);if(k){const I=e.timeline.tracks.flatMap(N=>N.clips).find(N=>N.id===ne.clipId);if(I){const he=(I.start+ne.currentTime)*D;let oe;switch(ne.property){case"position":oe=6;break;case"rotation":oe=16;break;case"scale":oe=26;break;case"opacity":case"volume":oe=36;break;default:oe=46;break}$.push(y.jsx("div",{className:"keyframe",style:{position:"absolute",left:he-6,top:oe,width:"12px",height:"12px",backgroundColor:k.bgColor,color:k.color,border:"2px solid #ffcc00",borderRadius:"2px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"8px",cursor:"pointer",zIndex:20,userSelect:"none",fontWeight:"bold",lineHeight:"1",opacity:.8},title:`Clone of ${ne.property} keyframe at ${ne.currentTime.toFixed(2)}s`,children:k.icon},`${ne.clipId}-${ne.property}-clone`))}}}return $},[ne,Ne]=G.useState({isDragging:!1,clipId:null,property:null,originalTime:0,currentTime:0,startX:0,isShiftDrag:!1,originalKeyframeTime:0}),le=(C,M,$,k)=>{var we,Le;if(C.preventDefault(),C.stopPropagation(),C.button!==0)return;const I=C.clientX,N=C.clientY,he=C.shiftKey;let oe=!1,ge=!1;const ye=kn(M);let me=null;if(ye){const Ge=$==="volume"?(we=ye.audioKeyframes)==null?void 0:we[$]:(Le=ye.keyframes)==null?void 0:Le[$];if(Ge){const We=Ge.find(Ze=>Math.abs(Ze.time-k)<.01);We&&(me=We.value,We.easing)}}const ce=re=>{const Ge=re.clientX-I,We=re.clientY-N,Ze=Math.sqrt(Ge*Ge+We*We);if(!oe&&Ze>5&&(oe=!0,ge=!0,Ne({isDragging:!0,clipId:M,property:$,originalTime:k,currentTime:k,startX:I,isShiftDrag:he,originalKeyframeTime:k})),ge){const wt=Ge/D,bt=Math.max(0,k+wt);Ne(Ve=>({...Ve,currentTime:bt}))}},de=re=>{const Ge=re.clientX-I,We=re.clientY-N;if(Math.sqrt(Ge*Ge+We*We)>5&&ge){const bt=Ge/D,Ve=Math.max(0,k+bt);if(Math.abs(Ve-k)>.01)if(he&&me!==null){const et=$==="volume";z(M,$,me,Ve,!0)}else T(M,$,k,Ve)}Ne({isDragging:!1,clipId:null,property:null,originalTime:0,currentTime:0,startX:0,isShiftDrag:!1,originalKeyframeTime:0}),document.removeEventListener("mousemove",ce),document.removeEventListener("mouseup",de)};document.addEventListener("mousemove",ce),document.addEventListener("mouseup",de)},ze=(C,M,$,k)=>{C.preventDefault(),C.stopPropagation(),b(M,$,k)},Xe=()=>{if(!r)return;const C=kn(r);if(!C)return;const M=t.currentTime-C.start;if(M<0||M>C.duration)return;const $=J(r,M);if(!$)return;const k=ie(r);(k==null?void 0:k.type)==="audio"?z(r,"volume",$.opacity,M,!0):z(r,"opacity",$.opacity,M,!0)},lt=()=>{if(!r)return;const C=kn(r);if(!C)return;const M=t.currentTime-C.start;if(M<0||M>C.duration)return;const $=J(r,M);$&&z(r,"position",{x:$.x,y:$.y},M,!0)},Qt=()=>{if(!r)return;const C=kn(r);if(!C)return;const M=t.currentTime-C.start;if(M<0||M>C.duration)return;const $=J(r,M);$&&z(r,"rotation",$.rotation,M,!0)},Sn=()=>{if(!r)return;const C=kn(r);if(!C)return;const M=t.currentTime-C.start;if(M<0||M>C.duration)return;const $=J(r,M);$&&z(r,"scale",{scaleX:$.scaleX,scaleY:$.scaleY},M,!0)},kn=C=>{for(const M of e.timeline.tracks)for(const $ of M.clips)if($.id===C)return $;return null},nn=(C,M)=>{const $=C.target.getBoundingClientRect(),k=C.clientX-$.left,I=O(M)*D,N=8;k<N?Je({clipId:M.id,edge:"left"}):k>I-N?Je({clipId:M.id,edge:"right"}):Je({clipId:M.id,edge:null})},Ht=()=>{Je({clipId:null,edge:null})},rn=C=>P.isDragging&&P.clipId===C.id&&P.dragType==="slip"?"col-resize":ht.clipId===C.id&&(ht.edge==="left"||ht.edge==="right")?"ew-resize":"move",ct=()=>{const C=[];for(const M of e.timeline.tracks)for(const $ of M.clips)if(n.includes($.id)){const k=$.start,I=$.start+$.duration;e.timeline.currentTime>=k&&e.timeline.currentTime<=I&&C.push($.id)}return C},xr=()=>{const C=ct();if(C.length>0)for(const M of C)f(M,e.timeline.currentTime)},Sr=()=>{if(n.length===0)return"Select clips to split";const C=ct();return C.length===0?"Move playhead inside selected clips to split":C.length===1?"Split clip at playhead position (S key)":`Split ${C.length} clips at playhead position (S key)`},Ns=()=>{if(n.length!==0)for(const C of n)m(C)},Ds=()=>n.length===0?"Select a clip to reverse":"Reverse selected clips (makes them play backwards)",$u=async()=>{if(n.length===0)return;const M=ct().filter($=>{for(const k of e.timeline.tracks){const I=k.clips.find(N=>N.id===$);if(I){const N=e.assets.find(he=>he.id===I.assetId);return N&&N.type==="video"}}return!1});if(M.length!==0)try{await g(M[0])}catch($){console.error("Failed to take snapshot:",$)}},Nu=async()=>{if(n.length===0)return;const C=n.filter(M=>{for(const $ of e.timeline.tracks){const k=$.clips.find(I=>I.id===M);if(k){const I=e.assets.find(N=>N.id===k.assetId);return I&&I.type==="video"}}return!1});if(C.length!==0)try{await v(C[0])}catch(M){console.error("Failed to export frames:",M)}},yg=()=>n.length===0?"Select a video clip to take snapshot":ct().filter($=>{for(const k of e.timeline.tracks){const I=k.clips.find(N=>N.id===$);if(I){const N=e.assets.find(he=>he.id===I.assetId);return N&&N.type==="video"}}return!1}).length===0?"Move playhead inside a selected video clip to take snapshot":"Take snapshot of current frame (saves image and copies to clipboard) - I key",vg=()=>n.length===0?"Select a video clip to export all frames":n.filter(M=>{for(const $ of e.timeline.tracks){const k=$.clips.find(I=>I.id===M);if(k){const I=e.assets.find(N=>N.id===k.assetId);return I&&I.type==="video"}}return!1}).length===0?"No video clips selected - select a video clip to export frames":"Export all frames from selected video clip to folder (Shift+I key)",wg=()=>n.length===0?"Select clips to copy (Ctrl+C)":`Copy ${n.length} selected clip${n.length>1?"s":""} (Ctrl+C)`,xg=()=>{var $;const{clipboardClips:C}=ft.getState();if(C.length===0)return"No clips to paste (Ctrl+V)";const M=Z?($=e.timeline.tracks.find(k=>k.id===Z))==null?void 0:$.name:"default tracks";return`Paste ${C.length} clip${C.length>1?"s":""} to ${M} (Ctrl+V)`},Sg=(C,M)=>{const $=e.assets.find(N=>N.id===C.assetId);if(!$)return null;const k=O(C)*D,I=C.start*D;return y.jsxs("div",{className:`clip ${n.includes(C.id)?"selected":""} ${P.isDragging&&P.clipId===C.id&&P.dragType!=="move"?"trimming":""} ${P.isDragging&&P.clipId===C.id&&P.dragType==="slip"?"slipping":""} ${P.isDragging&&P.clipId===C.id&&ae?"collision-detected":""} ${P.isDragging&&P.clipId===C.id&&Be.isSnapped?"snapped":""} ${P.isDragging&&Be.snapTargetClipId===C.id?"snap-target":""}`,style:{left:I,width:k,backgroundColor:C.reversed?"#9933ff":M==="video"?"#007acc":"#00cc66",cursor:rn(C),userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none"},onMouseDown:N=>xe(N,C),onMouseMove:N=>nn(N,C),onMouseLeave:Ht,onDoubleClick:N=>Pe(C.id,N),onContextMenu:N=>Y(N,C),title:`${$.name} - Double click to delete, S to split, drag edges to trim, drag body to move freely, right-click drag to slip edit`,children:[y.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",height:"100%"},children:[($.type==="video"||$.type==="image")&&$.thumbnail&&y.jsx("div",{style:{width:"20px",height:"20px",backgroundColor:"#222",border:"1px solid #333",borderRadius:"2px",overflow:"hidden",flexShrink:0,pointerEvents:"none"},children:y.jsx("img",{src:$.thumbnail,alt:$.name,draggable:!1,style:{width:"100%",height:"100%",objectFit:"cover",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",pointerEvents:"none"}})}),$.type==="audio"&&$.waveform&&y.jsx(Ww,{clip:C,asset:$,clipWidth:k,pixelsPerSecond:D}),y.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1,zIndex:10,position:"relative",pointerEvents:"none"},children:$.name})]}),n.includes(C.id)&&y.jsxs(y.Fragment,{children:[y.jsx("button",{style:{position:"absolute",right:"2px",top:"2px",width:"16px",height:"16px",fontSize:"10px",padding:0,background:"#ff4444",border:"none",borderRadius:"2px",color:"white",cursor:"pointer"},onClick:N=>Pe(C.id,N),children:""}),y.jsx("div",{style:{position:"absolute",bottom:"2px",right:"2px",fontSize:"9px",color:"#fff",backgroundColor:"rgba(0,0,0,0.7)",padding:"1px 3px",borderRadius:"2px"},children:"S"})]})]},C.id)};return y.jsx("div",{className:"timeline",style:{display:"flex",flexDirection:"column"},children:y.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:0},children:[y.jsxs("div",{className:"timeline-header",children:[y.jsx("button",{onClick:()=>c("video"),style:{fontSize:"12px",padding:"4px 8px",backgroundColor:"#007acc",color:"white",border:"none",borderRadius:"3px",marginRight:"5px"},title:"Add Video Track (adds to top)",children:"+ Video"}),y.jsx("button",{onClick:()=>c("audio"),style:{fontSize:"12px",padding:"4px 8px",backgroundColor:"#00cc66",color:"white",border:"none",borderRadius:"3px",marginRight:"5px"},title:"Add Audio Track (adds to bottom)",children:"+ Audio"}),y.jsx("button",{onClick:xr,disabled:n.length===0||ct().length===0,style:{fontSize:"12px",padding:"4px 8px",backgroundColor:n.length>0&&ct().length>0?"#ff6600":"#666",color:"white",border:"none",borderRadius:"3px",marginRight:"5px",cursor:n.length>0&&ct().length>0?"pointer":"not-allowed"},title:Sr(),children:" Split"}),y.jsx("button",{onClick:Ns,disabled:n.length===0,style:{fontSize:"12px",padding:"4px 8px",backgroundColor:n.length>0?"#9933ff":"#666",color:"white",border:"none",borderRadius:"3px",marginRight:"5px",cursor:n.length>0?"pointer":"not-allowed"},title:Ds(),children:" Reverse"}),y.jsx("button",{onClick:$u,disabled:(()=>n.length===0?!0:ct().filter($=>{for(const k of e.timeline.tracks){const I=k.clips.find(N=>N.id===$);if(I){const N=e.assets.find(he=>he.id===I.assetId);return N&&N.type==="video"}}return!1}).length===0)(),style:{fontSize:"12px",padding:"4px 8px",backgroundColor:(()=>n.length===0?"#666":ct().filter($=>{for(const k of e.timeline.tracks){const I=k.clips.find(N=>N.id===$);if(I){const N=e.assets.find(he=>he.id===I.assetId);return N&&N.type==="video"}}return!1}).length>0?"#ff6b35":"#666")(),color:"white",border:"none",borderRadius:"3px",marginRight:"5px",cursor:(()=>n.length===0?"not-allowed":ct().filter($=>{for(const k of e.timeline.tracks){const I=k.clips.find(N=>N.id===$);if(I){const N=e.assets.find(he=>he.id===I.assetId);return N&&N.type==="video"}}return!1}).length>0?"pointer":"not-allowed")()},title:yg(),children:" Snapshot"}),y.jsx("button",{onClick:Nu,disabled:(()=>n.length===0?!0:n.filter(M=>{for(const $ of e.timeline.tracks){const k=$.clips.find(I=>I.id===M);if(k){const I=e.assets.find(N=>N.id===k.assetId);return I&&I.type==="video"}}return!1}).length===0)(),style:{fontSize:"12px",padding:"4px 8px",backgroundColor:(()=>n.length===0?"#666":n.filter(M=>{for(const $ of e.timeline.tracks){const k=$.clips.find(I=>I.id===M);if(k){const I=e.assets.find(N=>N.id===k.assetId);return I&&I.type==="video"}}return!1}).length>0?"#4a90e2":"#666")(),color:"white",border:"none",borderRadius:"3px",marginRight:"5px",cursor:(()=>n.length===0?"not-allowed":n.filter(M=>{for(const $ of e.timeline.tracks){const k=$.clips.find(I=>I.id===M);if(k){const I=e.assets.find(N=>N.id===k.assetId);return I&&I.type==="video"}}return!1}).length>0?"pointer":"not-allowed")()},title:vg(),children:" Export Frames"}),y.jsx("button",{onClick:w,disabled:n.length===0,style:{fontSize:"12px",padding:"4px 8px",backgroundColor:n.length>0?"#00cc99":"#666",color:"white",border:"none",borderRadius:"3px",marginRight:"5px",cursor:n.length>0?"pointer":"not-allowed"},title:wg(),children:" Copy"}),y.jsx("button",{onClick:()=>j(Z||void 0),style:{fontSize:"12px",padding:"4px 8px",backgroundColor:"#00aa77",color:"white",border:"none",borderRadius:"3px",marginRight:"15px",cursor:"pointer"},title:xg(),children:" Paste"}),y.jsxs("button",{onClick:()=>{Ye(!ve),ve&&vt({isSnapped:!1,snapPosition:0,snapType:"start",snapTargetClipId:null,originalPosition:0})},style:{fontSize:"12px",padding:"4px 8px",backgroundColor:ve?"#00cc66":"#666",color:"white",border:"none",borderRadius:"3px",marginRight:"15px",cursor:"pointer"},title:ve?"Disable snapping":"Enable snapping",children:[" ",ve?"ON":"OFF"]}),y.jsxs("div",{style:{display:"flex",alignItems:"center",marginRight:"15px",gap:"5px"},children:[y.jsx("button",{onClick:X,disabled:R===0,style:{fontSize:"12px",padding:"4px 8px",backgroundColor:R>0?"#4a90e2":"#666",color:"white",border:"none",borderRadius:"3px",cursor:R>0?"pointer":"not-allowed"},title:"Zoom out (-)",children:""}),y.jsxs("span",{style:{fontSize:"11px",color:"#aaa",minWidth:"60px",textAlign:"center"},children:[D,"px/s"]}),y.jsx("button",{onClick:H,disabled:R===K.length-1,style:{fontSize:"12px",padding:"4px 8px",backgroundColor:R<K.length-1?"#4a90e2":"#666",color:"white",border:"none",borderRadius:"3px",cursor:R<K.length-1?"pointer":"not-allowed"},title:"Zoom in (+)",children:"+"})]}),y.jsx("button",{onClick:t.isPlaying?u:h,children:t.isPlaying?"":""}),y.jsx("button",{onClick:p,children:""}),y.jsxs("span",{style:{marginLeft:"10px",fontSize:"12px"},children:[Te(e.timeline.currentTime)," / ",Te(e.timeline.duration)]}),y.jsx("input",{type:"range",min:"0",max:e.timeline.duration,step:"0.1",value:e.timeline.currentTime,onChange:C=>x(parseFloat(C.target.value)),style:{marginLeft:"10px",flex:1}})]}),y.jsxs("div",{className:"timeline-tracks",ref:ee,onClick:Ee,onMouseDown:Se,style:{position:"relative",overflowX:"auto",overflowY:"visible",minWidth:`${100+Math.max(e.timeline.duration*D,1e3)}px`},children:[y.jsxs("div",{style:{position:"relative",height:`${Math.max(40,n.length>0||r?Oe():40)}px`,borderBottom:"1px solid #555",marginLeft:"100px",cursor:"pointer",overflow:"visible",minWidth:`${Math.max(e.timeline.duration*D,1e3)}px`},onClick:C=>{var N;C.stopPropagation();const M=C.currentTarget.getBoundingClientRect(),$=((N=ee.current)==null?void 0:N.scrollLeft)||0,k=C.clientX-M.left+$,I=Math.max(0,Math.min(k/D,e.timeline.duration));x(I)},children:[be(),je()]}),e.timeline.tracks.map((C,M)=>{const $=C.type==="video"&&M<e.timeline.tracks.length-1&&e.timeline.tracks[M+1].type==="audio";return y.jsxs("div",{className:"track",style:{borderBottom:$?"3px solid #666":"1px solid #333",display:"block",position:"relative",minWidth:`${100+Math.max(e.timeline.duration*D,1e3)}px`},children:[y.jsx("div",{className:"track-label",onClick:()=>{ue(C.id),i(null),s(null)},style:{userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",backgroundColor:Z===C.id?"#0066cc":"#333",cursor:"pointer",transition:"background-color 0.2s",border:Z===C.id?"2px solid #00aaff":"2px solid transparent",position:"absolute",left:"0",top:"0",width:"100px",height:"100%",zIndex:10},children:y.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[y.jsxs("div",{children:[C.name,y.jsx("div",{style:{fontSize:"10px",opacity:.7},children:C.type.toUpperCase()})]}),y.jsx("button",{onClick:()=>d(C.id),style:{width:"20px",height:"20px",fontSize:"12px",padding:0,backgroundColor:"#ff4444",color:"white",border:"none",borderRadius:"3px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:`Delete ${C.name} and all its clips`,children:""})]})}),y.jsx("div",{className:"track-content",onDrop:k=>De(k,C.id),onDragOver:k=>$e(k,C.id),style:{minHeight:"30px",border:"2px dashed transparent",transition:"border-color 0.2s, background-color 0.2s",backgroundColor:Z===C.id?"#001122":"#1a1a1a",marginLeft:"100px",minWidth:`${Math.max(e.timeline.duration*D,1e3)}px`,width:`${Math.max(e.timeline.duration*D,1e3)}px`},onDragEnter:k=>{const I=k.currentTarget,N=window.currentDragAssetType;if(N){const he=e.timeline.tracks.find(oe=>oe.id===C.id);he&&(he.type==="video"&&(N==="video"||N==="image")||he.type==="audio"&&N==="audio")&&(I.className="track-content drag-compatible")}},onDragLeave:k=>{const I=k.currentTarget;I.className="track-content",I.style.borderColor="transparent"},children:C.clips.map(k=>Sg(k,C.type))})]},C.id)}),Me.isDragging&&y.jsx("div",{style:{position:"absolute",left:Math.min(Me.startX,Me.currentX),top:Math.min(Me.startY,Me.currentY),width:Math.abs(Me.currentX-Me.startX),height:Math.abs(Me.currentY-Me.startY),border:"1px dashed #007acc",backgroundColor:"rgba(0, 122, 204, 0.1)",pointerEvents:"none",zIndex:1e3}}),y.jsx("div",{className:"playhead",style:{left:100+e.timeline.currentTime*D,top:"40px",height:`${e.timeline.tracks.length*40}px`,cursor:Fe.isDragging?"grabbing":"grab"},onMouseDown:ke})]})]})})},Kw=({onGenerateStoryboard:e})=>{const[t,n]=G.useState(""),[r,i]=G.useState([{index:1,description:""}]),[s,o]=G.useState(""),[a,l]=G.useState([]),[c,d]=G.useState(!1),[f,m]=G.useState(!1),g=()=>{i([...r,{index:r.length+1,description:""}])},v=S=>{if(r.length>1){const b=r.filter((T,z)=>z!==S);i(b.map((T,z)=>({...T,index:z+1})))}},w=(S,b)=>{const T=[...r];T[S].description=b,i(T)},j=()=>{const S=s.split(`
`).map(b=>b.trim()).filter(b=>b.length>0).map((b,T)=>({index:T+1,description:b.replace(/^[\d]+[.)\-:]?\s*|^[-*]\s*/g,"").trim()}));l(S),d(!0)},h=()=>{l([...a,{index:a.length+1,description:""}])},u=S=>{if(a.length>1){const b=a.filter((T,z)=>z!==S);l(b.map((T,z)=>({...T,index:z+1})))}},p=(S,b)=>{const T=[...a];T[S].description=b,l(T)},x=async()=>{if(!t.trim()){alert("Please enter a story prompt");return}if(a.length===0){alert("Please add at least one keyframe");return}m(!0);try{await e({storyPrompt:t,characters:r.filter(S=>S.description.trim()),keyframes:a.filter(S=>S.description.trim())})}finally{m(!1)}};return y.jsxs("div",{className:"prompting-container",children:[y.jsxs("div",{className:"prompting-grid",children:[y.jsxs("div",{className:"prompting-column",children:[y.jsxs("div",{className:"prompt-section",children:[y.jsx("h3",{children:" Story Prompt"}),y.jsx("textarea",{value:t,onChange:S=>n(S.target.value),placeholder:"Describe your story... e.g., 'A brave knight discovers a hidden dragon's lair in the mountains and must decide whether to fight or befriend the ancient creature.'",rows:6}),y.jsx("span",{className:"hint",children:"Include setting, mood, conflict, and key events."})]}),y.jsxs("div",{className:"prompt-section",children:[y.jsx("h3",{children:" Characters"}),y.jsx("div",{className:"character-list",children:r.map((S,b)=>y.jsxs("div",{className:"character-card",children:[y.jsxs("div",{className:"character-header",children:[y.jsxs("span",{children:["Character ",S.index]}),r.length>1&&y.jsx("button",{onClick:()=>v(b),className:"btn-remove",children:""})]}),y.jsx("textarea",{value:S.description,onChange:T=>w(b,T.target.value),placeholder:"e.g., 'Elena - A fierce warrior with long silver hair...'",rows:3})]},b))}),y.jsx("button",{onClick:g,className:"btn-add",children:"+ Add Character"})]})]}),y.jsx("div",{className:"prompting-column",children:y.jsxs("div",{className:"prompt-section",children:[y.jsx("h3",{children:" Storyboard Keyframes"}),c?y.jsxs("div",{className:"keyframe-list",children:[a.map((S,b)=>y.jsxs("div",{className:"keyframe-card",children:[y.jsxs("div",{className:"keyframe-header",children:[y.jsxs("span",{children:["Scene ",S.index]}),a.length>1&&y.jsx("button",{onClick:()=>u(b),className:"btn-remove",children:""})]}),y.jsx("textarea",{value:S.description,onChange:T=>p(b,T.target.value),placeholder:"Describe this scene...",rows:2})]},b)),y.jsxs("div",{className:"keyframe-actions",children:[y.jsx("button",{onClick:h,className:"btn-add",children:"+ Add Keyframe"}),y.jsx("button",{onClick:()=>d(!1),className:"btn-reset",children:" Reset"})]})]}):y.jsxs("div",{className:"shot-sequence-input",children:[y.jsx("textarea",{value:s,onChange:S=>o(S.target.value),placeholder:`Enter your shot sequence, one per line:

1. Wide shot of the castle at dawn
2. Close-up of the knight's face
3. The knight draws his sword
4. Dragon emerges from cave
5. Epic confrontation`,rows:10}),y.jsx("button",{onClick:j,className:"btn-parse",children:" Break Into Keyframes"})]})]})})]}),y.jsx("div",{className:"generate-section",children:y.jsx("button",{onClick:x,className:"btn-generate",disabled:f,children:f?"Generating...":" Generate Storyboard"})})]})},Xw=({storyPrompt:e,scenes:t,onRegenerateScene:n,onEditScene:r,onSendToEditor:i})=>{const[s,o]=G.useState(new Set),[a,l]=G.useState(null),c=(h,u)=>{u.stopPropagation();const p=new Set(s);if(u.ctrlKey||u.metaKey)p.has(h)?p.delete(h):p.add(h);else if(u.shiftKey&&s.size>0){const x=Math.max(...s),S=Math.min(x,h),b=Math.max(x,h);for(let T=S;T<=b;T++)p.add(T)}else p.clear(),p.add(h);o(p)},d=()=>{o(new Set(t.map((h,u)=>u)))},f=()=>{o(new Set)},m=()=>{const h=s.size>0?Array.from(s).sort((u,p)=>u-p).map(u=>t[u]):t.filter(u=>u.imageUrl);if(h.length===0){alert("No scenes with images to send to editor");return}i(h)},g=(h,u)=>{const p=t[h];r(h,{...p,narration:u})},v=(h,u)=>{const p=t[h];r(h,{...p,duration:u})};if(t.length===0)return y.jsx("div",{className:"storyboard-empty",children:y.jsxs("div",{className:"empty-state",children:[y.jsx("span",{className:"empty-icon",children:""}),y.jsx("h3",{children:"No Storyboard Yet"}),y.jsx("p",{children:'Go to "Prompting" tab to create your story and generate a storyboard.'})]})});const w=t.filter(h=>h.status==="complete"||h.imageUrl).length,j=t.filter(h=>h.status==="generating").length;return y.jsxs("div",{className:"storyboard-container",children:[y.jsxs("div",{className:"storyboard-header",children:[y.jsxs("div",{className:"storyboard-info",children:[y.jsxs("span",{className:"story-preview",children:[e.substring(0,100),"..."]}),y.jsxs("div",{className:"storyboard-stats",children:[y.jsxs("span",{children:[w,"/",t.length," scenes generated"]}),j>0&&y.jsxs("span",{className:"generating",children:["(",j," generating...)"]}),s.size>0&&y.jsxs("span",{className:"selection-info",children:[s.size," selected"]})]})]}),y.jsxs("div",{className:"storyboard-actions",children:[y.jsx("button",{onClick:d,className:"btn-secondary",children:" All"}),y.jsx("button",{onClick:f,className:"btn-secondary",children:" Clear"}),y.jsx("button",{onClick:m,className:"btn-primary",children:" Send to Editor"})]})]}),y.jsx("div",{className:"storyboard-grid",children:t.map((h,u)=>y.jsxs("div",{className:`storyboard-card ${s.has(u)?"selected":""} status-${h.status||"pending"}`,onClick:p=>c(u,p),children:[y.jsxs("div",{className:"card-header",children:[y.jsxs("span",{className:"scene-number",children:["Scene ",u+1]}),y.jsxs("div",{className:"card-actions",children:[y.jsx("button",{onClick:p=>{p.stopPropagation(),l(a===u?null:u)},title:"Edit",className:"btn-icon",children:""}),y.jsx("button",{onClick:p=>{p.stopPropagation(),n(u)},title:"Regenerate",className:"btn-icon",children:""})]})]}),y.jsx("div",{className:"card-image",children:h.status==="generating"?y.jsxs("div",{className:"scene-loading",children:[y.jsx("div",{className:"spinner"}),y.jsx("span",{children:"Generating..."})]}):h.status==="error"?y.jsxs("div",{className:"scene-error",children:[y.jsx("span",{children:" Failed"}),y.jsx("button",{onClick:p=>{p.stopPropagation(),n(u)},children:"Retry"})]}):h.imageUrl?y.jsx("img",{src:h.imageUrl,alt:`Scene ${u+1}`}):y.jsxs("div",{className:"scene-placeholder",children:[y.jsx("span",{children:""}),y.jsx("span",{children:"Pending"})]})}),y.jsx("div",{className:"card-content",children:a===u?y.jsxs("div",{className:"scene-edit",children:[y.jsx("textarea",{value:h.narration,onChange:p=>g(u,p.target.value),onClick:p=>p.stopPropagation(),rows:3}),y.jsxs("div",{className:"duration-edit",children:[y.jsx("label",{children:"Duration (frames):"}),y.jsx("input",{type:"number",value:h.duration||120,onChange:p=>v(u,parseInt(p.target.value)||120),onClick:p=>p.stopPropagation(),min:1}),y.jsxs("span",{className:"duration-hint",children:["(",((h.duration||120)/30).toFixed(1),"s at 30fps)"]})]})]}):y.jsxs(y.Fragment,{children:[y.jsx("p",{className:"scene-narration",children:h.narration}),y.jsxs("span",{className:"scene-duration",children:[((h.duration||120)/30).toFixed(1),"s"]})]})})]},h.id))}),y.jsxs("div",{className:"timeline-preview",children:[y.jsx("h4",{children:"Timeline Preview"}),y.jsx("div",{className:"timeline-track",children:t.map((h,u)=>y.jsx("div",{className:`timeline-item ${s.has(u)?"selected":""} ${h.imageUrl?"":"empty"}`,style:{backgroundImage:h.imageUrl?`url('${h.imageUrl}')`:"none",width:`${(h.duration||120)/2}px`},onClick:p=>c(u,p),title:`Scene ${u+1}: ${h.narration.substring(0,50)}...`},h.id))})]})]})},Vw=({onLoadProject:e,onSaveProject:t,projectPath:n,setProjectPath:r})=>{const i=G.useRef(null),[s,o]=G.useState(!1),a=async()=>{if(!window.showDirectoryPicker){alert("Your browser does not support the File System Access API. Please use Chrome or Edge.");return}try{o(!0);const f=await window.showDirectoryPicker({mode:"read"}),m=f.name;let g=null;try{const z=await(await(await f.getFileHandle("project.json")).getFile()).text();g=JSON.parse(z)}catch{alert("Could not find project.json in the selected folder"),o(!1);return}let v=null,w=null,j=null;try{v=await f.getDirectoryHandle("videos")}catch{}try{w=await f.getDirectoryHandle("images")}catch{}try{j=await f.getDirectoryHandle("keyframes")}catch{}const h=await Promise.all((g.scenes||[]).map(async(b,T)=>{let z=null,O=null;const J=b.imageFile||`scene_${T+1}.png`;try{let P=null;if(j)try{P=await(await j.getFileHandle(J)).getFile()}catch{}if(!P&&w)try{P=await(await w.getFileHandle(J)).getFile()}catch{}P&&(z=URL.createObjectURL(P))}catch{}const ee=b.videoFile||`scene_${T+1}.mp4`;if(v)try{const _e=await(await v.getFileHandle(ee)).getFile();O=URL.createObjectURL(_e)}catch{}return{id:b.id||`scene_${T+1}`,narration:b.narration||"",imagePrompt:b.imagePrompt||"",imageUrl:z,videoUrl:O,duration:b.duration||120,status:z?"complete":"pending"}})),u={storyPrompt:g.storyPrompt||"",characters:g.characters||[],scenes:h,settings:g.settings||{fps:30,canvasWidth:1920,canvasHeight:1080,defaultSceneDuration:120}},p=`[LOCAL] ${m}`;r(p),localStorage.setItem("projectPath",p),localStorage.setItem("isLocalProject","true"),e({storyboard:u,localFolderHandle:f});const x=h.filter(b=>b.videoUrl).length,S=h.filter(b=>b.imageUrl).length;alert(`Loaded local project: ${m}
${h.length} scenes (${S} images, ${x} videos)`)}catch(f){f.name!=="AbortError"&&alert(`Failed to load local project: ${f.message}`)}finally{o(!1)}},l=async()=>{const f=prompt("Enter project path to load:",n||"/home/exedev/video-maker/projects/my-project");if(f)try{o(!0);const m=await fetch(`/api/load-project?path=${encodeURIComponent(f)}`);if(!m.ok)throw new Error(await m.text());const g=await m.json();r(f),localStorage.setItem("projectPath",f),localStorage.setItem("isLocalProject","false");const v={storyPrompt:g.storyPrompt||"",characters:g.characters||[],scenes:(g.scenes||[]).map((w,j)=>({id:w.id||`scene_${j+1}`,narration:w.narration||"",imagePrompt:w.imagePrompt||"",imageUrl:w.imageUrl||null,videoUrl:w.videoUrl||null,duration:w.duration||120,status:w.imageUrl?"complete":"pending"})),settings:g.settings||{fps:30,canvasWidth:1920,canvasHeight:1080,defaultSceneDuration:120}};e({storyboard:v}),alert(`Project loaded from server: ${f}`)}catch(m){alert(`Failed to load project: ${m}`)}finally{o(!1)}},c=()=>{var f;(f=i.current)==null||f.click()},d=async f=>{var g;const m=(g=f.target.files)==null?void 0:g[0];if(m){try{const v=await m.text(),w=JSON.parse(v);if(w.timeline&&w.assets)e({project:w});else if(w.scenes||w.storyPrompt){const j={storyPrompt:w.storyPrompt||"",characters:w.characters||[],scenes:(w.scenes||[]).map((h,u)=>({id:h.id||`scene_${u+1}`,narration:h.narration||"",imagePrompt:h.imagePrompt||"",imageUrl:h.imageUrl||null,videoUrl:h.videoUrl||null,duration:h.duration||120,status:h.imageUrl?"complete":"pending"})),settings:w.settings};e({storyboard:j})}alert(`Loaded ${m.name}`)}catch(v){alert(`Failed to load file: ${v}`)}f.target.value=""}};return y.jsxs("div",{className:"project-controls",children:[y.jsx("button",{onClick:a,className:"btn-project btn-local",title:"Load project from local folder",disabled:s,children:" Local"}),y.jsx("button",{onClick:l,className:"btn-project",title:"Load from server",disabled:s,children:" Server"}),y.jsx("button",{onClick:c,className:"btn-project",title:"Load JSON file",disabled:s,children:" JSON"}),y.jsx("button",{onClick:t,className:"btn-project",title:"Save project",disabled:s,children:" Save"}),y.jsx("input",{ref:i,type:"file",accept:".json",onChange:d,style:{display:"none"}})]})};function Tf(e){const t=e.settings||{fps:30,canvasWidth:1920,canvasHeight:1080,defaultSceneDuration:120},n=c=>Math.round(c*t.fps),r=c=>c.editDuration!==void 0?n(c.editDuration):c.duration||t.defaultSceneDuration,i=e.scenes.filter(c=>c.videoUrl||c.imageUrl).map((c,d)=>{const f=!!c.videoUrl;return{id:`asset_scene_${d+1}`,type:f?"video":"image",src:f?c.videoUrl:c.imageUrl,name:`Scene ${d+1}`,width:t.canvasWidth,height:t.canvasHeight,duration:f&&c.generationDuration?n(c.generationDuration):void 0}});let s=0;const o=e.scenes.filter(c=>c.videoUrl||c.imageUrl).map((c,d)=>{const f=r(c),m=s;return s+=f,{id:`clip_scene_${d+1}`,assetId:`asset_scene_${d+1}`,start:m,duration:f,inPoint:0,outPoint:f,keyframes:{position:[{time:0,value:{x:0,y:0},easing:"linear"}],scale:[{time:0,value:{x:1,y:1},easing:"linear"}],rotation:[{time:0,value:0,easing:"linear"}],opacity:[{time:0,value:1,easing:"linear"}]}}}),a=o.reduce((c,d)=>Math.max(c,d.start+d.duration),0);return{id:dt(),name:e.storyPrompt.substring(0,50)||"Untitled Project",assets:i,timeline:{tracks:[{id:"track_video_1",type:"video",name:"Video 1",clips:o,visible:!0,locked:!1},{id:"track_audio_1",type:"audio",name:"Audio 1",clips:[],visible:!0,locked:!1}],currentTime:0,duration:a,fps:t.fps,zoom:1},canvasWidth:t.canvasWidth,canvasHeight:t.canvasHeight,backgroundColor:"#000000"}}function Yw(e){return JSON.stringify(e,null,2)}function Qw(e,t){const n=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r)}const lo=window.self!==window.top;function Jw(){const[e,t]=G.useState(lo?"editing":"prompting"),[n,r]=G.useState({storyPrompt:"",characters:[],scenes:[],settings:{fps:30,canvasWidth:1920,canvasHeight:1080,defaultSceneDuration:120}}),{project:i,selectedTool:s,setSelectedTool:o,currentTime:a,setCurrentTime:l,isPlaying:c,setIsPlaying:d,playbackSpeed:f,setPlaybackSpeed:m,showOnionSkin:g,setShowOnionSkin:v,onionSkinFrames:w,setOnionSkinFrames:j,brushSettings:h,setBrushSettings:u,setProject:p,undo:x,redo:S,canUndo:b,canRedo:T}=ft(),[z,O]=G.useState({show:!1,assetType:"",assetData:null,position:{x:0,y:0}}),[J,ee]=G.useState(()=>localStorage.getItem("geminiApiKey")||""),[P,_e]=G.useState(()=>localStorage.getItem("projectPath")||""),ht=async Z=>{const ue=Z.keyframes.map((_,D)=>({id:`scene_${D+1}`,narration:_.description,imagePrompt:_.description,imageUrl:void 0,status:"pending",duration:120})),Fe={storyPrompt:Z.storyPrompt,characters:Z.characters.map(_=>({..._,imageUrl:void 0})),scenes:ue,settings:n.settings};if(r(Fe),t("storyboard"),!P){const _=`/home/exedev/video-maker/projects/project-${Date.now()}`;_e(_),localStorage.setItem("projectPath",_)}for(let _=0;_<ue.length;_++){r(D=>({...D,scenes:D.scenes.map((te,E)=>E===_?{...te,status:"generating"}:te)}));try{const D=await Ut(ue[_].narration,Z.storyPrompt,Z.characters.map(te=>te.description));r(te=>{const E={...te,scenes:te.scenes.map((K,R)=>R===_?{...K,imageUrl:D,status:"complete"}:K)};return Je(E),E}),await Yt(_+1,D)}catch(D){console.error(`Failed to generate scene ${_+1}:`,D),r(te=>({...te,scenes:te.scenes.map((E,K)=>K===_?{...E,status:"error"}:E)}))}}},Je=async Z=>{if(P)try{await fetch("/api/save-project",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectPath:P,storyPrompt:Z.storyPrompt,characters:Z.characters,scenes:Z.scenes.map(ue=>({id:ue.id,narration:ue.narration,imagePrompt:ue.imagePrompt,imageUrl:ue.imageUrl,duration:ue.duration})),settings:Z.settings})}),console.log("Storyboard saved to:",P)}catch(ue){console.error("Failed to save storyboard:",ue)}},Ut=async(Z,ue,Fe)=>{var E,K,R,H,X,ie;if(!J)throw new Error("Gemini API key not configured. Click  to set it.");const _=`Generate a cinematic storyboard frame image for a video scene.

Scene description: ${Z}

Story context: ${ue}

${Fe.length>0?`Characters:
${Fe.map((L,U)=>`- Character ${U+1}: ${L}`).join(`
`)}`:""}

Style: Cinematic, high-quality, suitable for video/animation storyboard. Aspect ratio 16:9, dramatic lighting, professional composition.`,D=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${J}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:_}]}],generationConfig:{responseModalities:["image","text"]}})});if(!D.ok){const L=await D.json();throw new Error(((E=L.error)==null?void 0:E.message)||"Failed to generate image")}const te=await D.json();if((H=(R=(K=te.candidates)==null?void 0:K[0])==null?void 0:R.content)!=null&&H.parts){for(const L of te.candidates[0].content.parts)if((ie=(X=L.inlineData)==null?void 0:X.mimeType)!=null&&ie.startsWith("image/"))return`data:${L.inlineData.mimeType};base64,${L.inlineData.data}`}throw new Error("No image in response")},Yt=async(Z,ue)=>{if(P)try{await fetch("/api/save-keyframe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectPath:P,sceneIndex:Z,imageData:ue})})}catch(Fe){console.error("Failed to save keyframe:",Fe)}},ae=async Z=>{const ue=n.scenes[Z];r(Fe=>({...Fe,scenes:Fe.scenes.map((_,D)=>D===Z?{..._,status:"generating"}:_)}));try{const Fe=await Ut(ue.narration,n.storyPrompt,n.characters.map(_=>_.description));r(_=>{const D={..._,scenes:_.scenes.map((te,E)=>E===Z?{...te,imageUrl:Fe,status:"complete"}:te)};return Je(D),D}),await Yt(Z+1,Fe)}catch(Fe){console.error(`Failed to regenerate scene ${Z+1}:`,Fe),r(_=>({..._,scenes:_.scenes.map((D,te)=>te===Z?{...D,status:"error"}:D)}))}},fe=(Z,ue)=>{r(Fe=>{const _={...Fe,scenes:Fe.scenes.map((D,te)=>te===Z?ue:D)};return Je(_),_})},ve=Z=>{const ue={...n,scenes:Z},Fe=Tf(ue);p(Fe),P&&Ye(Fe),t("editing")},Ye=async Z=>{if(P)try{await fetch("/api/save-project",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectPath:P,project:Z,storyPrompt:n.storyPrompt,characters:n.characters,scenes:n.scenes,settings:n.settings})}),console.log("Project saved to:",P)}catch(ue){console.error("Failed to save project:",ue)}},Be=()=>{const Z=Yw(n);Qw(Z,"storyboard.json")},vt=Z=>{Z.storyboard&&(r(Z.storyboard),Z.storyboard.scenes.some(ue=>ue.imageUrl||ue.videoUrl)&&t("storyboard")),Z.project&&(p(Z.project),t("editing")),Z.localFolderHandle&&(window.__localFolderHandle=Z.localFolderHandle)},Me=async()=>{let Z=P;if(!Z){if(Z=prompt("Enter project path:","/home/exedev/video-maker/projects/my-project")||"",!Z)return;_e(Z),localStorage.setItem("projectPath",Z)}try{await fetch("/api/save-project",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectPath:Z,storyPrompt:n.storyPrompt,characters:n.characters,scenes:n.scenes,settings:n.settings,project:i})}),alert(`Project saved to ${Z}`)}catch(ue){alert(`Failed to save: ${ue}`)}};G.useEffect(()=>{const Z=ue=>{(ue.ctrlKey||ue.metaKey)&&ue.key==="z"&&(ue.preventDefault(),ue.shiftKey?S():x()),(ue.ctrlKey||ue.metaKey)&&ue.key==="y"&&(ue.preventDefault(),S())};return window.addEventListener("keydown",Z),()=>window.removeEventListener("keydown",Z)},[x,S]),G.useEffect(()=>{if(!lo)return;const Z=ue=>{var Fe,_,D,te,E;if(console.log("Editor received message:",(Fe=ue.data)==null?void 0:Fe.type),((_=ue.data)==null?void 0:_.type)==="loadProject"&&((D=ue.data)!=null&&D.project))console.log("Loading project from parent:",ue.data.project),p(ue.data.project);else if(((te=ue.data)==null?void 0:te.type)==="loadStoryboard"&&((E=ue.data)!=null&&E.storyboard)){console.log("Loading storyboard from parent:",ue.data.storyboard);const K=Tf(ue.data.storyboard);console.log("Generated project:",K),p(K)}};return window.addEventListener("message",Z),()=>window.removeEventListener("message",Z)},[p]);const at=()=>{const Z=prompt("Enter Gemini API Key:",J);Z!==null&&(ee(Z),localStorage.setItem("geminiApiKey",Z));const ue=prompt("Enter Project Path:",P||"/home/exedev/video-maker/projects/my-project");ue!==null&&(_e(ue),localStorage.setItem("projectPath",ue))};return y.jsxs("div",{className:`app-container ${lo?"embedded":""}`,children:[!lo&&y.jsxs("header",{className:"app-header",children:[y.jsx("div",{className:"app-brand",children:y.jsx("h1",{children:" Video Editor"})}),y.jsx(Vw,{onLoadProject:vt,onSaveProject:Me,projectPath:P,setProjectPath:Z=>{_e(Z),localStorage.setItem("projectPath",Z)}}),y.jsxs("nav",{className:"app-tabs",children:[y.jsx("button",{className:`tab-btn ${e==="prompting"?"active":""}`,onClick:()=>t("prompting"),children:" Prompting"}),y.jsx("button",{className:`tab-btn ${e==="storyboard"?"active":""}`,onClick:()=>t("storyboard"),children:" Storyboard"}),y.jsx("button",{className:`tab-btn ${e==="editing"?"active":""}`,onClick:()=>t("editing"),children:" Editing"})]}),y.jsxs("div",{className:"app-actions",children:[e==="storyboard"&&n.scenes.length>0&&y.jsx("button",{className:"btn-download",onClick:Be,children:" Download JSON"}),y.jsx("button",{className:"btn-settings",onClick:at,children:""})]})]}),y.jsxs("main",{className:"app-content",children:[e==="prompting"&&y.jsx(Kw,{onGenerateStoryboard:ht}),e==="storyboard"&&y.jsx(Xw,{storyPrompt:n.storyPrompt,scenes:n.scenes,onRegenerateScene:ae,onEditScene:fe,onSendToEditor:ve}),e==="editing"&&y.jsxs("div",{className:"editor-layout",children:[y.jsx(Iv,{selectedTool:s,setSelectedTool:o,brushSettings:h,setBrushSettings:u,showOnionSkin:g,setShowOnionSkin:v,onionSkinFrames:w,setOnionSkinFrames:j,currentTime:a,isPlaying:c,setIsPlaying:d,playbackSpeed:f,setPlaybackSpeed:m,undo:x,redo:S,canUndo:b(),canRedo:T()}),y.jsxs("div",{className:"editor-main",children:[y.jsx(Av,{onAssetHover:(Z,ue,Fe)=>{O(Z&&ue?{show:!0,assetType:Z,assetData:ue,position:Fe}:_=>({..._,show:!1}))}}),y.jsx(Hw,{selectedTool:s,brushSettings:h,currentTime:a,showOnionSkin:g,onionSkinFrames:w})]}),y.jsx(Bw,{currentTime:a,setCurrentTime:l,isPlaying:c,setIsPlaying:d,playbackSpeed:f})]})]})]})}pl.createRoot(document.getElementById("root")).render(y.jsx(Ff.StrictMode,{children:y.jsx(Jw,{})}));
